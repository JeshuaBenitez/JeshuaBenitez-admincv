import './polyfills.server.mjs';
import{$ as W0,A as ee,Aa as Rc,B as z0,Ba as J0,C as St,Ca as X0,D as Zt,E as hr,F as G0,Fa as Z0,G as $e,H as Qe,I as j0,J as Aa,Ja as eS,K as Nr,L as Sf,M as Ms,Ma as tS,N as J,Na as Af,O as ge,P as bf,Q as Ia,R as Fi,S as Lt,T as ct,U as Cf,V,W as L,X as de,Y as Bt,Z as ve,_ as Ye,a as Rs,aa as se,b as Sc,ba as Ic,c as bc,ca as Vn,d as F0,da as Dc,e as Oi,ea as H0,f as xs,fa as _e,g as Bn,ga as Se,h as Mr,ha as be,i as me,ia as kc,j as L0,ja as Ef,k as B0,ka as K0,l as Ta,m as V0,ma as $0,n as q0,o as Cc,p as Ec,q as vf,r as wc,ra as wf,s as Pi,sa as Q0,t as _f,u as U0,ua as Y0,v as Tc,va as Da,w as Ac,wa as Or,x as He,xa as Tf,y as Xt,z as Ke,za as Vt}from"./chunk-DOEE3HZR.mjs";import{a as nS,b as If,c as rS,d as ka,e as Df,f as xc,g as iS,h as sS,i as kf,j as Le,k as Li,l as qn,m as Mc,n as Ra,o as oS,p as aS,q as Pr,r as en}from"./chunk-XKLCX4PC.mjs";import{a as Z,b as Jt,c as Ce,f as k,h as P0,i as yf,j as C}from"./chunk-EXD34EPT.mjs";var ye=k(ln=>{"use strict";Object.defineProperty(ln,"__esModule",{value:!0});ln.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=ln.DEFAULT_MAX_SEND_MESSAGE_LENGTH=ln.Propagate=ln.LogVerbosity=ln.Status=void 0;var IS=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(IS||(ln.Status=IS={})),DS=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(DS||(ln.LogVerbosity=DS={})),kS=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(kS||(ln.Propagate=kS={}));ln.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;ln.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var Hf=k((W9,Vk)=>{Vk.exports={name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Ge=k(kt=>{"use strict";var Kf,$f,Qf,Yf;Object.defineProperty(kt,"__esModule",{value:!0});kt.isTracerEnabled=kt.trace=kt.log=kt.setLoggerVerbosity=kt.setLogger=kt.getLogger=void 0;var Br=ye(),qk=Ce("process"),Uk=Hf().version,zk={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},Vi=zk,Ps=Br.LogVerbosity.ERROR,Gk=($f=(Kf=process.env.GRPC_NODE_VERBOSITY)!==null&&Kf!==void 0?Kf:process.env.GRPC_VERBOSITY)!==null&&$f!==void 0?$f:"";switch(Gk.toUpperCase()){case"DEBUG":Ps=Br.LogVerbosity.DEBUG;break;case"INFO":Ps=Br.LogVerbosity.INFO;break;case"ERROR":Ps=Br.LogVerbosity.ERROR;break;case"NONE":Ps=Br.LogVerbosity.NONE;break;default:}var jk=()=>Vi;kt.getLogger=jk;var Wk=n=>{Vi=n};kt.setLogger=Wk;var Hk=n=>{Ps=n};kt.setLoggerVerbosity=Hk;var Kk=(n,...e)=>{let t;if(n>=Ps){switch(n){case Br.LogVerbosity.DEBUG:t=Vi.debug;break;case Br.LogVerbosity.INFO:t=Vi.info;break;case Br.LogVerbosity.ERROR:t=Vi.error;break}t||(t=Vi.error),t&&t.bind(Vi)(...e)}};kt.log=Kk;var $k=(Yf=(Qf=process.env.GRPC_NODE_TRACE)!==null&&Qf!==void 0?Qf:process.env.GRPC_TRACE)!==null&&Yf!==void 0?Yf:"",Jf=new Set,RS=new Set;for(let n of $k.split(","))n.startsWith("-")?RS.add(n.substring(1)):Jf.add(n);var Qk=Jf.has("all");function Yk(n,e,t){xS(e)&&(0,kt.log)(n,new Date().toISOString()+" | v"+Uk+" "+qk.pid+" | "+e+" | "+t)}kt.trace=Yk;function xS(n){return!RS.has(n)&&(Qk||Jf.has(n))}kt.isTracerEnabled=xS});var Vc=k(Fs=>{"use strict";Object.defineProperty(Fs,"__esModule",{value:!0});Fs.getErrorCode=Fs.getErrorMessage=void 0;function Jk(n){return n instanceof Error?n.message:String(n)}Fs.getErrorMessage=Jk;function Xk(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}Fs.getErrorCode=Xk});var Ut=k(Uc=>{"use strict";Object.defineProperty(Uc,"__esModule",{value:!0});Uc.Metadata=void 0;var Zk=Ge(),eR=ye(),tR=Vc(),nR=/^[0-9a-z_.-]+$/,rR=/^[ -~]*$/;function iR(n){return nR.test(n)}function sR(n){return rR.test(n)}function NS(n){return n.endsWith("-bin")}function oR(n){return!n.startsWith("grpc-")}function qc(n){return n.toLowerCase()}function MS(n,e){if(!iR(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(NS(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!sR(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var Xf=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=qc(e),MS(e,t),this.internalRepr.set(e,[t])}add(e,t){e=qc(e),MS(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=qc(e),this.internalRepr.delete(e)}get(e){return e=qc(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(aR);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{NS(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(oR(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,tR.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,Zk.log)(eR.LogVerbosity.ERROR,o)}}return t}};Uc.Metadata=Xf;var aR=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var rp=k(zc=>{"use strict";Object.defineProperty(zc,"__esModule",{value:!0});zc.CallCredentials=void 0;var np=Ut();function lR(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var Ls=class n{static createFromMetadataGenerator(e){return new ep(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;lR(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new np.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new tp}};zc.CallCredentials=Ls;var Zf=class n extends Ls{constructor(e){super(),this.creds=e}generateMetadata(e){return C(this,null,function*(){let t=new np.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},ep=class n extends Ls{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new Zf([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},tp=class n extends Ls{generateMetadata(e){return Promise.resolve(new np.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var sp=k(Bs=>{"use strict";Object.defineProperty(Bs,"__esModule",{value:!0});Bs.getDefaultRootsData=Bs.CIPHER_SUITES=void 0;var cR=Ce("fs");Bs.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var OS=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,ip=null;function uR(){return OS?(ip===null&&(ip=cR.readFileSync(OS)),ip):null}Bs.getDefaultRootsData=uR});var Wc=k(jc=>{"use strict";Object.defineProperty(jc,"__esModule",{value:!0});jc.ChannelCredentials=void 0;var dR=Ce("tls"),hR=rp(),PS=sp();function op(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var Vs=class{constructor(e){this.callCredentials=e||hR.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(op(e,"Root certificate"),op(t,"Private key"),op(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,dR.createSecureContext)({ca:(s=e??(0,PS.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:PS.CIPHER_SUITES});return new Gc(o,i??{})}static createFromSecureContext(e,t){return new Gc(e,t??{})}static createInsecure(){return new ap}};jc.ChannelCredentials=Vs;var ap=class n extends Vs{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},Gc=class n extends Vs{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new lp(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},lp=class n extends Vs{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var qr=k(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.validateLoadBalancingConfig=bt.getFirstUsableConfig=bt.isLoadBalancerNameRegistered=bt.createLoadBalancer=bt.registerDefaultLoadBalancerType=bt.registerLoadBalancerType=bt.createChildChannelControlHelper=void 0;function fR(n,e){var t,r,i,s,o,a,l,c,u,d;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(d=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&d!==void 0?d:n.removeChannelzChild.bind(n)}}bt.createChildChannelControlHelper=fR;var Vr={},cp=null;function pR(n,e,t){Vr[n]={LoadBalancer:e,LoadBalancingConfig:t}}bt.registerLoadBalancerType=pR;function mR(n){cp=n}bt.registerDefaultLoadBalancerType=mR;function gR(n,e){let t=n.getLoadBalancerName();return t in Vr?new Vr[t].LoadBalancer(e):null}bt.createLoadBalancer=gR;function yR(n){return n in Vr}bt.isLoadBalancerNameRegistered=yR;function vR(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in Vr)return t;return e&&cp?new Vr[cp].LoadBalancingConfig:null}bt.getFirstUsableConfig=vR;function _R(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in Vr)return Vr[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}bt.validateLoadBalancingConfig=_R});var up=k(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.extractAndSelectServiceConfig=Ur.validateServiceConfig=Ur.validateRetryThrottling=void 0;var SR=Ce("os"),Hc=ye(),bR=qr(),Kc=/^\d+(\.\d{1,9})?s$/,CR="node";function ER(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function wR(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!Kc.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!Kc.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(Hc.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(Hc.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function TR(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!Kc.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(Hc.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(Hc.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function AR(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(ER(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&Kc.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=wR(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=TR(n.hedgingPolicy));return t}function FS(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}Ur.validateRetryThrottling=FS;function LS(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,bR.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(AR(r));"retryThrottling"in n&&(e.retryThrottling=FS(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}Ur.validateServiceConfig=LS;function IR(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:LS(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function DR(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=IR(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===SR.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===CR&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function kR(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return DR(i,e)}return null}Ur.extractAndSelectServiceConfig=kR});var cn=k($c=>{"use strict";Object.defineProperty($c,"__esModule",{value:!0});$c.ConnectivityState=void 0;var BS=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(BS||($c.ConnectivityState=BS={}))});var tn=k(zr=>{"use strict";Object.defineProperty(zr,"__esModule",{value:!0});zr.uriToString=zr.splitHostPort=zr.parseUri=void 0;var RR=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function xR(n){let e=RR.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}zr.parseUri=xR;var VS=/^\d+$/;function MR(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return VS.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?VS.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}zr.splitHostPort=MR;function NR(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}zr.uriToString=NR});var Un=k(un=>{"use strict";Object.defineProperty(un,"__esModule",{value:!0});un.mapUriDefaultScheme=un.getDefaultAuthority=un.createResolver=un.registerDefaultScheme=un.registerResolver=void 0;var hp=tn(),qs={},dp=null;function OR(n,e){qs[n]=e}un.registerResolver=OR;function PR(n){dp=n}un.registerDefaultScheme=PR;function FR(n,e,t){if(n.scheme!==void 0&&n.scheme in qs)return new qs[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,hp.uriToString)(n)}`)}un.createResolver=FR;function LR(n){if(n.scheme!==void 0&&n.scheme in qs)return qs[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,hp.uriToString)(n)}`)}un.getDefaultAuthority=LR;function BR(n){return n.scheme===void 0||!(n.scheme in qs)?dp!==null?{scheme:dp,authority:void 0,path:(0,hp.uriToString)(n)}:null:n}un.mapUriDefaultScheme=BR});var jr=k(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.QueuePicker=Gr.UnavailablePicker=Gr.PickResultType=void 0;var VR=Ut(),qR=ye(),Qc=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(Qc||(Gr.PickResultType=Qc={})),fp=class{constructor(e){this.status=Object.assign({code:qR.Status.UNAVAILABLE,details:"No connection established",metadata:new VR.Metadata},e)}pick(e){return{pickResultType:Qc.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Gr.UnavailablePicker=fp;var pp=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:Qc.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Gr.QueuePicker=pp});var Oa=k(Yc=>{"use strict";Object.defineProperty(Yc,"__esModule",{value:!0});Yc.BackoffTimeout=void 0;var UR=1e3,zR=1.6,GR=12e4,jR=.2;function WR(n,e){return Math.random()*(e-n)+n}var mp=class{constructor(e,t){this.callback=e,this.initialDelay=UR,this.multiplier=zR,this.maxDelay=GR,this.jitter=jR,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+WR(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};Yc.BackoffTimeout=mp});var Xc=k(Jc=>{"use strict";Object.defineProperty(Jc,"__esModule",{value:!0});Jc.ChildLoadBalancerHandler=void 0;var HR=qr(),KR=cn(),$R="child_load_balancer_helper",gp=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===KR.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,HR.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return $R}};Jc.ChildLoadBalancerHandler=gp});var US=k(Zc=>{"use strict";Object.defineProperty(Zc,"__esModule",{value:!0});Zc.ResolvingLoadBalancer=void 0;var QR=qr(),YR=up(),zt=cn(),JR=Un(),Us=jr(),XR=Oa(),yp=ye(),ZR=Ut(),ex=Ge(),tx=ye(),nx=tn(),rx=Xc(),ix="resolving_load_balancer";function qS(n){ex.trace(tx.LogVerbosity.DEBUG,ix,n)}var sx=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function ox(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function ax(n,e,t,r){for(let i of t)if(ox(n,e,i,r))return i;return null}function lx(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of sx){let u=ax(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:yp.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:yp.Status.OK,dynamicFilterFactories:[]}}}var vp=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=zt.ConnectivityState.IDLE,this.latestChildPicker=new Us.QueuePicker(this),this.currentState=zt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,YR.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(zt.ConnectivityState.IDLE,new Us.QueuePicker(this)),this.childLoadBalancer=new rx.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(qS("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,JR.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,d)=>{var f;this.backoffTimeout.stop(),this.backoffTimeout.reset();let v=null;l===null?c===null?(this.previousServiceConfig=null,v=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):v=this.previousServiceConfig:(v=l,this.previousServiceConfig=l);let w=(f=v?.loadBalancingConfig)!==null&&f!==void 0?f:[],A=(0,QR.getFirstUsableConfig)(w,!0);if(A===null){this.handleResolutionFailure({code:yp.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new ZR.Metadata});return}this.childLoadBalancer.updateAddressList(a,A,d);let T=v??this.defaultServiceConfig;this.onSuccessfulResolution(T,u??lx(T))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new XR.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===zt.ConnectivityState.IDLE&&this.updateState(zt.ConnectivityState.CONNECTING,new Us.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){qS((0,nx.uriToString)(this.target)+" "+zt.ConnectivityState[this.currentState]+" -> "+zt.ConnectivityState[e]),e===zt.ConnectivityState.IDLE&&(t=new Us.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===zt.ConnectivityState.IDLE&&(this.updateState(zt.ConnectivityState.TRANSIENT_FAILURE,new Us.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===zt.ConnectivityState.IDLE||this.currentState===zt.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=zt.ConnectivityState.IDLE,this.latestChildPicker=new Us.QueuePicker(this),this.currentState=zt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};Zc.ResolvingLoadBalancer=vp});var zS=k(zs=>{"use strict";Object.defineProperty(zs,"__esModule",{value:!0});zs.channelOptionsEqual=zs.recognizedOptions=void 0;zs.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function cx(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}zs.channelOptionsEqual=cx});var Gn=k(zn=>{"use strict";Object.defineProperty(zn,"__esModule",{value:!0});zn.stringToSubchannelAddress=zn.subchannelAddressToString=zn.subchannelAddressEqual=zn.isTcpSubchannelAddress=void 0;var ux=Ce("net");function Pa(n){return"port"in n}zn.isTcpSubchannelAddress=Pa;function dx(n,e){return!n&&!e?!0:!n||!e?!1:Pa(n)?Pa(e)&&n.host===e.host&&n.port===e.port:!Pa(e)&&n.path===e.path}zn.subchannelAddressEqual=dx;function hx(n){return Pa(n)?n.host+":"+n.port:n.path}zn.subchannelAddressToString=hx;var fx=443;function px(n,e){return(0,ux.isIP)(n)?{host:n,port:e??fx}:{path:n}}zn.stringToSubchannelAddress=px});var eu=k(Gs=>{"use strict";Object.defineProperty(Gs,"__esModule",{value:!0});Gs.addAdminServicesToServer=Gs.registerAdminService=void 0;var GS=[];function mx(n,e){GS.push({getServiceDefinition:n,getHandlers:e})}Gs.registerAdminService=mx;function gx(n){for(let{getServiceDefinition:e,getHandlers:t}of GS)n.addService(e(),t())}Gs.addAdminServicesToServer=gx});var jS=k(dn=>{"use strict";Object.defineProperty(dn,"__esModule",{value:!0});dn.ClientDuplexStreamImpl=dn.ClientWritableStreamImpl=dn.ClientReadableStreamImpl=dn.ClientUnaryCallImpl=dn.callErrorFromStatus=void 0;var yx=Ce("events"),Ep=Ce("stream"),Fa=ye();function vx(n,e){let t=`${n.code} ${Fa.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}dn.callErrorFromStatus=vx;var _p=class extends yx.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Fa.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};dn.ClientUnaryCallImpl=_p;var Sp=class extends Ep.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Fa.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};dn.ClientReadableStreamImpl=Sp;var bp=class extends Ep.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Fa.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};dn.ClientWritableStreamImpl=bp;var Cp=class extends Ep.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Fa.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};dn.ClientDuplexStreamImpl=Cp});var WS=k(js=>{"use strict";Object.defineProperty(js,"__esModule",{value:!0});js.InterceptingListenerImpl=js.isInterceptingListener=void 0;function _x(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}js.isInterceptingListener=_x;var wp=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};js.InterceptingListenerImpl=wp});var xp=k(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.getInterceptingCall=hn.InterceptingCall=hn.RequesterBuilder=hn.ListenerBuilder=hn.InterceptorConfigurationError=void 0;var Sx=Ut(),HS=WS(),KS=ye(),$S=Vc(),Ba=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};hn.InterceptorConfigurationError=Ba;var Ap=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};hn.ListenerBuilder=Ap;var Ip=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};hn.RequesterBuilder=Ip;var Tp={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},La={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},Dp=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:La.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:La.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:La.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:La.cancel}:this.requester=La}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,d)=>{var f,v,w;this.processingMetadata=!1;let A;if((0,HS.isInterceptingListener)(d))A=d;else{let T={onReceiveMetadata:(f=d.onReceiveMetadata)!==null&&f!==void 0?f:Tp.onReceiveMetadata,onReceiveMessage:(v=d.onReceiveMessage)!==null&&v!==void 0?v:Tp.onReceiveMessage,onReceiveStatus:(w=d.onReceiveStatus)!==null&&w!==void 0?w:Tp.onReceiveStatus};A=new HS.InterceptingListenerImpl(T,c)}this.nextCall.start(u,A),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};hn.InterceptingCall=Dp;function bx(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var tu=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(KS.Status.INTERNAL,`Request message serialization failure: ${(0,$S.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:KS.Status.INTERNAL,details:`Response message parsing error: ${(0,$S.getErrorMessage)(a)}`,metadata:new Sx.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},kp=class extends tu{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},Rp=class extends tu{};function Cx(n,e,t){let r=bx(n,t.path,e);return t.responseStream?new Rp(r,t):new kp(r,t)}function Ex(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new Ba("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new Ba("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>Cx(r,a,e))(s)}hn.getInterceptingCall=Ex});var Op=k(ru=>{"use strict";Object.defineProperty(ru,"__esModule",{value:!0});ru.Client=void 0;var jn=jS(),wx=Pp(),Tx=cn(),Wr=ye(),Ws=Ut(),nu=xp(),En=Symbol(),Hs=Symbol(),Ks=Symbol(),fr=Symbol();function Mp(n){return typeof n=="function"}function $s(n){return n.stack.split(`
`).slice(1).join(`
`)}var Np=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[Hs]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[Ks]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[Hs].length>0&&this[Ks].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[fr]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[En]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[En]=o(e,t,r)}else this[En]=new wx.ChannelImplementation(e,t,r)}close(){this[En].close()}getChannel(){return this[En]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[En].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===Tx.ConnectivityState.READY)t();else try{this[En].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(Mp(e))return{metadata:new Ws.Metadata,options:{},callback:e};if(Mp(t))return e instanceof Ws.Metadata?{metadata:e,options:{},callback:t}:{metadata:new Ws.Metadata,options:e,callback:t};if(!(e instanceof Ws.Metadata&&t instanceof Object&&Mp(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),d={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},f={argument:i,metadata:u.metadata,call:new jn.ClientUnaryCallImpl,channel:this[En],methodDefinition:d,callOptions:u.options,callback:u.callback};this[fr]&&(f=this[fr](f));let v=f.call,w={clientInterceptors:this[Hs],clientInterceptorProviders:this[Ks],callInterceptors:(l=f.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=f.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},A=(0,nu.getInterceptingCall)(w,f.methodDefinition,f.callOptions,f.channel);v.call=A;let T=null,O=!1,D=new Error;return A.start(f.metadata,{onReceiveMetadata:P=>{v.emit("metadata",P)},onReceiveMessage(P){T!==null&&A.cancelWithStatus(Wr.Status.INTERNAL,"Too many responses received"),T=P},onReceiveStatus(P){if(!O){if(O=!0,P.code===Wr.Status.OK)if(T===null){let F=$s(D);f.callback((0,jn.callErrorFromStatus)({code:Wr.Status.INTERNAL,details:"No message received",metadata:P.metadata},F))}else f.callback(null,T);else{let F=$s(D);f.callback((0,jn.callErrorFromStatus)(P,F))}D=null,v.emit("status",P)}}}),A.sendMessage(i),A.halfClose(),v}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},d={metadata:c.metadata,call:new jn.ClientWritableStreamImpl(t),channel:this[En],methodDefinition:u,callOptions:c.options,callback:c.callback};this[fr]&&(d=this[fr](d));let f=d.call,v={clientInterceptors:this[Hs],clientInterceptorProviders:this[Ks],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},w=(0,nu.getInterceptingCall)(v,d.methodDefinition,d.callOptions,d.channel);f.call=w;let A=null,T=!1,O=new Error;return w.start(d.metadata,{onReceiveMetadata:D=>{f.emit("metadata",D)},onReceiveMessage(D){A!==null&&w.cancelWithStatus(Wr.Status.INTERNAL,"Too many responses received"),A=D},onReceiveStatus(D){if(!T){if(T=!0,D.code===Wr.Status.OK)if(A===null){let P=$s(O);d.callback((0,jn.callErrorFromStatus)({code:Wr.Status.INTERNAL,details:"No message received",metadata:D.metadata},P))}else d.callback(null,A);else{let P=$s(O);d.callback((0,jn.callErrorFromStatus)(D,P))}O=null,f.emit("status",D)}}}),f}checkMetadataAndOptions(e,t){let r,i;return e instanceof Ws.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new Ws.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},d={argument:i,metadata:c.metadata,call:new jn.ClientReadableStreamImpl(r),channel:this[En],methodDefinition:u,callOptions:c.options};this[fr]&&(d=this[fr](d));let f=d.call,v={clientInterceptors:this[Hs],clientInterceptorProviders:this[Ks],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},w=(0,nu.getInterceptingCall)(v,d.methodDefinition,d.callOptions,d.channel);f.call=w;let A=!1,T=new Error;return w.start(d.metadata,{onReceiveMetadata(O){f.emit("metadata",O)},onReceiveMessage(O){f.push(O)},onReceiveStatus(O){if(!A){if(A=!0,f.push(null),O.code!==Wr.Status.OK){let D=$s(T);f.emit("error",(0,jn.callErrorFromStatus)(O,D))}T=null,f.emit("status",O)}}}),w.sendMessage(i),w.halfClose(),f}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new jn.ClientDuplexStreamImpl(t,r),channel:this[En],methodDefinition:c,callOptions:l.options};this[fr]&&(u=this[fr](u));let d=u.call,f={clientInterceptors:this[Hs],clientInterceptorProviders:this[Ks],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},v=(0,nu.getInterceptingCall)(f,u.methodDefinition,u.callOptions,u.channel);d.call=v;let w=!1,A=new Error;return v.start(u.metadata,{onReceiveMetadata(T){d.emit("metadata",T)},onReceiveMessage(T){d.push(T)},onReceiveStatus(T){if(!w){if(w=!0,d.push(null),T.code!==Wr.Status.OK){let O=$s(A);d.emit("error",(0,jn.callErrorFromStatus)(T,O))}A=null,d.emit("status",T)}}}),d}};ru.Client=Np});var Lp=k(Qs=>{"use strict";Object.defineProperty(Qs,"__esModule",{value:!0});Qs.loadPackageDefinition=Qs.makeClientConstructor=void 0;var Va=Op(),Ax={unary:Va.Client.prototype.makeUnaryRequest,server_stream:Va.Client.prototype.makeServerStreamRequest,client_stream:Va.Client.prototype.makeClientStreamRequest,bidi:Va.Client.prototype.makeBidiStreamRequest};function Fp(n){return["__proto__","prototype","constructor"].includes(n)}function QS(n,e,t){t||(t={});class r extends Va.Client{}return Object.keys(n).forEach(i=>{if(Fp(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=Ix(Ax[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!Fp(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}Qs.makeClientConstructor=QS;function Ix(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function Dx(n){return"format"in n}function kx(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>Fp(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];Dx(r)?o[s]=r:o[s]=QS(r,s,{})}return e}Qs.loadPackageDefinition=kx});var Sb=k((yG,_b)=>{"use strict";var Rx=1/0,xx="[object Symbol]",Mx=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Nx=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,su="\\ud800-\\udfff",rb="\\u0300-\\u036f\\ufe20-\\ufe23",ib="\\u20d0-\\u20f0",sb="\\u2700-\\u27bf",ob="a-z\\xdf-\\xf6\\xf8-\\xff",Ox="\\xac\\xb1\\xd7\\xf7",Px="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Fx="\\u2000-\\u206f",Lx=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ab="A-Z\\xc0-\\xd6\\xd8-\\xde",lb="\\ufe0e\\ufe0f",cb=Ox+Px+Fx+Lx,Vp="['\u2019]",Bx="["+su+"]",YS="["+cb+"]",iu="["+rb+ib+"]",ub="\\d+",Vx="["+sb+"]",db="["+ob+"]",hb="[^"+su+cb+ub+sb+ob+ab+"]",Bp="\\ud83c[\\udffb-\\udfff]",qx="(?:"+iu+"|"+Bp+")",fb="[^"+su+"]",qp="(?:\\ud83c[\\udde6-\\uddff]){2}",Up="[\\ud800-\\udbff][\\udc00-\\udfff]",Ys="["+ab+"]",pb="\\u200d",JS="(?:"+db+"|"+hb+")",Ux="(?:"+Ys+"|"+hb+")",XS="(?:"+Vp+"(?:d|ll|m|re|s|t|ve))?",ZS="(?:"+Vp+"(?:D|LL|M|RE|S|T|VE))?",mb=qx+"?",gb="["+lb+"]?",zx="(?:"+pb+"(?:"+[fb,qp,Up].join("|")+")"+gb+mb+")*",yb=gb+mb+zx,Gx="(?:"+[Vx,qp,Up].join("|")+")"+yb,jx="(?:"+[fb+iu+"?",iu,qp,Up,Bx].join("|")+")",Wx=RegExp(Vp,"g"),Hx=RegExp(iu,"g"),Kx=RegExp(Bp+"(?="+Bp+")|"+jx+yb,"g"),$x=RegExp([Ys+"?"+db+"+"+XS+"(?="+[YS,Ys,"$"].join("|")+")",Ux+"+"+ZS+"(?="+[YS,Ys+JS,"$"].join("|")+")",Ys+"?"+JS+"+"+XS,Ys+"+"+ZS,ub,Gx].join("|"),"g"),Qx=RegExp("["+pb+su+rb+ib+lb+"]"),Yx=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Jx={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},Xx=typeof global=="object"&&global&&global.Object===Object&&global,Zx=typeof self=="object"&&self&&self.Object===Object&&self,eM=Xx||Zx||Function("return this")();function tM(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function nM(n){return n.split("")}function rM(n){return n.match(Mx)||[]}function iM(n){return function(e){return n?.[e]}}var sM=iM(Jx);function vb(n){return Qx.test(n)}function oM(n){return Yx.test(n)}function aM(n){return vb(n)?lM(n):nM(n)}function lM(n){return n.match(Kx)||[]}function cM(n){return n.match($x)||[]}var uM=Object.prototype,dM=uM.toString,eb=eM.Symbol,tb=eb?eb.prototype:void 0,nb=tb?tb.toString:void 0;function hM(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function fM(n){if(typeof n=="string")return n;if(vM(n))return nb?nb.call(n):"";var e=n+"";return e=="0"&&1/n==-Rx?"-0":e}function pM(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:hM(n,e,t)}function mM(n){return function(e){e=ou(e);var t=vb(e)?aM(e):void 0,r=t?t[0]:e.charAt(0),i=t?pM(t,1).join(""):e.slice(1);return r[n]()+i}}function gM(n){return function(e){return tM(EM(bM(e).replace(Wx,"")),n,"")}}function yM(n){return!!n&&typeof n=="object"}function vM(n){return typeof n=="symbol"||yM(n)&&dM.call(n)==xx}function ou(n){return n==null?"":fM(n)}var _M=gM(function(n,e,t){return e=e.toLowerCase(),n+(t?SM(e):e)});function SM(n){return CM(ou(n).toLowerCase())}function bM(n){return n=ou(n),n&&n.replace(Nx,sM).replace(Hx,"")}var CM=mM("toUpperCase");function EM(n,e,t){return n=ou(n),e=t?void 0:e,e===void 0?oM(n)?cM(n):rM(n):n.match(e)||[]}_b.exports=_M});var zp=k((vG,bb)=>{"use strict";bb.exports=wM;function wM(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var d=new Array(arguments.length-1),f=0;f<d.length;)d[f++]=arguments[f];a.apply(null,d)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var Tb=k(wb=>{"use strict";var au=wb;au.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var Js=new Array(64),Eb=new Array(123);for(wn=0;wn<64;)Eb[Js[wn]=wn<26?wn+65:wn<52?wn+71:wn<62?wn-4:wn-59|43]=wn++;var wn;au.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=Js[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=Js[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=Js[l|c>>6],s[o++]=Js[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=Js[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var Cb="invalid encoding";au.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=Eb[l])===void 0)throw Error(Cb);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(Cb);return r-i};au.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var Ib=k((SG,Ab)=>{"use strict";Ab.exports=lu;function lu(){this._listeners={}}lu.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};lu.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};lu.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var Ob=k((bG,Nb)=>{"use strict";Nb.exports=Db(Db);function Db(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,kb),n.writeFloatBE=e.bind(null,Rb);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,xb),n.readFloatBE=t.bind(null,Mb)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var d=Math.floor(Math.log(o)/Math.LN2);d===1024&&(d=1023),u=o*Math.pow(2,-d),r(u*4503599627370496>>>0,a,l+i),r((c<<31|d+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,kb,0,4),n.writeDoubleBE=e.bind(null,Rb,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,d=c>>>20&2047,f=4294967296*(c&1048575)+l;return d===2047?f?NaN:u*(1/0):d===0?u*5e-324*f:u*Math.pow(2,d-1075)*(f+4503599627370496)}n.readDoubleLE=t.bind(null,xb,0,4),n.readDoubleBE=t.bind(null,Mb,4,0)}(),n}function kb(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function Rb(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function xb(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function Mb(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var Gp=k((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var Fb=k(Pb=>{"use strict";var jp=Pb;jp.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};jp.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};jp.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var Bb=k((EG,Lb)=>{"use strict";Lb.exports=TM;function TM(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var qb=k((wG,Vb)=>{"use strict";Vb.exports=ht;var qa=Wn();function ht(n,e){this.lo=n>>>0,this.hi=e>>>0}var qi=ht.zero=new ht(0,0);qi.toNumber=function(){return 0};qi.zzEncode=qi.zzDecode=function(){return this};qi.length=function(){return 1};var AM=ht.zeroHash="\0\0\0\0\0\0\0\0";ht.fromNumber=function(e){if(e===0)return qi;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new ht(r,i)};ht.from=function(e){if(typeof e=="number")return ht.fromNumber(e);if(qa.isString(e))if(qa.Long)e=qa.Long.fromString(e);else return ht.fromNumber(parseInt(e,10));return e.low||e.high?new ht(e.low>>>0,e.high>>>0):qi};ht.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};ht.prototype.toLong=function(e){return qa.Long?new qa.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Hr=String.prototype.charCodeAt;ht.fromHash=function(e){return e===AM?qi:new ht((Hr.call(e,0)|Hr.call(e,1)<<8|Hr.call(e,2)<<16|Hr.call(e,3)<<24)>>>0,(Hr.call(e,4)|Hr.call(e,5)<<8|Hr.call(e,6)<<16|Hr.call(e,7)<<24)>>>0)};ht.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};ht.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};ht.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};ht.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var Wn=k(Wp=>{"use strict";var $=Wp;$.asPromise=zp();$.base64=Tb();$.EventEmitter=Ib();$.float=Ob();$.inquire=Gp();$.utf8=Fb();$.pool=Bb();$.LongBits=qb();$.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);$.global=$.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||Wp;$.emptyArray=Object.freeze?Object.freeze([]):[];$.emptyObject=Object.freeze?Object.freeze({}):{};$.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};$.isString=function(e){return typeof e=="string"||e instanceof String};$.isObject=function(e){return e&&typeof e=="object"};$.isset=$.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};$.Buffer=function(){try{var n=$.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();$._Buffer_from=null;$._Buffer_allocUnsafe=null;$.newBuffer=function(e){return typeof e=="number"?$.Buffer?$._Buffer_allocUnsafe(e):new $.Array(e):$.Buffer?$._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};$.Array=typeof Uint8Array<"u"?Uint8Array:Array;$.Long=$.global.dcodeIO&&$.global.dcodeIO.Long||$.global.Long||$.inquire("long");$.key2Re=/^true|false|0|1$/;$.key32Re=/^-?(?:0|[1-9][0-9]*)$/;$.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;$.longToHash=function(e){return e?$.LongBits.from(e).toHash():$.LongBits.zeroHash};$.longFromHash=function(e,t){var r=$.LongBits.fromHash(e);return $.Long?$.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function Ub(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}$.merge=Ub;$.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function zb(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&Ub(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}$.newError=zb;$.ProtocolError=zb("ProtocolError");$.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};$.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};$.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};$._configure=function(){var n=$.Buffer;if(!n){$._Buffer_from=$._Buffer_allocUnsafe=null;return}$._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},$._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var uu=k((AG,Hb)=>{"use strict";Hb.exports=he;var fn=Wn(),Hp,cu=fn.LongBits,Gb=fn.base64,jb=fn.utf8;function Ua(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function $p(){}function IM(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function he(){this.len=0,this.head=new Ua($p,0,0),this.tail=this.head,this.states=null}var Wb=function(){return fn.Buffer?function(){return(he.create=function(){return new Hp})()}:function(){return new he}};he.create=Wb();he.alloc=function(e){return new fn.Array(e)};fn.Array!==Array&&(he.alloc=fn.pool(he.alloc,fn.Array.prototype.subarray));he.prototype._push=function(e,t,r){return this.tail=this.tail.next=new Ua(e,t,r),this.len+=t,this};function Qp(n,e,t){e[t]=n&255}function DM(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function Yp(n,e){this.len=n,this.next=void 0,this.val=e}Yp.prototype=Object.create(Ua.prototype);Yp.prototype.fn=DM;he.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Yp((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};he.prototype.int32=function(e){return e<0?this._push(Jp,10,cu.fromNumber(e)):this.uint32(e)};he.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Jp(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}he.prototype.uint64=function(e){var t=cu.from(e);return this._push(Jp,t.length(),t)};he.prototype.int64=he.prototype.uint64;he.prototype.sint64=function(e){var t=cu.from(e).zzEncode();return this._push(Jp,t.length(),t)};he.prototype.bool=function(e){return this._push(Qp,1,e?1:0)};function Kp(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}he.prototype.fixed32=function(e){return this._push(Kp,4,e>>>0)};he.prototype.sfixed32=he.prototype.fixed32;he.prototype.fixed64=function(e){var t=cu.from(e);return this._push(Kp,4,t.lo)._push(Kp,4,t.hi)};he.prototype.sfixed64=he.prototype.fixed64;he.prototype.float=function(e){return this._push(fn.float.writeFloatLE,4,e)};he.prototype.double=function(e){return this._push(fn.float.writeDoubleLE,8,e)};var kM=fn.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};he.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Qp,1,0);if(fn.isString(e)){var r=he.alloc(t=Gb.length(e));Gb.decode(e,r,0),e=r}return this.uint32(t)._push(kM,t,e)};he.prototype.string=function(e){var t=jb.length(e);return t?this.uint32(t)._push(jb.write,t,e):this._push(Qp,1,0)};he.prototype.fork=function(){return this.states=new IM(this),this.head=this.tail=new Ua($p,0,0),this.len=0,this};he.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ua($p,0,0),this.len=0),this};he.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};he.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};he._configure=function(n){Hp=n,he.create=Wb(),Hp._configure()}});var Qb=k((IG,$b)=>{"use strict";$b.exports=Hn;var Kb=uu();(Hn.prototype=Object.create(Kb.prototype)).constructor=Hn;var Kr=Wn();function Hn(){Kb.call(this)}Hn._configure=function(){Hn.alloc=Kr._Buffer_allocUnsafe,Hn.writeBytesBuffer=Kr.Buffer&&Kr.Buffer.prototype instanceof Uint8Array&&Kr.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};Hn.prototype.bytes=function(e){Kr.isString(e)&&(e=Kr._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Hn.writeBytesBuffer,t,e),this};function RM(n,e,t){n.length<40?Kr.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}Hn.prototype.string=function(e){var t=Kr.Buffer.byteLength(e);return this.uint32(t),t&&this._push(RM,t,e),this};Hn._configure()});var hu=k((DG,eC)=>{"use strict";eC.exports=Je;var Tn=Wn(),Zp,Xb=Tn.LongBits,xM=Tn.utf8;function An(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function Je(n){this.buf=n,this.pos=0,this.len=n.length}var Yb=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Je(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Je(e);throw Error("illegal buffer")},Zb=function(){return Tn.Buffer?function(t){return(Je.create=function(i){return Tn.Buffer.isBuffer(i)?new Zp(i):Yb(i)})(t)}:Yb};Je.create=Zb();Je.prototype._slice=Tn.Array.prototype.subarray||Tn.Array.prototype.slice;Je.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,An(this,10);return e}}();Je.prototype.int32=function(){return this.uint32()|0};Je.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Xp(){var n=new Xb(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw An(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw An(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}Je.prototype.bool=function(){return this.uint32()!==0};function du(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}Je.prototype.fixed32=function(){if(this.pos+4>this.len)throw An(this,4);return du(this.buf,this.pos+=4)};Je.prototype.sfixed32=function(){if(this.pos+4>this.len)throw An(this,4);return du(this.buf,this.pos+=4)|0};function Jb(){if(this.pos+8>this.len)throw An(this,8);return new Xb(du(this.buf,this.pos+=4),du(this.buf,this.pos+=4))}Je.prototype.float=function(){if(this.pos+4>this.len)throw An(this,4);var e=Tn.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Je.prototype.double=function(){if(this.pos+8>this.len)throw An(this,4);var e=Tn.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Je.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw An(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=Tn.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};Je.prototype.string=function(){var e=this.bytes();return xM.read(e,0,e.length)};Je.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw An(this,e);this.pos+=e}else do if(this.pos>=this.len)throw An(this);while(this.buf[this.pos++]&128);return this};Je.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};Je._configure=function(n){Zp=n,Je.create=Zb(),Zp._configure();var e=Tn.Long?"toLong":"toNumber";Tn.merge(Je.prototype,{int64:function(){return Xp.call(this)[e](!1)},uint64:function(){return Xp.call(this)[e](!0)},sint64:function(){return Xp.call(this).zzDecode()[e](!1)},fixed64:function(){return Jb.call(this)[e](!0)},sfixed64:function(){return Jb.call(this)[e](!1)}})}});var iC=k((kG,rC)=>{"use strict";rC.exports=Ui;var nC=hu();(Ui.prototype=Object.create(nC.prototype)).constructor=Ui;var tC=Wn();function Ui(n){nC.call(this,n)}Ui._configure=function(){tC.Buffer&&(Ui.prototype._slice=tC.Buffer.prototype.slice)};Ui.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Ui._configure()});var oC=k((RG,sC)=>{"use strict";sC.exports=za;var em=Wn();(za.prototype=Object.create(em.EventEmitter.prototype)).constructor=za;function za(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");em.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}za.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return em.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};za.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var tm=k(aC=>{"use strict";var MM=aC;MM.Service=oC()});var nm=k((MG,lC)=>{"use strict";lC.exports={}});var dC=k(uC=>{"use strict";var Gt=uC;Gt.build="minimal";Gt.Writer=uu();Gt.BufferWriter=Qb();Gt.Reader=hu();Gt.BufferReader=iC();Gt.util=Wn();Gt.rpc=tm();Gt.roots=nm();Gt.configure=cC;function cC(){Gt.util._configure(),Gt.Writer._configure(Gt.BufferWriter),Gt.Reader._configure(Gt.BufferReader)}cC()});var fC=k((OG,hC)=>{"use strict";hC.exports=rm;function rm(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(rm.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var d=new Array(arguments.length-1),f=0;f<d.length;)d[f]=arguments[++f];if(f=0,s=s.replace(/%([%dfijs])/g,function(w,A){var T=d[f++];switch(A){case"d":case"f":return String(Number(T));case"i":return String(Math.floor(T));case"j":return JSON.stringify(T);case"s":return String(T)}return"%"}),f!==d.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}rm.verbose=!1});var mC=k((PG,pC)=>{"use strict";pC.exports=Ga;var NM=zp(),OM=Gp(),im=OM("fs");function Ga(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&im&&im.readFile?im.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?Ga.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):Ga.xhr(n,e,t):NM(Ga,this,n,e)}Ga.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var vC=k(yC=>{"use strict";var om=yC,gC=om.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},sm=om.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=gC(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};om.resolve=function(e,t,r){return r||(t=sm(t)),gC(t)?t:(r||(e=sm(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?sm(e+"/"+t):t)}});var zi=k(_C=>{"use strict";var ja=_C,PM=ft(),FM=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Wa(n,e){var t=0,r={};for(e|=0;t<n.length;)r[FM[t+e]]=n[t++];return r}ja.basic=Wa([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);ja.defaults=Wa([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",PM.emptyArray,null]);ja.long=Wa([0,0,0,1,1],7);ja.mapKey=Wa([0,0,0,5,5,0,0,0,1,1,0,2],2);ja.packed=Wa([1,5,0,0,0,5,5,0,0,0,1,1,0])});var $r=k((BG,CC)=>{"use strict";CC.exports=pn;var fu=Gi();((pn.prototype=Object.create(fu.prototype)).constructor=pn).className="Field";var SC=In(),bC=zi(),it=ft(),am,LM=/^required|optional|repeated$/;pn.fromJSON=function(e,t){return new pn(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function pn(n,e,t,r,i,s,o){if(it.isObject(r)?(o=i,s=r,r=i=void 0):it.isObject(i)&&(o=s,s=i,i=void 0),fu.call(this,n,s),!it.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!it.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!LM.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!it.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=it.Long?bC.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(pn.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});pn.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),fu.prototype.setOption.call(this,e,t,r)};pn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return it.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};pn.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=bC.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof am?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof SC&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof SC))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=it.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;it.base64.test(this.typeDefault)?it.base64.decode(this.typeDefault,e=it.newBuffer(it.base64.length(this.typeDefault)),0):it.utf8.write(this.typeDefault,e=it.newBuffer(it.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=it.emptyObject:this.repeated?this.defaultValue=it.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof am&&(this.parent.ctor.prototype[this.name]=this.defaultValue),fu.prototype.resolve.call(this)};pn.d=function(e,t,r,i){return typeof t=="function"?t=it.decorateType(t).name:t&&typeof t=="object"&&(t=it.decorateEnum(t).name),function(o,a){it.decorateType(o.constructor).add(new pn(a,e,t,r,{default:i}))}};pn._configure=function(e){am=e}});var Xs=k((VG,TC)=>{"use strict";TC.exports=mn;var mu=Gi();((mn.prototype=Object.create(mu.prototype)).constructor=mn).className="OneOf";var EC=$r(),pu=ft();function mn(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),mu.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}mn.fromJSON=function(e,t){return new mn(e,t.oneof,t.options,t.comment)};mn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return pu.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function wC(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}mn.prototype.add=function(e){if(!(e instanceof EC))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,wC(this),this};mn.prototype.remove=function(e){if(!(e instanceof EC))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};mn.prototype.onAdd=function(e){mu.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}wC(this)};mn.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);mu.prototype.onRemove.call(this,e)};mn.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){pu.decorateType(i.constructor).add(new mn(s,e)),Object.defineProperty(i,s,{get:pu.oneOfGetter(e),set:pu.oneOfSetter(e)})}}});var to=k((qG,kC)=>{"use strict";kC.exports=pe;var lm=Gi();((pe.prototype=Object.create(lm.prototype)).constructor=pe).className="Namespace";var AC=$r(),gu=ft(),BM=Xs(),Zs,Ha,eo;pe.fromJSON=function(e,t){return new pe(e,t.options).addJSON(t.nested)};function IC(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}pe.arrayToJSON=IC;pe.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};pe.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function pe(n,e){lm.call(this,n,e),this.nested=void 0,this._nestedArray=null}function DC(n){return n._nestedArray=null,n}Object.defineProperty(pe.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=gu.toArray(this.nested))}});pe.prototype.toJSON=function(e){return gu.toObject(["options",this.options,"nested",IC(this.nestedArray,e)])};pe.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?Zs.fromJSON:s.values!==void 0?eo.fromJSON:s.methods!==void 0?Ha.fromJSON:s.id!==void 0?AC.fromJSON:pe.fromJSON)(r[i],s));return this};pe.prototype.get=function(e){return this.nested&&this.nested[e]||null};pe.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof eo)return this.nested[e].values;throw Error("no such enum: "+e)};pe.prototype.add=function(e){if(!(e instanceof AC&&e.extend!==void 0||e instanceof Zs||e instanceof BM||e instanceof eo||e instanceof Ha||e instanceof pe))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof pe&&e instanceof pe&&!(t instanceof Zs||t instanceof Ha)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),DC(this)};pe.prototype.remove=function(e){if(!(e instanceof lm))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),DC(this)};pe.prototype.define=function(e,t){if(gu.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof pe))throw Error("path conflicts with non-namespace objects")}else r.add(r=new pe(i))}return t&&r.addJSON(t),r};pe.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof pe?e[t++].resolveAll():e[t++].resolve();return this.resolve()};pe.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),gu.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof pe&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof pe&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};pe.prototype.lookupType=function(e){var t=this.lookup(e,[Zs]);if(!t)throw Error("no such type: "+e);return t};pe.prototype.lookupEnum=function(e){var t=this.lookup(e,[eo]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};pe.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[Zs,eo]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};pe.prototype.lookupService=function(e){var t=this.lookup(e,[Ha]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};pe._configure=function(n,e,t){Zs=n,Ha=e,eo=t}});var yu=k((UG,RC)=>{"use strict";RC.exports=pr;var cm=$r();((pr.prototype=Object.create(cm.prototype)).constructor=pr).className="MapField";var VM=zi(),Ka=ft();function pr(n,e,t,r,i,s){if(cm.call(this,n,e,r,void 0,void 0,i,s),!Ka.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}pr.fromJSON=function(e,t){return new pr(e,t.id,t.keyType,t.type,t.options,t.comment)};pr.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Ka.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};pr.prototype.resolve=function(){if(this.resolved)return this;if(VM.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return cm.prototype.resolve.call(this)};pr.d=function(e,t,r){return typeof r=="function"?r=Ka.decorateType(r).name:r&&typeof r=="object"&&(r=Ka.decorateEnum(r).name),function(s,o){Ka.decorateType(s.constructor).add(new pr(o,e,t,r))}}});var vu=k((zG,xC)=>{"use strict";xC.exports=ji;var um=Gi();((ji.prototype=Object.create(um.prototype)).constructor=ji).className="Method";var no=ft();function ji(n,e,t,r,i,s,o,a,l){if(no.isObject(i)?(o=i,i=s=void 0):no.isObject(s)&&(o=s,s=void 0),!(e===void 0||no.isString(e)))throw TypeError("type must be a string");if(!no.isString(t))throw TypeError("requestType must be a string");if(!no.isString(r))throw TypeError("responseType must be a string");um.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}ji.fromJSON=function(e,t){return new ji(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};ji.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return no.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};ji.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),um.prototype.resolve.call(this))}});var _u=k((GG,NC)=>{"use strict";NC.exports=gn;var Qr=to();((gn.prototype=Object.create(Qr.prototype)).constructor=gn).className="Service";var dm=vu(),$a=ft(),qM=tm();function gn(n,e){Qr.call(this,n,e),this.methods={},this._methodsArray=null}gn.fromJSON=function(e,t){var r=new gn(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(dm.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};gn.prototype.toJSON=function(e){var t=Qr.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return $a.toObject(["options",t&&t.options||void 0,"methods",Qr.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(gn.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=$a.toArray(this.methods))}});function MC(n){return n._methodsArray=null,n}gn.prototype.get=function(e){return this.methods[e]||Qr.prototype.get.call(this,e)};gn.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return Qr.prototype.resolve.call(this)};gn.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof dm?(this.methods[e.name]=e,e.parent=this,MC(this)):Qr.prototype.add.call(this,e)};gn.prototype.remove=function(e){if(e instanceof dm){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,MC(this)}return Qr.prototype.remove.call(this,e)};gn.prototype.create=function(e,t,r){for(var i=new qM.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=$a.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=$a.codegen(["r","c"],$a.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var Su=k((jG,OC)=>{"use strict";OC.exports=Kn;var UM=Wn();function Kn(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}Kn.create=function(e){return this.$type.create(e)};Kn.encode=function(e,t){return this.$type.encode(e,t)};Kn.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};Kn.decode=function(e){return this.$type.decode(e)};Kn.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};Kn.verify=function(e){return this.$type.verify(e)};Kn.fromObject=function(e){return this.$type.fromObject(e)};Kn.toObject=function(e,t){return this.$type.toObject(e,t)};Kn.prototype.toJSON=function(){return this.$type.toObject(this,UM.toJSONOptions)}});var hm=k((WG,FC)=>{"use strict";FC.exports=jM;var zM=In(),mr=zi(),PC=ft();function GM(n){return"missing required '"+n.name+"'"}function jM(n){var e=PC.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof zM?"int32":r.type,s="m"+PC.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),mr.defaults[r.keyType]!==void 0?e("k=%j",mr.defaults[r.keyType]):e("k=null"),mr.defaults[i]!==void 0?e("value=%j",mr.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),mr.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),mr.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),mr.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),mr.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):mr.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",GM(o))}return e("return m")}});var mm=k((HG,LC)=>{"use strict";LC.exports=KM;var WM=In(),fm=ft();function yn(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function pm(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof WM){n("switch(%s){",r)("default:")("return%j",yn(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",yn(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",yn(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",yn(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",yn(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",yn(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",yn(e,"buffer"));break}return n}function HM(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",yn(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",yn(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",yn(e,"boolean key"));break}return n}function KM(n){var e=fm.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+fm.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",yn(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),HM(e,s,"k[i]"),pm(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",yn(s,"array"))("for(var i=0;i<%s.length;++i){",o),pm(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=fm.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}pm(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var vm=k(VC=>{"use strict";var BC=VC,Qa=In(),$n=ft();function gm(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof Qa){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}BC.fromObject=function(e){var t=e.fieldsArray,r=$n.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=$n.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),gm(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),gm(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof Qa||r("if(d%s!=null){",o),gm(r,s,i,o),s.resolvedType instanceof Qa||r("}"))}return r("return m")};function ym(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof Qa?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}BC.toObject=function(e){var t=e.fieldsArray.slice().sort($n.compareFieldsById);if(!t.length)return $n.codegen()("return {}");for(var r=$n.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",$n.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",$n.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=$n.safeProp(l.name);if(l.resolvedType instanceof Qa)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var d=!1;for(a=0;a<t.length;++a){var l=t[a],f=e._fieldsArray.indexOf(l),c=$n.safeProp(l.name);l.map?(d||(d=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),ym(r,l,f,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),ym(r,l,f,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),ym(r,l,f,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",$n.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var _m=k(qC=>{"use strict";var $M=qC,QM=Su();$M[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof QM){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var Eu=k((QG,zC)=>{"use strict";zC.exports=ke;var Dn=to();((ke.prototype=Object.create(Dn.prototype)).constructor=ke).className="Type";var YM=In(),Cm=Xs(),bu=$r(),JM=yu(),XM=_u(),Sm=Su(),bm=hu(),ZM=uu(),Ct=ft(),eN=Em(),tN=hm(),nN=mm(),UC=vm(),rN=_m();function ke(n,e){Dn.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(ke.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Ct.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Ct.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=ke.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof Sm||((n.prototype=new Sm).constructor=n,Ct.merge(n.prototype,e)),n.$type=n.prototype.$type=this,Ct.merge(n,Sm,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:Ct.oneOfGetter(this._oneofsArray[t].oneof),set:Ct.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});ke.generateConstructor=function(e){for(var t=Ct.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",Ct.safeProp(i.name)):i.repeated&&t("this%s=[]",Ct.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function Cu(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}ke.fromJSON=function(e,t){var r=new ke(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?JM.fromJSON:bu.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(Cm.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?bu.fromJSON:o.fields!==void 0?ke.fromJSON:o.values!==void 0?YM.fromJSON:o.methods!==void 0?XM.fromJSON:Dn.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};ke.prototype.toJSON=function(e){var t=Dn.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Ct.toObject(["options",t&&t.options||void 0,"oneofs",Dn.arrayToJSON(this.oneofsArray,e),"fields",Dn.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};ke.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return Dn.prototype.resolveAll.call(this)};ke.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};ke.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof bu&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),Cu(this)}return e instanceof Cm?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),Cu(this)):Dn.prototype.add.call(this,e)};ke.prototype.remove=function(e){if(e instanceof bu&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),Cu(this)}if(e instanceof Cm){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),Cu(this)}return Dn.prototype.remove.call(this,e)};ke.prototype.isReservedId=function(e){return Dn.isReservedId(this.reserved,e)};ke.prototype.isReservedName=function(e){return Dn.isReservedName(this.reserved,e)};ke.prototype.create=function(e){return new this.ctor(e)};ke.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=eN(this)({Writer:ZM,types:t,util:Ct}),this.decode=tN(this)({Reader:bm,types:t,util:Ct}),this.verify=nN(this)({types:t,util:Ct}),this.fromObject=UC.fromObject(this)({types:t,util:Ct}),this.toObject=UC.toObject(this)({types:t,util:Ct});var i=rN[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};ke.prototype.encode=function(e,t){return this.setup().encode(e,t)};ke.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};ke.prototype.decode=function(e,t){return this.setup().decode(e,t)};ke.prototype.decodeDelimited=function(e){return e instanceof bm||(e=bm.create(e)),this.decode(e,e.uint32())};ke.prototype.verify=function(e){return this.setup().verify(e)};ke.prototype.fromObject=function(e){return this.setup().fromObject(e)};ke.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};ke.d=function(e){return function(r){Ct.decorateType(r,e)}}});var Au=k((YG,KC)=>{"use strict";KC.exports=nn;var Tu=to();((nn.prototype=Object.create(Tu.prototype)).constructor=nn).className="Root";var Tm=$r(),jC=In(),iN=Xs(),Yr=ft(),WC,wm,Ya;function nn(n){Tu.call(this,"",n),this.deferred=[],this.files=[]}nn.fromJSON=function(e,t){return t||(t=new nn),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};nn.prototype.resolvePath=Yr.path.resolve;nn.prototype.fetch=Yr.fetch;function HC(){}nn.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return Yr.asPromise(n,i,e,t);var s=r===HC;function o(v,w){if(r){if(s)throw v;var A=r;r=null,A(v,w)}}function a(v){var w=v.lastIndexOf("google/protobuf/");if(w>-1){var A=v.substring(w);if(A in Ya)return A}return null}function l(v,w){try{if(Yr.isString(w)&&w.charAt(0)==="{"&&(w=JSON.parse(w)),!Yr.isString(w))i.setOptions(w.options).addJSON(w.nested);else{wm.filename=v;var A=wm(w,i,t),T,O=0;if(A.imports)for(;O<A.imports.length;++O)(T=a(A.imports[O])||i.resolvePath(v,A.imports[O]))&&c(T);if(A.weakImports)for(O=0;O<A.weakImports.length;++O)(T=a(A.weakImports[O])||i.resolvePath(v,A.weakImports[O]))&&c(T,!0)}}catch(D){o(D)}!s&&!u&&o(null,i)}function c(v,w){if(v=a(v)||v,!(i.files.indexOf(v)>-1)){if(i.files.push(v),v in Ya){s?l(v,Ya[v]):(++u,setTimeout(function(){--u,l(v,Ya[v])}));return}if(s){var A;try{A=Yr.fs.readFileSync(v).toString("utf8")}catch(T){w||o(T);return}l(v,A)}else++u,i.fetch(v,function(T,O){if(--u,!!r){if(T){w?u||o(null,i):o(T);return}l(v,O)}})}}var u=0;Yr.isString(e)&&(e=[e]);for(var d=0,f;d<e.length;++d)(f=i.resolvePath("",e[d]))&&c(f);if(s)return i;u||o(null,i)};nn.prototype.loadSync=function(e,t){if(!Yr.isNode)throw Error("not supported");return this.load(e,t,HC)};nn.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return Tu.prototype.resolveAll.call(this)};var wu=/^[A-Z]/;function GC(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new Tm(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}nn.prototype._handleAdd=function(e){if(e instanceof Tm)e.extend!==void 0&&!e.extensionField&&(GC(this,e)||this.deferred.push(e));else if(e instanceof jC)wu.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof iN)){if(e instanceof WC)for(var t=0;t<this.deferred.length;)GC(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);wu.test(e.name)&&(e.parent[e.name]=e)}};nn.prototype._handleRemove=function(e){if(e instanceof Tm){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof jC)wu.test(e.name)&&delete e.parent[e.name];else if(e instanceof Tu){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);wu.test(e.name)&&delete e.parent[e.name]}};nn._configure=function(n,e,t){WC=n,wm=e,Ya=t}});var ft=k((JG,QC)=>{"use strict";var Xe=QC.exports=Wn(),$C=nm(),Am,Im;Xe.codegen=fC();Xe.fetch=mC();Xe.path=vC();Xe.fs=Xe.inquire("fs");Xe.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};Xe.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var sN=/\\/g,oN=/"/g;Xe.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};Xe.safeProp=function(e){return!/^[$\w_]+$/.test(e)||Xe.isReserved(e)?'["'+e.replace(sN,"\\\\").replace(oN,'\\"')+'"]':"."+e};Xe.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var aN=/_([a-z])/g;Xe.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(aN,function(t,r){return r.toUpperCase()})};Xe.compareFieldsById=function(e,t){return e.id-t.id};Xe.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(Xe.decorateRoot.remove(e.$type),e.$type.name=t,Xe.decorateRoot.add(e.$type)),e.$type;Am||(Am=Eu());var r=new Am(t||e.name);return Xe.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var lN=0;Xe.decorateEnum=function(e){if(e.$type)return e.$type;Im||(Im=In());var t=new Im("Enum"+lN++,e);return Xe.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};Xe.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(Xe,"decorateRoot",{get:function(){return $C.decorated||($C.decorated=new(Au()))}})});var Gi=k((XG,YC)=>{"use strict";YC.exports=rn;rn.className="ReflectionObject";var Iu=ft(),Du;function rn(n,e){if(!Iu.isString(n))throw TypeError("name must be a string");if(e&&!Iu.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(rn.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});rn.prototype.toJSON=function(){throw Error()};rn.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Du&&t._handleAdd(this)};rn.prototype.onRemove=function(e){var t=e.root;t instanceof Du&&t._handleRemove(this),this.parent=null,this.resolved=!1};rn.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Du&&(this.resolved=!0),this)};rn.prototype.getOption=function(e){if(this.options)return this.options[e]};rn.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};rn.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];Iu.setProperty(o,r,t)}else s={},s[e]=Iu.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};rn.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};rn.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};rn._configure=function(n){Du=n}});var In=k((ZG,ZC)=>{"use strict";ZC.exports=Qn;var JC=Gi();((Qn.prototype=Object.create(JC.prototype)).constructor=Qn).className="Enum";var XC=to(),ku=ft();function Qn(n,e,t,r,i,s){if(JC.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}Qn.fromJSON=function(e,t){var r=new Qn(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};Qn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return ku.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};Qn.prototype.add=function(e,t,r,i){if(!ku.isString(e))throw TypeError("name must be a string");if(!ku.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};Qn.prototype.remove=function(e){if(!ku.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};Qn.prototype.isReservedId=function(e){return XC.isReservedId(this.reserved,e)};Qn.prototype.isReservedName=function(e){return XC.isReservedName(this.reserved,e)}});var Em=k((ej,tE)=>{"use strict";tE.exports=uN;var cN=In(),Dm=zi(),km=ft();function eE(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function uN(n){for(var e=km.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(km.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof cN?"int32":s.type,l=Dm.basic[a];r="m"+km.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|Dm.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&Dm.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?eE(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?eE(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var rE=k((tj,nE)=>{"use strict";var ce=nE.exports=dC();ce.build="light";function dN(n,e,t){return typeof e=="function"?(t=e,e=new ce.Root):e||(e=new ce.Root),e.load(n,t)}ce.load=dN;function hN(n,e){return e||(e=new ce.Root),e.loadSync(n)}ce.loadSync=hN;ce.encoder=Em();ce.decoder=hm();ce.verifier=mm();ce.converter=vm();ce.ReflectionObject=Gi();ce.Namespace=to();ce.Root=Au();ce.Enum=In();ce.Type=Eu();ce.Field=$r();ce.OneOf=Xs();ce.MapField=yu();ce.Service=_u();ce.Method=vu();ce.Message=Su();ce.wrappers=_m();ce.types=zi();ce.util=ft();ce.ReflectionObject._configure(ce.Root);ce.Namespace._configure(ce.Type,ce.Service,ce.Enum);ce.Root._configure(ce.Type);ce.Field._configure(ce.Type)});var xm=k((nj,oE)=>{"use strict";oE.exports=sE;var Rm=/[\s{}=;:[\],'"()<>]/g,fN=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,pN=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,mN=/^ *[*/]+ */,gN=/^\s*\*?\/*/,yN=/\n/g,vN=/\s/,_N=/\\(.?)/g,SN={0:"\0",r:"\r",n:`
`,t:"	"};function iE(n){return n.replace(_N,function(e,t){switch(t){case"\\":case"":return t;default:return SN[t]||""}})}sE.unescape=iE;function sE(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(F){return Error("illegal "+F+" (line "+i+")")}function u(){var F=l==="'"?pN:fN;F.lastIndex=t-1;var j=F.exec(n);if(!j)throw c("string");return t=F.lastIndex,T(l),l=null,iE(j[1])}function d(F){return n.charAt(F)}function f(F,j,X){var S={type:n.charAt(F++),lineEmpty:!1,leading:X},g;e?g=2:g=3;var y=F-g,_;do if(--y<0||(_=n.charAt(y))===`
`){S.lineEmpty=!0;break}while(_===" "||_==="	");for(var m=n.substring(F,j).split(yN),b=0;b<m.length;++b)m[b]=m[b].replace(e?gN:mN,"").trim();S.text=m.join(`
`).trim(),o[i]=S,s=i}function v(F){var j=w(F),X=n.substring(F,j),S=/^\s*\/\//.test(X);return S}function w(F){for(var j=F;j<r&&d(j)!==`
`;)j++;return j}function A(){if(a.length>0)return a.shift();if(l)return u();var F,j,X,S,g,y=t===0;do{if(t===r)return null;for(F=!1;vN.test(X=d(t));)if(X===`
`&&(y=!0,++i),++t===r)return null;if(d(t)==="/"){if(++t===r)throw c("comment");if(d(t)==="/")if(e){if(S=t,g=!1,v(t-1)){g=!0;do if(t=w(t),t===r||(t++,!y))break;while(v(t))}else t=Math.min(r,w(t)+1);g&&(f(S,t,y),y=!0),i++,F=!0}else{for(g=d(S=t+1)==="/";d(++t)!==`
`;)if(t===r)return null;++t,g&&(f(S,t-1,y),y=!0),++i,F=!0}else if((X=d(t))==="*"){S=t+1,g=e||d(S)==="*";do{if(X===`
`&&++i,++t===r)throw c("comment");j=X,X=d(t)}while(j!=="*"||X!=="/");++t,g&&(f(S,t-2,y),y=!0),F=!0}else return"/"}}while(F);var _=t;Rm.lastIndex=0;var m=Rm.test(d(_++));if(!m)for(;_<r&&!Rm.test(d(_));)++_;var b=n.substring(t,t=_);return(b==='"'||b==="'")&&(l=b),b}function T(F){a.push(F)}function O(){if(!a.length){var F=A();if(F===null)return null;T(F)}return a[0]}function D(F,j){var X=O(),S=X===F;if(S)return A(),!0;if(!j)throw c("token '"+X+"', '"+F+"' expected");return!1}function P(F){var j=null,X;return F===void 0?(X=o[i-1],delete o[i-1],X&&(e||X.type==="*"||X.lineEmpty)&&(j=X.leading?X.text:null)):(s<F&&O(),X=o[F],delete o[F],X&&!X.lineEmpty&&(e||X.type==="/")&&(j=X.leading?null:X.text)),j}return Object.defineProperty({next:A,peek:O,push:T,skip:D,cmnt:P},"line",{get:function(){return i}})}});var hE=k((rj,dE)=>{"use strict";dE.exports=gr;gr.filename=null;gr.defaults={keepCase:!1};var bN=xm(),aE=Au(),lE=Eu(),cE=$r(),CN=yu(),uE=Xs(),EN=In(),wN=_u(),TN=vu(),Mm=zi(),Nm=ft(),AN=/^[1-9][0-9]*$/,IN=/^-?[1-9][0-9]*$/,DN=/^0[x][0-9a-fA-F]+$/,kN=/^-?0[x][0-9a-fA-F]+$/,RN=/^0[0-7]+$/,xN=/^-?0[0-7]+$/,MN=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Yn=/^[a-zA-Z_][a-zA-Z_0-9]*$/,Jn=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,NN=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function gr(n,e,t){e instanceof aE||(t=e,e=new aE),t||(t=gr.defaults);var r=t.preferTrailingComment||!1,i=bN(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,d,f,v,w,A=!1,T=e,O=t.keepCase?function(x){return x}:Nm.camelCase;function D(x,M,q){var Y=gr.filename;return q||(gr.filename=null),Error("illegal "+(M||"token")+" '"+x+"' ("+(Y?Y+", ":"")+"line "+i.line+")")}function P(){var x=[],M;do{if((M=s())!=='"'&&M!=="'")throw D(M);x.push(s()),l(M),M=a()}while(M==='"'||M==="'");return x.join("")}function F(x){var M=s();switch(M){case"'":case'"':return o(M),P();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return X(M,!0)}catch{if(x&&Jn.test(M))return M;throw D(M,"value")}}function j(x,M){var q,Y;do M&&((q=a())==='"'||q==="'")?x.push(P()):x.push([Y=S(s()),l("to",!0)?S(s()):Y]);while(l(",",!0));var K={options:void 0};K.setOption=function(ie,Fe){this.options===void 0&&(this.options={}),this.options[ie]=Fe},b(K,function(Fe){if(Fe==="option")De(K,Fe),l(";");else throw D(Fe)},function(){gt(K)})}function X(x,M){var q=1;switch(x.charAt(0)==="-"&&(q=-1,x=x.substring(1)),x){case"inf":case"INF":case"Inf":return q*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(AN.test(x))return q*parseInt(x,10);if(DN.test(x))return q*parseInt(x,16);if(RN.test(x))return q*parseInt(x,8);if(MN.test(x))return q*parseFloat(x);throw D(x,"number",M)}function S(x,M){switch(x){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!M&&x.charAt(0)==="-")throw D(x,"id");if(IN.test(x))return parseInt(x,10);if(kN.test(x))return parseInt(x,16);if(xN.test(x))return parseInt(x,8);throw D(x,"id")}function g(){if(d!==void 0)throw D("package");if(d=s(),!Jn.test(d))throw D(d,"name");T=T.define(d),l(";")}function y(){var x=a(),M;switch(x){case"weak":M=v||(v=[]),s();break;case"public":s();default:M=f||(f=[]);break}x=P(),l(";"),M.push(x)}function _(){if(l("="),w=P(),A=w==="proto3",!A&&w!=="proto2")throw D(w,"syntax");e.setOption("syntax",w),l(";")}function m(x,M){switch(M){case"option":return De(x,M),l(";"),!0;case"message":return h(x,M),!0;case"enum":return Te(x,M),!0;case"service":return rt(x,M),!0;case"extend":return ks(x,M),!0}return!1}function b(x,M,q){var Y=i.line;if(x&&(typeof x.comment!="string"&&(x.comment=c()),x.filename=gr.filename),l("{",!0)){for(var K;(K=s())!=="}";)M(K);l(";",!0)}else q&&q(),l(";"),x&&(typeof x.comment!="string"||r)&&(x.comment=c(Y)||x.comment)}function h(x,M){if(!Yn.test(M=s()))throw D(M,"type name");var q=new lE(M);b(q,function(K){if(!m(q,K))switch(K){case"map":le(q,K);break;case"required":case"repeated":p(q,K);break;case"optional":A?p(q,"proto3_optional"):p(q,"optional");break;case"oneof":Ie(q,K);break;case"extensions":j(q.extensions||(q.extensions=[]));break;case"reserved":j(q.reserved||(q.reserved=[]),!0);break;default:if(!A||!Jn.test(K))throw D(K);o(K),p(q,"optional");break}}),x.add(q)}function p(x,M,q){var Y=s();if(Y==="group"){B(x,M);return}for(;Y.endsWith(".")||a().startsWith(".");)Y+=s();if(!Jn.test(Y))throw D(Y,"type");var K=s();if(!Yn.test(K))throw D(K,"name");K=O(K),l("=");var ie=new cE(K,S(s()),Y,M,q);if(b(ie,function(Yt){if(Yt==="option")De(ie,Yt),l(";");else throw D(Yt)},function(){gt(ie)}),M==="proto3_optional"){var Fe=new uE("_"+K);ie.setOption("proto3_optional",!0),Fe.add(ie),x.add(Fe)}else x.add(ie);!A&&ie.repeated&&(Mm.packed[Y]!==void 0||Mm.basic[Y]===void 0)&&ie.setOption("packed",!1,!0)}function B(x,M){var q=s();if(!Yn.test(q))throw D(q,"name");var Y=Nm.lcFirst(q);q===Y&&(q=Nm.ucFirst(q)),l("=");var K=S(s()),ie=new lE(q);ie.group=!0;var Fe=new cE(Y,K,q,M);Fe.filename=gr.filename,b(ie,function(Yt){switch(Yt){case"option":De(ie,Yt),l(";");break;case"required":case"repeated":p(ie,Yt);break;case"optional":A?p(ie,"proto3_optional"):p(ie,"optional");break;case"message":h(ie,Yt);break;case"enum":Te(ie,Yt);break;default:throw D(Yt)}}),x.add(ie).add(Fe)}function le(x){l("<");var M=s();if(Mm.mapKey[M]===void 0)throw D(M,"type");l(",");var q=s();if(!Jn.test(q))throw D(q,"type");l(">");var Y=s();if(!Yn.test(Y))throw D(Y,"name");l("=");var K=new CN(O(Y),S(s()),M,q);b(K,function(Fe){if(Fe==="option")De(K,Fe),l(";");else throw D(Fe)},function(){gt(K)}),x.add(K)}function Ie(x,M){if(!Yn.test(M=s()))throw D(M,"name");var q=new uE(O(M));b(q,function(K){K==="option"?(De(q,K),l(";")):(o(K),p(q,"optional"))}),x.add(q)}function Te(x,M){if(!Yn.test(M=s()))throw D(M,"name");var q=new EN(M);b(q,function(K){switch(K){case"option":De(q,K),l(";");break;case"reserved":j(q.reserved||(q.reserved=[]),!0);break;default:We(q,K)}}),x.add(q)}function We(x,M){if(!Yn.test(M))throw D(M,"name");l("=");var q=S(s(),!0),Y={options:void 0};Y.setOption=function(K,ie){this.options===void 0&&(this.options={}),this.options[K]=ie},b(Y,function(ie){if(ie==="option")De(Y,ie),l(";");else throw D(ie)},function(){gt(Y)}),x.add(M,q,Y.comment,Y.options)}function De(x,M){var q=l("(",!0);if(!Jn.test(M=s()))throw D(M,"name");var Y=M,K=Y,ie;q&&(l(")"),Y="("+Y+")",K=Y,M=a(),NN.test(M)&&(ie=M.slice(1),Y+=M,s())),l("=");var Fe=It(x,Y);Ue(x,K,Fe,ie)}function It(x,M){if(l("{",!0)){for(var q={};!l("}",!0);){if(!Yn.test(_t=s()))throw D(_t,"name");if(_t===null)throw D(_t,"end of input");var Y,K=_t;if(l(":",!0),a()==="{")Y=It(x,M+"."+_t);else if(a()==="["){Y=[];var ie;if(l("[",!0)){do ie=F(!0),Y.push(ie);while(l(",",!0));l("]"),typeof ie<"u"&&nt(x,M+"."+_t,ie)}}else Y=F(!0),nt(x,M+"."+_t,Y);var Fe=q[K];Fe&&(Y=[].concat(Fe).concat(Y)),q[K]=Y,l(",",!0),l(";",!0)}return q}var xr=F(!0);return nt(x,M,xr),xr}function nt(x,M,q){x.setOption&&x.setOption(M,q)}function Ue(x,M,q,Y){x.setParsedOption&&x.setParsedOption(M,q,Y)}function gt(x){if(l("[",!0)){do De(x,"option");while(l(",",!0));l("]")}return x}function rt(x,M){if(!Yn.test(M=s()))throw D(M,"service name");var q=new wN(M);b(q,function(K){if(!m(q,K))if(K==="rpc")Dt(q,K);else throw D(K)}),x.add(q)}function Dt(x,M){var q=c(),Y=M;if(!Yn.test(M=s()))throw D(M,"name");var K=M,ie,Fe,xr,Yt;if(l("("),l("stream",!0)&&(Fe=!0),!Jn.test(M=s())||(ie=M,l(")"),l("returns"),l("("),l("stream",!0)&&(Yt=!0),!Jn.test(M=s())))throw D(M);xr=M,l(")");var _c=new TN(K,Y,ie,xr,Fe,Yt);_c.comment=q,b(_c,function(gf){if(gf==="option")De(_c,gf),l(";");else throw D(gf)}),x.add(_c)}function ks(x,M){if(!Jn.test(M=s()))throw D(M,"reference");var q=M;b(null,function(K){switch(K){case"required":case"repeated":p(x,K,q);break;case"optional":A?p(x,"proto3_optional",q):p(x,"optional",q);break;default:if(!A||!Jn.test(K))throw D(K);o(K),p(x,"optional",q);break}})}for(var _t;(_t=s())!==null;)switch(_t){case"package":if(!u)throw D(_t);g();break;case"import":if(!u)throw D(_t);y();break;case"syntax":if(!u)throw D(_t);_();break;case"option":De(T,_t),l(";");break;default:if(m(T,_t)){u=!1;continue}throw D(_t)}return gr.filename=null,{package:d,imports:f,weakImports:v,syntax:w,root:e}}});var mE=k((ij,pE)=>{"use strict";pE.exports=kn;var ON=/\/|\./;function kn(n,e){ON.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),kn[n]=e}kn("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var fE;kn("duration",{Duration:fE={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});kn("timestamp",{Timestamp:fE});kn("empty",{Empty:{fields:{}}});kn("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});kn("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});kn("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});kn.get=function(e){return kn[e]||null}});var yE=k((sj,gE)=>{"use strict";var Jr=gE.exports=rE();Jr.build="full";Jr.tokenize=xm();Jr.parse=hE();Jr.common=mE();Jr.Root._configure(Jr.Type,Jr.parse,Jr.common)});var Ru=k((oj,vE)=>{"use strict";vE.exports=yE()});var Om=k((aj,PN)=>{PN.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var EE=k((oe,CE)=>{"use strict";var Rt=Ru();CE.exports=oe=Rt.descriptor=Rt.Root.fromJSON(Om()).lookup(".google.protobuf");var _E=Rt.Namespace,Ja=Rt.Root,yr=Rt.Enum,Xr=Rt.Type,Zr=Rt.Field,FN=Rt.MapField,xu=Rt.OneOf,Xa=Rt.Service,Mu=Rt.Method;Ja.fromDescriptor=function(e){typeof e.length=="number"&&(e=oe.FileDescriptorSet.decode(e));var t=new Ja;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(Xr.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(yr.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(Zr.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(Xa.fromDescriptor(r.service[o]));var a=ro(r.options,oe.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};Ja.prototype.toDescriptor=function(e){var t=oe.FileDescriptorSet.create();return SE(this,t.file,e),t};function SE(n,e,t){var r=oe.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof Ja||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof Xr?r.messageType.push(s.toDescriptor(t)):s instanceof yr?r.enumType.push(s.toDescriptor()):s instanceof Zr?r.extension.push(s.toDescriptor(t)):s instanceof Xa?r.service.push(s.toDescriptor()):s instanceof _E&&SE(s,e,t);r.options=io(n.options,oe.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var LN=0;Xr.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=oe.DescriptorProto.decode(e));var r=new Xr(e.name.length?e.name:"Type"+LN++,ro(e.options,oe.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(xu.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=Zr.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(Zr.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(Xr.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(yr.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};Xr.prototype.toDescriptor=function(e){var t=oe.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof FN){var s=Pm(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=Pm(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&bE(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(oe.DescriptorProto.create({name:i.typeName,field:[oe.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),oe.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:oe.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof Zr?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof Xr?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof yr&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(oe.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(oe.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=io(this.options,oe.MessageOptions),t};var BN=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;Zr.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=oe.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=GN(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new Zr(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=ro(e.options,oe.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=BN.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return jN(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};Zr.prototype.toDescriptor=function(e){var t=oe.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=Rt.util.ucFirst(this.name),t.label=3;else{switch(t.type=Pm(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?bE(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=io(this.options,oe.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=oe.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=oe.FieldOptions.create())).packed=!0),t};var VN=0;yr.fromDescriptor=function(e){typeof e.length=="number"&&(e=oe.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new yr(e.name&&e.name.length?e.name:"Enum"+VN++,t,ro(e.options,oe.EnumOptions))};yr.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(oe.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return oe.EnumDescriptorProto.create({name:this.name,value:e,options:io(this.options,oe.EnumOptions)})};var qN=0;xu.fromDescriptor=function(e){return typeof e.length=="number"&&(e=oe.OneofDescriptorProto.decode(e)),new xu(e.name&&e.name.length?e.name:"oneof"+qN++)};xu.prototype.toDescriptor=function(){return oe.OneofDescriptorProto.create({name:this.name})};var UN=0;Xa.fromDescriptor=function(e){typeof e.length=="number"&&(e=oe.ServiceDescriptorProto.decode(e));var t=new Xa(e.name&&e.name.length?e.name:"Service"+UN++,ro(e.options,oe.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(Mu.fromDescriptor(e.method[r]));return t};Xa.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return oe.ServiceDescriptorProto.create({name:this.name,method:e,options:io(this.options,oe.ServiceOptions)})};var zN=0;Mu.fromDescriptor=function(e){return typeof e.length=="number"&&(e=oe.MethodDescriptorProto.decode(e)),new Mu(e.name&&e.name.length?e.name:"Method"+zN++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,ro(e.options,oe.MethodOptions))};Mu.prototype.toDescriptor=function(){return oe.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:io(this.options,oe.MethodOptions)})};function GN(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function jN(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function Pm(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof yr)return 14;if(e instanceof Xr)return e.group?10:11;throw Error("illegal type: "+n)}function ro(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof yr&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(WN(s),o));return t.length?Rt.util.toObject(t):void 0}}function io(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=Rt.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(Rt.util.toObject(t)):void 0}}function bE(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof Ja)&&e instanceof _E)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function WN(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var wE=k((lj,HN)=>{HN.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var TE=k((cj,KN)=>{KN.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var AE=k((uj,$N)=>{$N.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var RE=k(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});ei.addCommonProtos=ei.loadProtosWithOptionsSync=ei.loadProtosWithOptions=void 0;var IE=Ce("fs"),DE=Ce("path"),so=Ru();function kE(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(DE.isAbsolute(i))return i;for(let s of e){let o=DE.join(s,i);try{return IE.accessSync(o,IE.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function QN(n,e){return C(this,null,function*(){let t=new so.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));kE(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}ei.loadProtosWithOptions=QN;function YN(n,e){let t=new so.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");kE(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}ei.loadProtosWithOptionsSync=YN;function JN(){let n=wE(),e=Om(),t=TE(),r=AE();so.common("api",n.nested.google.nested.protobuf.nested),so.common("descriptor",e.nested.google.nested.protobuf.nested),so.common("source_context",t.nested.google.nested.protobuf.nested),so.common("type",r.nested.google.nested.protobuf.nested)}ei.addCommonProtos=JN});var xE=k((Za,Fm)=>{"use strict";(function(n,e){function t(r){return"default"in r?r.default:r}typeof define=="function"&&define.amd?define([],function(){var r={};return e(r),t(r)}):typeof Za=="object"?(e(Za),typeof Fm=="object"&&(Fm.exports=t(Za))):function(){var r={};e(r),n.Long=t(r)}()})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Za,function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(h,p,B){this.low=h|0,this.high=p|0,this.unsigned=!!B}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(h){return(h&&h.__isLong__)===!0}function i(h){var p=Math.clz32(h&-h);return h?31-p:p}t.isLong=r;var s={},o={};function a(h,p){var B,le,Ie;return p?(h>>>=0,(Ie=0<=h&&h<256)&&(le=o[h],le)?le:(B=c(h,0,!0),Ie&&(o[h]=B),B)):(h|=0,(Ie=-128<=h&&h<128)&&(le=s[h],le)?le:(B=c(h,h<0?-1:0,!1),Ie&&(s[h]=B),B))}t.fromInt=a;function l(h,p){if(isNaN(h))return p?F:P;if(p){if(h<0)return F;if(h>=T)return y}else{if(h<=-O)return _;if(h+1>=O)return g}return h<0?l(-h,p).neg():c(h%A|0,h/A|0,p)}t.fromNumber=l;function c(h,p,B){return new t(h,p,B)}t.fromBits=c;var u=Math.pow;function d(h,p,B){if(h.length===0)throw Error("empty string");if(typeof p=="number"?(B=p,p=!1):p=!!p,h==="NaN"||h==="Infinity"||h==="+Infinity"||h==="-Infinity")return p?F:P;if(B=B||10,B<2||36<B)throw RangeError("radix");var le;if((le=h.indexOf("-"))>0)throw Error("interior hyphen");if(le===0)return d(h.substring(1),p,B).neg();for(var Ie=l(u(B,8)),Te=P,We=0;We<h.length;We+=8){var De=Math.min(8,h.length-We),It=parseInt(h.substring(We,We+De),B);if(De<8){var nt=l(u(B,De));Te=Te.mul(nt).add(l(It))}else Te=Te.mul(Ie),Te=Te.add(l(It))}return Te.unsigned=p,Te}t.fromString=d;function f(h,p){return typeof h=="number"?l(h,p):typeof h=="string"?d(h,p):c(h.low,h.high,typeof p=="boolean"?p:h.unsigned)}t.fromValue=f;var v=65536,w=1<<24,A=v*v,T=A*A,O=T/2,D=a(w),P=a(0);t.ZERO=P;var F=a(0,!0);t.UZERO=F;var j=a(1);t.ONE=j;var X=a(1,!0);t.UONE=X;var S=a(-1);t.NEG_ONE=S;var g=c(-1,2147483647,!1);t.MAX_VALUE=g;var y=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=y;var _=c(0,-2147483648,!1);t.MIN_VALUE=_;var m=t.prototype;m.toInt=function(){return this.unsigned?this.low>>>0:this.low},m.toNumber=function(){return this.unsigned?(this.high>>>0)*A+(this.low>>>0):this.high*A+(this.low>>>0)},m.toString=function(p){if(p=p||10,p<2||36<p)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(_)){var B=l(p),le=this.div(B),Ie=le.mul(B).sub(this);return le.toString(p)+Ie.toInt().toString(p)}else return"-"+this.neg().toString(p);for(var Te=l(u(p,6),this.unsigned),We=this,De="";;){var It=We.div(Te),nt=We.sub(It.mul(Te)).toInt()>>>0,Ue=nt.toString(p);if(We=It,We.isZero())return Ue+De;for(;Ue.length<6;)Ue="0"+Ue;De=""+Ue+De}},m.getHighBits=function(){return this.high},m.getHighBitsUnsigned=function(){return this.high>>>0},m.getLowBits=function(){return this.low},m.getLowBitsUnsigned=function(){return this.low>>>0},m.getNumBitsAbs=function(){if(this.isNegative())return this.eq(_)?64:this.neg().getNumBitsAbs();for(var p=this.high!=0?this.high:this.low,B=31;B>0&&!(p&1<<B);B--);return this.high!=0?B+33:B+1},m.isSafeInteger=function(){var p=this.high>>21;return p?this.unsigned?!1:p===-1&&!(this.low===0&&this.high===-2097152):!0},m.isZero=function(){return this.high===0&&this.low===0},m.eqz=m.isZero,m.isNegative=function(){return!this.unsigned&&this.high<0},m.isPositive=function(){return this.unsigned||this.high>=0},m.isOdd=function(){return(this.low&1)===1},m.isEven=function(){return(this.low&1)===0},m.equals=function(p){return r(p)||(p=f(p)),this.unsigned!==p.unsigned&&this.high>>>31===1&&p.high>>>31===1?!1:this.high===p.high&&this.low===p.low},m.eq=m.equals,m.notEquals=function(p){return!this.eq(p)},m.neq=m.notEquals,m.ne=m.notEquals,m.lessThan=function(p){return this.comp(p)<0},m.lt=m.lessThan,m.lessThanOrEqual=function(p){return this.comp(p)<=0},m.lte=m.lessThanOrEqual,m.le=m.lessThanOrEqual,m.greaterThan=function(p){return this.comp(p)>0},m.gt=m.greaterThan,m.greaterThanOrEqual=function(p){return this.comp(p)>=0},m.gte=m.greaterThanOrEqual,m.ge=m.greaterThanOrEqual,m.compare=function(p){if(r(p)||(p=f(p)),this.eq(p))return 0;var B=this.isNegative(),le=p.isNegative();return B&&!le?-1:!B&&le?1:this.unsigned?p.high>>>0>this.high>>>0||p.high===this.high&&p.low>>>0>this.low>>>0?-1:1:this.sub(p).isNegative()?-1:1},m.comp=m.compare,m.negate=function(){return!this.unsigned&&this.eq(_)?_:this.not().add(j)},m.neg=m.negate,m.add=function(p){r(p)||(p=f(p));var B=this.high>>>16,le=this.high&65535,Ie=this.low>>>16,Te=this.low&65535,We=p.high>>>16,De=p.high&65535,It=p.low>>>16,nt=p.low&65535,Ue=0,gt=0,rt=0,Dt=0;return Dt+=Te+nt,rt+=Dt>>>16,Dt&=65535,rt+=Ie+It,gt+=rt>>>16,rt&=65535,gt+=le+De,Ue+=gt>>>16,gt&=65535,Ue+=B+We,Ue&=65535,c(rt<<16|Dt,Ue<<16|gt,this.unsigned)},m.subtract=function(p){return r(p)||(p=f(p)),this.add(p.neg())},m.sub=m.subtract,m.multiply=function(p){if(this.isZero())return this;if(r(p)||(p=f(p)),e){var B=e.mul(this.low,this.high,p.low,p.high);return c(B,e.get_high(),this.unsigned)}if(p.isZero())return this.unsigned?F:P;if(this.eq(_))return p.isOdd()?_:P;if(p.eq(_))return this.isOdd()?_:P;if(this.isNegative())return p.isNegative()?this.neg().mul(p.neg()):this.neg().mul(p).neg();if(p.isNegative())return this.mul(p.neg()).neg();if(this.lt(D)&&p.lt(D))return l(this.toNumber()*p.toNumber(),this.unsigned);var le=this.high>>>16,Ie=this.high&65535,Te=this.low>>>16,We=this.low&65535,De=p.high>>>16,It=p.high&65535,nt=p.low>>>16,Ue=p.low&65535,gt=0,rt=0,Dt=0,ks=0;return ks+=We*Ue,Dt+=ks>>>16,ks&=65535,Dt+=Te*Ue,rt+=Dt>>>16,Dt&=65535,Dt+=We*nt,rt+=Dt>>>16,Dt&=65535,rt+=Ie*Ue,gt+=rt>>>16,rt&=65535,rt+=Te*nt,gt+=rt>>>16,rt&=65535,rt+=We*It,gt+=rt>>>16,rt&=65535,gt+=le*Ue+Ie*nt+Te*It+We*De,gt&=65535,c(Dt<<16|ks,gt<<16|rt,this.unsigned)},m.mul=m.multiply,m.divide=function(p){if(r(p)||(p=f(p)),p.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&p.low===-1&&p.high===-1)return this;var B=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,p.low,p.high);return c(B,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?F:P;var le,Ie,Te;if(this.unsigned){if(p.unsigned||(p=p.toUnsigned()),p.gt(this))return F;if(p.gt(this.shru(1)))return X;Te=F}else{if(this.eq(_)){if(p.eq(j)||p.eq(S))return _;if(p.eq(_))return j;var We=this.shr(1);return le=We.div(p).shl(1),le.eq(P)?p.isNegative()?j:S:(Ie=this.sub(p.mul(le)),Te=le.add(Ie.div(p)),Te)}else if(p.eq(_))return this.unsigned?F:P;if(this.isNegative())return p.isNegative()?this.neg().div(p.neg()):this.neg().div(p).neg();if(p.isNegative())return this.div(p.neg()).neg();Te=P}for(Ie=this;Ie.gte(p);){le=Math.max(1,Math.floor(Ie.toNumber()/p.toNumber()));for(var De=Math.ceil(Math.log(le)/Math.LN2),It=De<=48?1:u(2,De-48),nt=l(le),Ue=nt.mul(p);Ue.isNegative()||Ue.gt(Ie);)le-=It,nt=l(le,this.unsigned),Ue=nt.mul(p);nt.isZero()&&(nt=j),Te=Te.add(nt),Ie=Ie.sub(Ue)}return Te},m.div=m.divide,m.modulo=function(p){if(r(p)||(p=f(p)),e){var B=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,p.low,p.high);return c(B,e.get_high(),this.unsigned)}return this.sub(this.div(p).mul(p))},m.mod=m.modulo,m.rem=m.modulo,m.not=function(){return c(~this.low,~this.high,this.unsigned)},m.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},m.clz=m.countLeadingZeros,m.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},m.ctz=m.countTrailingZeros,m.and=function(p){return r(p)||(p=f(p)),c(this.low&p.low,this.high&p.high,this.unsigned)},m.or=function(p){return r(p)||(p=f(p)),c(this.low|p.low,this.high|p.high,this.unsigned)},m.xor=function(p){return r(p)||(p=f(p)),c(this.low^p.low,this.high^p.high,this.unsigned)},m.shiftLeft=function(p){return r(p)&&(p=p.toInt()),(p&=63)===0?this:p<32?c(this.low<<p,this.high<<p|this.low>>>32-p,this.unsigned):c(0,this.low<<p-32,this.unsigned)},m.shl=m.shiftLeft,m.shiftRight=function(p){return r(p)&&(p=p.toInt()),(p&=63)===0?this:p<32?c(this.low>>>p|this.high<<32-p,this.high>>p,this.unsigned):c(this.high>>p-32,this.high>=0?0:-1,this.unsigned)},m.shr=m.shiftRight,m.shiftRightUnsigned=function(p){return r(p)&&(p=p.toInt()),(p&=63)===0?this:p<32?c(this.low>>>p|this.high<<32-p,this.high>>>p,this.unsigned):p===32?c(this.high,0,this.unsigned):c(this.high>>>p-32,0,this.unsigned)},m.shru=m.shiftRightUnsigned,m.shr_u=m.shiftRightUnsigned,m.rotateLeft=function(p){var B;return r(p)&&(p=p.toInt()),(p&=63)===0?this:p===32?c(this.high,this.low,this.unsigned):p<32?(B=32-p,c(this.low<<p|this.high>>>B,this.high<<p|this.low>>>B,this.unsigned)):(p-=32,B=32-p,c(this.high<<p|this.low>>>B,this.low<<p|this.high>>>B,this.unsigned))},m.rotl=m.rotateLeft,m.rotateRight=function(p){var B;return r(p)&&(p=p.toInt()),(p&=63)===0?this:p===32?c(this.high,this.low,this.unsigned):p<32?(B=32-p,c(this.high<<B|this.low>>>p,this.low<<B|this.high>>>p,this.unsigned)):(p-=32,B=32-p,c(this.low<<B|this.high>>>p,this.high<<B|this.low>>>p,this.unsigned))},m.rotr=m.rotateRight,m.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},m.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},m.toBytes=function(p){return p?this.toBytesLE():this.toBytesBE()},m.toBytesLE=function(){var p=this.high,B=this.low;return[B&255,B>>>8&255,B>>>16&255,B>>>24,p&255,p>>>8&255,p>>>16&255,p>>>24]},m.toBytesBE=function(){var p=this.high,B=this.low;return[p>>>24,p>>>16&255,p>>>8&255,p&255,B>>>24,B>>>16&255,B>>>8&255,B&255]},t.fromBytes=function(p,B,le){return le?t.fromBytesLE(p,B):t.fromBytesBE(p,B)},t.fromBytesLE=function(p,B){return new t(p[0]|p[1]<<8|p[2]<<16|p[3]<<24,p[4]|p[5]<<8|p[6]<<16|p[7]<<24,B)},t.fromBytesBE=function(p,B){return new t(p[4]<<24|p[5]<<16|p[6]<<8|p[7],p[0]<<24|p[1]<<16|p[2]<<8|p[3],B)},typeof BigInt=="function"&&(t.fromBigInt=function(p,B){var le=Number(BigInt.asIntN(32,p)),Ie=Number(BigInt.asIntN(32,p>>BigInt(32)));return c(le,Ie,B)},t.fromValue=function(p,B){return typeof p=="bigint"?fromBigInt(p,B):f(p,B)},m.toBigInt=function(){var p=BigInt(this.low>>>0),B=BigInt(this.unsigned?this.high>>>0:this.high);return B<<BigInt(32)|p});var b=n.default=t})});var qm=k(ut=>{"use strict";Object.defineProperty(ut,"__esModule",{value:!0});ut.loadFileDescriptorSetFromObject=ut.loadFileDescriptorSetFromBuffer=ut.fromJSON=ut.loadSync=ut.load=ut.IdempotencyLevel=ut.isAnyExtension=ut.Long=void 0;var XN=Sb(),Xn=Ru(),Bm=EE(),Vm=RE(),ZN=xE();ut.Long=ZN;function eO(n){return"@type"in n&&typeof n["@type"]=="string"}ut.isAnyExtension=eO;var OE;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(OE=ut.IdempotencyLevel||(ut.IdempotencyLevel={}));var PE={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function tO(n,e){return n===""?e:n+"."+e}function nO(n){return n instanceof Xn.Service||n instanceof Xn.Type||n instanceof Xn.Enum}function rO(n){return n instanceof Xn.Namespace||n instanceof Xn.Root}function FE(n,e){let t=tO(e,n.name);return nO(n)?[[t,n]]:rO(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>FE(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function ME(n,e){return function(r){return n.toObject(n.decode(r),e)}}function NE(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function iO(n){return(n||[]).reduce((e,t)=>{for(let[r,i]of Object.entries(t))switch(r){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[r]=i}return e},{deprecated:!1,idempotency_level:OE.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function sO(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:NE(i),requestDeserialize:ME(i,t),responseSerialize:NE(s),responseDeserialize:ME(s,t),originalName:XN(n.name),requestType:Lm(i,r),responseType:Lm(s,r),options:iO(n.parsedOptions)}}function oO(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=sO(s,e,t,r);return i}function Lm(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,PE),fileDescriptorProtos:e}}function aO(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,PE),fileDescriptorProtos:e}}function lO(n,e,t,r){if(n instanceof Xn.Service)return oO(n,e,t,r);if(n instanceof Xn.Type)return Lm(n,r);if(n instanceof Xn.Enum)return aO(n,r);throw new Error("Type mismatch in reflection object handling")}function Nu(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(Bm.FileDescriptorProto.encode(s).finish()));for(let[s,o]of FE(n,""))t[s]=lO(o,s,e,i);return t}function LE(n,e){e=e||{};let t=Xn.Root.fromDescriptor(n);return t.resolveAll(),Nu(t,e)}function cO(n,e){return(0,Vm.loadProtosWithOptions)(n,e).then(t=>Nu(t,e))}ut.load=cO;function uO(n,e){let t=(0,Vm.loadProtosWithOptionsSync)(n,e);return Nu(t,e)}ut.loadSync=uO;function dO(n,e){e=e||{};let t=Xn.Root.fromJSON(n);return t.resolveAll(),Nu(t,e)}ut.fromJSON=dO;function hO(n,e){let t=Bm.FileDescriptorSet.decode(n);return LE(t,e)}ut.loadFileDescriptorSetFromBuffer=hO;function fO(n,e){let t=Bm.FileDescriptorSet.fromObject(n);return LE(t,e)}ut.loadFileDescriptorSetFromObject=fO;(0,Vm.addCommonProtos)()});var Wi=k(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Oe.setup=Oe.getChannelzServiceDefinition=Oe.getChannelzHandlers=Oe.unregisterChannelzRef=Oe.registerChannelzSocket=Oe.registerChannelzServer=Oe.registerChannelzSubchannel=Oe.registerChannelzChannel=Oe.ChannelzCallTracker=Oe.ChannelzChildrenTracker=Oe.ChannelzTrace=void 0;var BE=Ce("net"),el=cn(),nl=ye(),pO=Gn(),mO=eu(),gO=Lp();function Um(n){return{channel_id:n.id,name:n.name}}function Wm(n){return{subchannel_id:n.id,name:n.name}}function yO(n){return{server_id:n.id}}function Pu(n){return{socket_id:n.id,name:n.name}}var VE=32,zm=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=VE*2&&(this.events=this.events.slice(VE)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:vr(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:vr(e.timestamp),channel_ref:e.childChannel?Um(e.childChannel):null,subchannel_ref:e.childSubchannel?Wm(e.childSubchannel):null}))}}};Oe.ChannelzTrace=zm;var Gm=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};Oe.ChannelzChildrenTracker=Gm;var jm=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Oe.ChannelzCallTracker=jm;var vO=1;function Fu(){return vO++}var tl=[],Hm=[],ti=[],Km=[];function _O(n,e,t){let r=Fu(),i={id:r,name:n,kind:"channel"};return t&&(tl[r]={ref:i,getInfo:e}),i}Oe.registerChannelzChannel=_O;function SO(n,e,t){let r=Fu(),i={id:r,name:n,kind:"subchannel"};return t&&(Hm[r]={ref:i,getInfo:e}),i}Oe.registerChannelzSubchannel=SO;function bO(n,e){let t=Fu(),r={id:t,kind:"server"};return e&&(ti[t]={ref:r,getInfo:n}),r}Oe.registerChannelzServer=bO;function CO(n,e,t){let r=Fu(),i={id:r,name:n,kind:"socket"};return t&&(Km[r]={ref:i,getInfo:e}),i}Oe.registerChannelzSocket=CO;function EO(n){switch(n.kind){case"channel":delete tl[n.id];return;case"subchannel":delete Hm[n.id];return;case"server":delete ti[n.id];return;case"socket":delete Km[n.id];return}}Oe.unregisterChannelzRef=EO;function wO(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function qE(n){if(n==="")return[];let e=n.split(":").map(r=>wO(r));return[].concat(...e)}function TO(n){if((0,BE.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,BE.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(qE(e)),s=Buffer.from(qE(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function zE(n){switch(n){case el.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case el.ConnectivityState.IDLE:return{state:"IDLE"};case el.ConnectivityState.READY:return{state:"READY"};case el.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case el.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function vr(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function GE(n){let e=n.getInfo();return{ref:Um(n.ref),data:{target:e.target,state:zE(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:vr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>Um(t)),subchannel_ref:e.children.subchannels.map(t=>Wm(t))}}function AO(n,e){let t=Number.parseInt(n.request.channel_id),r=tl[t];if(r===void 0){e({code:nl.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:GE(r)})}function IO(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<tl.length;i++){let s=tl[i];if(s!==void 0&&(r.push(GE(s)),r.length>=t))break}e(null,{channel:r,end:i>=ti.length})}function jE(n){let e=n.getInfo();return{ref:yO(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:vr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>Pu(t))}}function DO(n,e){let t=Number.parseInt(n.request.server_id),r=ti[t];if(r===void 0){e({code:nl.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:jE(r)})}function kO(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<ti.length;i++){let s=ti[i];if(s!==void 0&&(r.push(jE(s)),r.length>=t))break}e(null,{server:r,end:i>=ti.length})}function RO(n,e){let t=Number.parseInt(n.request.subchannel_id),r=Hm[t];if(r===void 0){e({code:nl.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:Wm(r.ref),data:{target:i.target,state:zE(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:vr(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>Pu(o))};e(null,{subchannel:s})}function UE(n){var e;return(0,pO.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=TO(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function xO(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=Km[a];if(l===void 0){e({code:nl.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,d={ref:Pu(l.ref),local:c.localAddress?UE(c.localAddress):null,remote:c.remoteAddress?UE(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:vr(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:vr(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:vr(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:vr(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:d})}function MO(n,e){let t=Number.parseInt(n.request.server_id),r=ti[t];if(r===void 0){e({code:nl.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,d)=>u.id-d.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(Pu(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function WE(){return{GetChannel:AO,GetTopChannels:IO,GetServer:DO,GetServers:kO,GetSubchannel:RO,GetSocket:xO,GetServerSockets:MO}}Oe.getChannelzHandlers=WE;var Ou=null;function HE(){if(Ou)return Ou;let n=qm().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return Ou=(0,gO.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,Ou}Oe.getChannelzServiceDefinition=HE;function NO(){(0,mO.registerAdminService)(HE,WE)}Oe.setup=NO});var KE=k(Bu=>{"use strict";Object.defineProperty(Bu,"__esModule",{value:!0});Bu.Subchannel=void 0;var Re=cn(),OO=Oa(),$m=Ge(),Lu=ye(),PO=tn(),FO=Gn(),oo=Wi(),LO="subchannel",BO=~(1<<31),Qm=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=Re.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new oo.ChannelzCallTracker,this.childrenTracker=new oo.ChannelzChildrenTracker,this.streamTracker=new oo.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new OO.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,FO.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new oo.ChannelzTrace,this.channelzRef=(0,oo.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){$m.trace(Lu.LogVerbosity.DEBUG,LO,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){$m.trace(Lu.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([Re.ConnectivityState.TRANSIENT_FAILURE],Re.ConnectivityState.CONNECTING):this.transitionToState([Re.ConnectivityState.TRANSIENT_FAILURE],Re.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,BO);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([Re.ConnectivityState.CONNECTING],Re.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([Re.ConnectivityState.READY],Re.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,$m.log(Lu.LogVerbosity.ERROR,`Connection to ${(0,PO.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([Re.ConnectivityState.CONNECTING],Re.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(Re.ConnectivityState[this.connectivityState]+" -> "+Re.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Re.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case Re.ConnectivityState.READY:this.stopBackoff();break;case Re.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case Re.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case Re.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,oo.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([Re.ConnectivityState.CONNECTING,Re.ConnectivityState.READY],Re.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===Lu.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([Re.ConnectivityState.IDLE],Re.ConnectivityState.CONNECTING)||this.connectivityState===Re.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([Re.ConnectivityState.TRANSIENT_FAILURE],Re.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};Bu.Subchannel=Qm});var Zm=k(ii=>{"use strict";Object.defineProperty(ii,"__esModule",{value:!0});ii.setup=ii.DEFAULT_PORT=void 0;var $E=Un(),YE=Ce("dns"),JE=Ce("util"),VO=up(),Ym=ye(),Jm=Ut(),qO=Ge(),UO=ye(),ni=tn(),QE=Ce("net"),zO=Oa(),GO="dns_resolver";function ri(n){qO.trace(UO.LogVerbosity.DEBUG,GO,n)}ii.DEFAULT_PORT=443;var jO=3e4,WO=JE.promisify(YE.resolveTxt),HO=JE.promisify(YE.lookup);function KO(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var Xm=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,ri("Resolver constructed for target "+(0,ni.uriToString)(e));let a=(0,ni.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,QE.isIPv4)(a.host)||(0,QE.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:ii.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:ii.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:Ym.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,ni.uriToString)(this.target)}`,metadata:new Jm.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new zO.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:jO,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(ri("Returning IP address for target "+(0,ni.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)ri("Failed to parse DNS address "+(0,ni.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:Ym.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,ni.uriToString)(this.target)}`,metadata:new Jm.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;ri("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=HO(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=KO(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(ri("Resolved addresses for target "+(0,ni.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(ri("Resolution error for target "+(0,ni.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=WO(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,VO.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:Ym.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new Jm.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?ri('resolution update delayed by "min time between resolutions" rate limit'):ri("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function $O(){(0,$E.registerResolver)("dns",Xm),(0,$E.registerDefaultScheme)("dns")}ii.setup=$O});var eg=k(co=>{"use strict";Object.defineProperty(co,"__esModule",{value:!0});co.getProxiedConnection=co.mapProxyName=void 0;var rl=Ge(),ao=ye(),QO=Un(),YO=Ce("http"),JO=Ce("tls"),XO=Ge(),XE=Gn(),lo=tn(),ZO=Ce("url"),eP=Zm(),tP="proxy";function si(n){XO.trace(ao.LogVerbosity.DEBUG,tP,n)}function nP(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new ZO.URL(n)}catch{return(0,rl.log)(ao.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,rl.log)(ao.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,rl.log)(ao.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),si("Proxy server "+o.address+" set by environment variable "+e),o}function rP(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(si("No proxy server list set by environment variable "+e),n.split(",")):[]}function iP(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=nP();if(!i.address)return r;let s=(0,lo.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of rP())if(l===o)return si("Not using proxy for target in no_proxy list: "+(0,lo.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,lo.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}co.mapProxyName=iP;function sP(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,lo.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,lo.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:eP.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,XE.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,XE.subchannelAddressToString)(n);return si("Using proxy "+u+" to connect to "+l.path),new Promise((d,f)=>{let v=YO.request(l);v.once("connect",(w,A,T)=>{var O;if(v.removeAllListeners(),A.removeAllListeners(),w.statusCode===200)if(si("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let D=(0,QO.getDefaultAuthority)(s),P=(0,lo.splitHostPort)(D),F=(O=P?.host)!==null&&O!==void 0?O:D,j=JO.connect(Object.assign({host:F,servername:F,socket:A},t),()=>{si("Successfully established a TLS connection to "+l.path+" through proxy "+u),d({socket:j,realTarget:s})});j.on("error",X=>{si("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+X.message),f()})}else si("Successfully established a plaintext connection to "+l.path+" through proxy "+u),d({socket:A,realTarget:s});else(0,rl.log)(ao.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+w.statusCode),f()}),v.once("error",w=>{v.removeAllListeners(),(0,rl.log)(ao.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+w.message),f()}),v.end()})}co.getProxiedConnection=sP});var ng=k(Vu=>{"use strict";Object.defineProperty(Vu,"__esModule",{value:!0});Vu.StreamDecoder=void 0;var _r=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(_r||{}),tg=class{constructor(e){this.maxReadMessageLength=e,this.readState=_r.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case _r.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=_r.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case _r.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.maxReadMessageLength!==-1&&this.readMessageSize>this.maxReadMessageLength)throw new Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=_r.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=_r.NO_DATA,i.push(s)}}break;case _r.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=_r.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};Vu.StreamDecoder=tg});var ZE=k(qu=>{"use strict";Object.defineProperty(qu,"__esModule",{value:!0});qu.Http2SubchannelCall=void 0;var Sr=Ce("http2"),oP=Ce("os"),Ee=ye(),oi=Ut(),aP=ng(),lP=Ge(),cP=ye(),uP="subchannel_call";function dP(n){for(let[e,t]of Object.entries(oP.constants.errno))if(t===n)return e;return"Unknown system error "+n}var rg=class{constructor(e,t,r,i,s){var o;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=Ee.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let a=(o=i.getOptions()["grpc.max_receive_message_length"])!==null&&o!==void 0?o:Ee.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new aP.StreamDecoder(a),e.on("response",(l,c)=>{let u="";for(let d of Object.keys(l))u+="		"+d+": "+l[d]+`
`;switch(this.trace(`Received server headers:
`+u),l[":status"]){case 400:this.mappedStatusCode=Ee.Status.INTERNAL;break;case 401:this.mappedStatusCode=Ee.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=Ee.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=Ee.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=Ee.Status.UNAVAILABLE;break;default:this.mappedStatusCode=Ee.Status.UNKNOWN}if(c&Sr.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(l);else{let d;try{d=oi.Metadata.fromHttp2Headers(l)}catch(f){this.endCall({code:Ee.Status.UNKNOWN,details:f.message,metadata:new oi.Metadata});return}this.listener.onReceiveMetadata(d)}}),e.on("trailers",l=>{this.handleTrailers(l)}),e.on("data",l=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+l.length);let c;try{c=this.decoder.write(l)}catch(u){this.cancelWithStatus(Ee.Status.RESOURCE_EXHAUSTED,u.message);return}for(let u of c)this.trace("parsed message of length "+u.length),this.callEventTracker.addMessageReceived(),this.tryPush(u)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var l;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((l=this.finalStatus)===null||l===void 0?void 0:l.code)===Ee.Status.OK)return;let c,u="";switch(e.rstCode){case Sr.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;c=Ee.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`;break;case Sr.constants.NGHTTP2_REFUSED_STREAM:c=Ee.Status.UNAVAILABLE,u="Stream refused by server";break;case Sr.constants.NGHTTP2_CANCEL:c=Ee.Status.CANCELLED,u="Call cancelled";break;case Sr.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=Ee.Status.RESOURCE_EXHAUSTED,u="Bandwidth exhausted or memory limit exceeded";break;case Sr.constants.NGHTTP2_INADEQUATE_SECURITY:c=Ee.Status.PERMISSION_DENIED,u="Protocol not secure enough";break;case Sr.constants.NGHTTP2_INTERNAL_ERROR:c=Ee.Status.INTERNAL,this.internalError===null?u=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(c=Ee.Status.UNAVAILABLE,u=this.internalError.message):u=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=Ee.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:c,details:u,metadata:new oi.Metadata,rstCode:e.rstCode})})}),e.on("error",l=>{l.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+l.message+" code="+l.code+" errno="+dP(l.errno)+" syscall="+l.syscall),this.internalError=l),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:Ee.Status.UNAVAILABLE,details:"Connection dropped",metadata:new oi.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){lP.trace(cP.LogVerbosity.DEBUG,uP,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===Ee.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==Ee.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=oi.Metadata.fromHttp2Headers(e)}catch{r=new oi.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===Ee.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in Ee.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===Ee.Status.OK?t=Sr.constants.NGHTTP2_NO_ERROR:t=Sr.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new oi.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==Ee.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=Ee.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=Ee.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:Ee.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new oi.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};qu.Http2SubchannelCall=rg});var ig=k(Uu=>{"use strict";Object.defineProperty(Uu,"__esModule",{value:!0});Uu.getNextCallNumber=void 0;var hP=0;function fP(){return hP++}Uu.getNextCallNumber=fP});var nw=k(Gu=>{"use strict";Object.defineProperty(Gu,"__esModule",{value:!0});Gu.Http2SubchannelConnector=void 0;var cg=Ce("http2"),ew=Ce("tls"),sg=Wi(),il=ye(),pP=eg(),ho=Ge(),tw=Un(),zu=Gn(),uo=tn(),mP=Ce("net"),gP=ZE(),yP=ig(),og="transport",vP="transport_flowctrl",_P=Hf().version,{HTTP2_HEADER_AUTHORITY:SP,HTTP2_HEADER_CONTENT_TYPE:bP,HTTP2_HEADER_METHOD:CP,HTTP2_HEADER_PATH:EP,HTTP2_HEADER_TE:wP,HTTP2_HEADER_USER_AGENT:TP}=cg.constants,AP=2e4,IP=Buffer.from("too_many_pings","ascii"),ag=class{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=AP,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new sg.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,zu.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,sg.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${_P}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===cg.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(IP)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),ho.isTracerEnabled(og)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,zu.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,zu.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),d=c.getCertificate(),f=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:f&&"raw"in f?f.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){ho.trace(il.LogVerbosity.DEBUG,og,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){ho.trace(il.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){ho.trace(il.LogVerbosity.DEBUG,vP,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){ho.trace(il.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[SP]=t,o[TP]=this.userAgent,o[bP]="application/grpc",o[CP]="POST",o[EP]=r,o[wP]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}},c=new gP.Http2SubchannelCall(a,l,i,this,(0,yP.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,sg.unregisterChannelzRef)(this.channelzRef)}},lg=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){ho.trace(il.LogVerbosity.DEBUG,og,(0,uo.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,uo.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,uo.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,zu.subchannelAddressToString)(e)));let d=(0,tw.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),f=t._getConnectionOptions()||{};f.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?f.maxSessionMemory=r["grpc-node.max_session_memory"]:f.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in f){if(v="https://",r["grpc.ssl_target_name_override"]){let T=r["grpc.ssl_target_name_override"];f.checkServerIdentity=(O,D)=>(0,ew.checkServerIdentity)(T,D),f.servername=T}else{let T=(c=(l=(0,uo.splitHostPort)(d))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";f.servername=T}i.socket&&(f.createConnection=(T,O)=>i.socket)}else f.createConnection=(T,O)=>i.socket?i.socket:mP.connect(e);f=Object.assign(Object.assign(Object.assign({},f),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let w=cg.connect(v+d,f);this.session=w;let A="Failed to connect";w.unref(),w.once("connect",()=>{w.removeAllListeners(),s(new ag(w,e,r,u)),this.session=null}),w.once("close",()=>{this.session=null,setImmediate(()=>{o(`${A} (${new Date().toISOString()})`)})}),w.once("error",T=>{A=T.message,this.trace("connection failed with error "+A)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,ew.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,tw.getDefaultAuthority)((i=(0,uo.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,uo.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,pP.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};Gu.Http2SubchannelConnector=lg});var rw=k(fo=>{"use strict";Object.defineProperty(fo,"__esModule",{value:!0});fo.getSubchannelPool=fo.SubchannelPool=void 0;var DP=zS(),kP=KE(),RP=Gn(),xP=tn(),MP=nw(),NP=1e4,sl=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},NP),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,xP.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,RP.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,DP.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new kP.Subchannel(e,t,r,i,new MP.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};fo.SubchannelPool=sl;var OP=new sl;function PP(n){return n?OP:new sl}fo.getSubchannelPool=PP});var dg=k(po=>{"use strict";Object.defineProperty(po,"__esModule",{value:!0});po.FilterStackFactory=po.FilterStack=void 0;var ju=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};po.FilterStack=ju;var ug=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new ju(this.factories.map(e=>e.createFilter()))}};po.FilterStackFactory=ug});var hg=k(Wu=>{"use strict";Object.defineProperty(Wu,"__esModule",{value:!0});Wu.CompressionAlgorithms=void 0;var iw=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(iw||(Wu.CompressionAlgorithms=iw={}))});var pg=k(Hu=>{"use strict";Object.defineProperty(Hu,"__esModule",{value:!0});Hu.BaseFilter=void 0;var fg=class{sendMetadata(e){return C(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return C(this,null,function*(){return e})}receiveMessage(e){return C(this,null,function*(){return e})}receiveTrailers(e){return e}};Hu.BaseFilter=fg});var aw=k(go=>{"use strict";Object.defineProperty(go,"__esModule",{value:!0});go.CompressionFilterFactory=go.CompressionFilter=void 0;var Ku=Ce("zlib"),ow=hg(),$u=ye(),FP=pg(),LP=Ge(),BP=n=>typeof n=="number"&&typeof ow.CompressionAlgorithms[n]=="string",mo=class{writeMessage(e,t){return C(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return C(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},Hi=class extends mo{compressMessage(e){return C(this,null,function*(){return e})}writeMessage(e,t){return C(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},mg=class extends mo{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{Ku.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=Ku.createInflate();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:$u.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},gg=class extends mo{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{Ku.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=Ku.createGunzip();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:$u.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},yg=class extends mo{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function sw(n,e){switch(n){case"identity":return new Hi;case"deflate":return new mg(e);case"gzip":return new gg(e);default:return new yg(n)}}var Qu=class extends FP.BaseFilter{constructor(e,t){var r,i;super(),this.sharedFilterConfig=t,this.sendCompression=new Hi,this.receiveCompression=new Hi,this.currentCompressionAlgorithm="identity";let s=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=(r=e["grpc.max_receive_message_length"])!==null&&r!==void 0?r:$u.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,s!==void 0)if(BP(s)){let o=ow.CompressionAlgorithms[s],a=(i=t.serverSupportedEncodingHeader)===null||i===void 0?void 0:i.split(",");(!a||a.includes(o))&&(this.currentCompressionAlgorithm=o,this.sendCompression=sw(this.currentCompressionAlgorithm,-1))}else LP.log($u.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${s}`)}sendMetadata(e){return C(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=sw(i,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new Hi,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return C(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof Hi?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return C(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};go.CompressionFilter=Qu;var vg=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new Qu(this.options,this.sharedFilterConfig)}};go.CompressionFilterFactory=vg});var Yu=k(Zn=>{"use strict";Object.defineProperty(Zn,"__esModule",{value:!0});Zn.deadlineToString=Zn.getRelativeTimeout=Zn.getDeadlineTimeoutString=Zn.minDeadline=void 0;function VP(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}Zn.minDeadline=VP;var qP=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function UP(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of qP){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}Zn.getDeadlineTimeoutString=UP;var zP=2147483647;function GP(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>zP?1/0:r}Zn.getRelativeTimeout=GP;function jP(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}Zn.deadlineToString=jP});var Xu=k(Ju=>{"use strict";Object.defineProperty(Ju,"__esModule",{value:!0});Ju.restrictControlPlaneStatusCode=void 0;var er=ye(),WP=[er.Status.OK,er.Status.INVALID_ARGUMENT,er.Status.NOT_FOUND,er.Status.ALREADY_EXISTS,er.Status.FAILED_PRECONDITION,er.Status.ABORTED,er.Status.OUT_OF_RANGE,er.Status.DATA_LOSS];function HP(n,e){return WP.includes(n)?{code:er.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${er.Status[n]} ${e}`}:{code:n,details:e}}Ju.restrictControlPlaneStatusCode=HP});var cw=k(td=>{"use strict";Object.defineProperty(td,"__esModule",{value:!0});td.LoadBalancingCall=void 0;var lw=cn(),Zu=ye(),KP=Yu(),ed=Ut(),ol=jr(),$P=tn(),QP=Ge(),_g=Xu(),YP=Ce("http2"),JP="load_balancing_call",Sg=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),d="";u.length>=2&&(d=u[1]);let f=(c=(l=(0,$P.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${f}/${d}`}trace(e){QP.trace(Zu.LogVerbosity.DEBUG,JP,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+ol.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case ol.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let d=this.metadata.clone();if(d.merge(a),d.get("authorization").length>1&&this.outputStatus({code:Zu.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new ed.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==lw.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+lw.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&d.set("grpc-timeout",(0,KP.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(d,this.host,this.methodName,{onReceiveMetadata:f=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(f)},onReceiveMessage:f=>{this.trace("Received message"),this.listener.onReceiveMessage(f)},onReceiveStatus:f=>{this.trace("Received status"),f.rstCode===YP.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(f,"REFUSED"):this.outputStatus(f,"PROCESSED")}})}catch(f){this.trace("Failed to start call on picked subchannel "+i+" with error "+f.message),this.outputStatus({code:Zu.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+f.message,metadata:new ed.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,_g.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:Zu.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new ed.Metadata},"PROCESSED")});break;case ol.PickResultType.DROP:let{code:s,details:o}=(0,_g.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case ol.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,_g.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case ol.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new ed.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};td.LoadBalancingCall=Sg});var dw=k(rd=>{"use strict";Object.defineProperty(rd,"__esModule",{value:!0});rd.ResolvingCall=void 0;var yo=ye(),nd=Yu(),uw=Ut(),XP=Ge(),ZP=Xu(),eF="resolving_call",bg=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&yo.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(yo.Status.CANCELLED,"Cancelled by parent call")}),r.flags&yo.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,nd.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){XP.trace(yo.LogVerbosity.DEBUG,eF,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,nd.deadlineToString)(this.deadline));let e=(0,nd.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(yo.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==yo.Status.OK){let{code:r,details:i}=(0,ZP.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new uw.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,nd.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new uw.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};rd.ResolvingCall=bg});var hw=k(ai=>{"use strict";Object.defineProperty(ai,"__esModule",{value:!0});ai.RetryingCall=ai.MessageBufferTracker=ai.RetryThrottler=void 0;var id=ye(),tF=Ut(),nF=Ge(),rF="retrying_call",Eg=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};ai.RetryThrottler=Eg;var wg=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};ai.MessageBufferTracker=wg;var Cg="grpc-previous-rpc-attempts",Tg=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){nF.trace(id.LogVerbosity.DEBUG,rF,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new tF.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(id.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===id.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===id.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(Cg,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(Cg,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(Cg,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};ai.RetryingCall=Tg});var od=k(sd=>{"use strict";Object.defineProperty(sd,"__esModule",{value:!0});sd.BaseSubchannelWrapper=void 0;var Ag=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};sd.BaseSubchannelWrapper=Ag});var mw=k(cd=>{"use strict";Object.defineProperty(cd,"__esModule",{value:!0});cd.InternalChannel=void 0;var iF=Wc(),sF=US(),oF=rw(),fw=jr(),al=ye(),aF=dg(),lF=aw(),pw=Un(),Ig=Ge(),cF=eg(),ad=tn(),tr=cn(),ll=Wi(),uF=cw(),dF=Yu(),hF=dw(),Dg=ig(),fF=Xu(),kg=hw(),pF=od(),mF=2147483647,gF=1e3,yF=30*60*1e3,ld=new Map,vF=1<<24,_F=1<<20,Rg=class extends pF.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},xg=class{constructor(e,t,r){var i,s,o,a,l,c,u,d;if(this.credentials=t,this.options=r,this.connectivityState=tr.ConnectivityState.IDLE,this.currentPicker=new fw.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new ll.ChannelzCallTracker,this.childrenTracker=new ll.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof iF.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let f=(0,ad.parseUri)(e);if(f===null)throw new Error(`Could not parse target name "${e}"`);let v=(0,pw.mapUriDefaultScheme)(f);if(v===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},mF),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new ll.ChannelzTrace,this.channelzRef=(0,ll.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,pw.getDefaultAuthority)(v);let w=(0,cF.mapProxyName)(v,r);this.target=w.target,this.options=Object.assign({},this.options,w.extraOptions),this.subchannelPool=(0,oF.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new kg.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:vF,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:_F),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:yF,gF);let A={createSubchannel:(O,D)=>{let P=this.subchannelPool.getOrCreateSubchannel(this.target,O,Object.assign({},this.options,D),this.credentials);P.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",P.getChannelzRef());let F=new Rg(P,this);return this.wrappedSubchannels.add(F),F},updateState:(O,D)=>{this.currentPicker=D;let P=this.pickQueue.slice();this.pickQueue=[],P.length>0&&this.callRefTimerUnref();for(let F of P)F.doPick();this.updateState(O)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:O=>{this.channelzEnabled&&this.childrenTracker.refChild(O)},removeChannelzChild:O=>{this.channelzEnabled&&this.childrenTracker.unrefChild(O)}};this.resolvingLoadBalancer=new sF.ResolvingLoadBalancer(this.target,A,r,(O,D)=>{O.retryThrottling?ld.set(this.getTarget(),new kg.RetryThrottler(O.retryThrottling.maxTokens,O.retryThrottling.tokenRatio,ld.get(this.getTarget()))):ld.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=D,this.currentResolutionError=null,process.nextTick(()=>{let P=this.configSelectionQueue;this.configSelectionQueue=[],P.length>0&&this.callRefTimerUnref();for(let F of P)F.getConfig()})},O=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+O.code+' and details "'+O.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,fF.restrictControlPlaneStatusCode)(O.code,O.details)),{metadata:O.metadata}));let D=this.configSelectionQueue;this.configSelectionQueue=[],D.length>0&&this.callRefTimerUnref();for(let P of D)P.reportResolverError(O)}),this.filterStackFactory=new aF.FilterStackFactory([new lF.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let T=new Error;(0,Ig.trace)(al.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((d=T.stack)===null||d===void 0?void 0:d.substring(T.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,Ig.trace)(t??al.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,ad.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,Ig.trace)(al.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,ad.uriToString)(this.target)+" "+tr.ConnectivityState[this.connectivityState]+" -> "+tr.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+tr.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==tr.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(tr.ConnectivityState.IDLE),this.currentPicker=new fw.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==tr.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===al.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,Dg.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new uF.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,Dg.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new kg.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,ld.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,Dg.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,dF.deadlineToString)(t));let a={deadline:t,flags:s??al.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new hF.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(tr.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,ll.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,ad.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===tr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===tr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};cd.InternalChannel=xg});var Pp=k(ud=>{"use strict";Object.defineProperty(ud,"__esModule",{value:!0});ud.ChannelImplementation=void 0;var SF=Wc(),bF=mw(),Mg=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof SF.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new bF.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};ud.ChannelImplementation=Mg});var ww=k(vn=>{"use strict";Object.defineProperty(vn,"__esModule",{value:!0});vn.Http2ServerCallStream=vn.ServerDuplexStreamImpl=vn.ServerWritableStreamImpl=vn.ServerReadableStreamImpl=vn.ServerUnaryCallImpl=void 0;var bw=Ce("events"),vo=Ce("http2"),Pg=Ce("stream"),gw=Ce("zlib"),Me=ye(),Fg=Ut(),CF=ng(),Cw=Ge(),ul=Vc(),Ew="server_call";function cl(n){Cw.trace(Me.LogVerbosity.DEBUG,Ew,n)}var EF="grpc-accept-encoding",wF="grpc-encoding",yw="grpc-message",vw="grpc-status",_w="grpc-timeout",TF=/(\d{1,8})\s*([HMSmun])/,AF={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},IF={[EF]:"identity,deflate,gzip",[wF]:"identity"},Sw={[vo.constants.HTTP2_HEADER_STATUS]:vo.constants.HTTP_STATUS_OK,[vo.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},DF={waitForTrailers:!0},Ng=class extends bw.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};vn.ServerUnaryCallImpl=Ng;var dd=class extends Pg.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};vn.ServerReadableStreamImpl=dd;var dl=class extends Pg.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new Fg.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,ul.getErrorMessage)(i),code:Me.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:Me.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};vn.ServerWritableStreamImpl=dl;var _o=class extends Pg.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new Fg.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};vn.ServerDuplexStreamImpl=_o;_o.prototype._read=dd.prototype._read;_o.prototype._write=dl.prototype._write;_o.prototype._final=dl.prototype._final;var Og=class extends bw.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=Me.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Me.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;cl("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:Me.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if(t==="identity")return r;if(t==="deflate"||t==="gzip"){let i;return t==="deflate"?i=gw.createInflate():i=gw.createGunzip(),new Promise((s,o)=>{let a=0,l=[];i.on("data",c=>{l.push(c),a+=c.byteLength,this.maxReceiveMessageSize!==-1&&a>this.maxReceiveMessageSize&&(i.destroy(),o({code:Me.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),i.on("end",()=>{s(Buffer.concat(l))}),i.write(r),i.end()})}else return Promise.reject({code:Me.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},Sw),IF),t);this.stream.respond(r,DF)}receiveMetadata(e){let t=Fg.Metadata.fromHttp2Headers(e);Cw.isTracerEnabled(Ew)&&cl("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(_w);if(r.length>0){let i=r[0].toString().match(TF);if(i===null){let a=new Error("Invalid deadline");return a.code=Me.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*AF[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(kF,s,this),t.remove(_w)}return t.remove(vo.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(vo.constants.HTTP2_HEADER_TE),t.remove(vo.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(d){if(s+=d.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:Me.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(d)}function u(d){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),d!==void 0){r({code:Me.Status.INTERNAL,details:d.message});return}if(s===0){r({code:Me.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let f=Buffer.concat(a,s),w=f.readUInt8(0)===1?e:"identity",A=o.getDecompressedMessage(f,w);if(Buffer.isBuffer(A)){t(o.deserializeMessageWithInternalError(A));return}A.then(T=>t(o.deserializeMessageWithInternalError(T)),T=>r(T.code?T:{code:Me.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return C(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,ul.getErrorMessage)(t),code:Me.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return C(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:Me.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,ul.getErrorMessage)(s),code:Me.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===Me.Status.OK),!this.checkCancelled())if(cl("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+Me.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[vw]:e.code,[yw]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[vw]:e.code,[yw]:encodeURI(e.details)},Sw),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:Me.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:Me.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new CF.StreamDecoder(this.maxReceiveMessageSize),i=!1,s=!1,o=!1,a=()=>C(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>C(this,null,function*(){let c;try{c=r.write(l)}catch(u){this.sendError({code:Me.Status.RESOURCE_EXHAUSTED,details:u.message});return}s=!0,this.stream.pause();for(let u of c){this.emit("receiveMessage");let f=u.readUInt8(0)===1?t:"identity",v;try{v=yield this.getDecompressedMessage(u,f)}catch(w){this.sendError(w);return}if(!v)return;yield this.pushOrBufferMessage(e,v)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>C(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return C(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return C(this,null,function*(){if(t===null){cl("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}cl("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,ul.getErrorCode)(r);(i===null||i<Me.Status.OK||i>Me.Status.UNAUTHENTICATED)&&(i=Me.Status.INTERNAL),e.emit("error",{details:(0,ul.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};vn.Http2ServerCallStream=Og;function kF(n){let e=new Error("Deadline exceeded");e.code=Me.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var Vg=k(hd=>{"use strict";Object.defineProperty(hd,"__esModule",{value:!0});hd.ServerCredentials=void 0;var Tw=sp(),hl=class{static createInsecure(){return new Lg}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new Bg({ca:e||(0,Tw.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:Tw.CIPHER_SUITES})}};hd.ServerCredentials=hl;var Lg=class extends hl{_isSecure(){return!1}_getSettings(){return null}},Bg=class extends hl{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var Dw=k(md=>{"use strict";Object.defineProperty(md,"__esModule",{value:!0});md.Server=void 0;var li=Ce("http2"),br=ye(),Ki=ww(),RF=Vg(),Aw=Un(),fd=Ge(),Rn=Gn(),xF=tn(),jt=Wi(),pd=~(1<<31),MF=~(1<<31),NF=2e4,{HTTP2_HEADER_PATH:Iw}=li.constants,OF="server";function PF(){}function qg(n){return{code:br.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function FF(n,e){let t=qg(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var Ug=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new jt.ChannelzTrace,this.callTracker=new jt.ChannelzCallTracker,this.listenerChildrenTracker=new jt.ChannelzChildrenTracker,this.sessionChildrenTracker=new jt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,jt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:pd,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:pd,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:MF,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:NF,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,Rn.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,Rn.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let d=o,f=d.getCipher(),v=d.getCertificate(),w=d.getPeerCertificate();c={cipherSuiteStandardName:(t=f.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:f.standardName?null:f.name,localCertificate:v&&"raw"in v?v.raw:null,remoteCertificate:w&&"raw"in w?w.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){fd.trace(br.LogVerbosity.DEBUG,OF,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=FF(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof RF.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,xF.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,Aw.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(v,w)=>{process.nextTick(()=>r(v,w))},l=()=>{let v;if(t._isSecure()){let w=Object.assign(o,t._getSettings());w.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,v=li.createSecureServer(w),v.on("secureConnection",A=>{A.on("error",T=>{this.trace("An incoming TLS connection closed with error: "+T.message)})})}else v=li.createServer(o);return v.setTimeout(0,PF),this._setupHandlers(v),v},c=(v,w,A)=>v.length===0?Promise.resolve({port:w,count:A}):Promise.all(v.map(T=>{this.trace("Attempting to bind "+(0,Rn.subchannelAddressToString)(T));let O;(0,Rn.isTcpSubchannelAddress)(T)?O={host:T.host,port:w}:O=T;let D=l();return new Promise((P,F)=>{let j=X=>{this.trace("Failed to bind "+(0,Rn.subchannelAddressToString)(T)+" with error "+X.message),P(X)};D.once("error",j),D.listen(O,()=>{if(this.shutdown){D.close(),P(new Error("bindAsync failed because server is shutdown"));return}let X=D.address(),S;typeof X=="string"?S={path:X}:S={host:X.address,port:X.port};let g=(0,jt.registerChannelzSocket)((0,Rn.subchannelAddressToString)(S),()=>({localAddress:S,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(g),this.http2ServerList.push({server:D,channelzRef:g}),this.trace("Successfully bound "+(0,Rn.subchannelAddressToString)(S)),P("port"in S?S.port:w),D.removeListener("error",j)})})})).then(T=>{let O=0;for(let D of T)if(typeof D=="number"&&(O+=1,D!==w))throw new Error("Invalid state: multiple port numbers added from single address");return{port:w,count:O+A}}),u=v=>{if(v.length===0)return Promise.resolve({port:0,count:0});let w=v[0],A=l();return new Promise((T,O)=>{let D=P=>{this.trace("Failed to bind "+(0,Rn.subchannelAddressToString)(w)+" with error "+P.message),T(u(v.slice(1)))};A.once("error",D),A.listen(w,()=>{if(this.shutdown){A.close(),T({port:0,count:0});return}let P=A.address(),F={host:P.address,port:P.port},j=(0,jt.registerChannelzSocket)((0,Rn.subchannelAddressToString)(F),()=>({localAddress:F,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(j),this.http2ServerList.push({server:A,channelzRef:j}),this.trace("Successfully bound "+(0,Rn.subchannelAddressToString)(F)),T(c(v.slice(1),P.port,1)),A.removeListener("error",D)})})},d={onSuccessfulResolution:(v,w,A)=>{if(d.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),v.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let T;(0,Rn.isTcpSubchannelAddress)(v[0])?v[0].port===0?T=u(v):T=c(v,v[0].port,0):T=c(v,1,0),T.then(O=>{if(O.count===0){let D=`No address added out of total ${v.length} resolved`;fd.log(br.LogVerbosity.ERROR,D),a(new Error(D),0)}else O.count<v.length&&fd.log(br.LogVerbosity.INFO,`WARNING Only ${O.count} addresses added out of total ${v.length} resolved`),a(null,O.port)},O=>{let D=`No address added out of total ${v.length} resolved`;fd.log(br.LogVerbosity.ERROR,D),a(new Error(D),0)})},onError:v=>{a(new Error(v.details),0)}};(0,Aw.createResolver)(s,d,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,jt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(li.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,jt.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,jt.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,jt.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[li.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[li.constants.HTTP2_HEADER_STATUS]:li.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new Ki.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=br.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[Iw],s=this._retrieveHandler(i);if(!s){this._respondWithError(qg(i),e,r);return}let o=new Ki.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===br.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:br.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[Iw],i=this._retrieveHandler(r);if(!i){this._respondWithError(qg(r),e,null);return}let s=new Ki.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:br.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")LF(e,t,s,o);else if(a==="clientStream")BF(e,t,s,o);else if(a==="serverStream")VF(e,t,s,o);else if(a==="bidi")qF(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let d=(0,jt.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),f={ref:d,streamTracker:new jt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,f);let v=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+v),this.sessionChildrenTracker.refChild(d));let w=null,A=null,T=!1;if(this.maxConnectionAgeMs!==pd){let D=this.maxConnectionAgeMs/10,P=Math.random()*D*2-D;w=(l=(a=setTimeout(()=>{var F,j;T=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+v);try{s.goaway(li.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==pd&&(A=(j=(F=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||j===void 0?void 0:j.call(F))},this.maxConnectionAgeMs+P)).unref)===null||l===void 0?void 0:l.call(a)}let O=(u=(c=setInterval(()=>{var D,P;let F=(P=(D=setTimeout(()=>{T=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+v),s.close()},this.keepaliveTimeoutMs)).unref)===null||P===void 0?void 0:P.call(D);try{s.ping((j,X,S)=>{clearTimeout(F)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(T||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+v),this.sessionChildrenTracker.unrefChild(d),(0,jt.unregisterChannelzRef)(d)),w&&clearTimeout(w),A&&clearTimeout(A),O&&clearTimeout(O),this.sessions.delete(s)})})}};md.Server=Ug;function LF(n,e,t,r){return C(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Ki.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function BF(n,e,t,r){let i=new Ki.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function VF(n,e,t,r){return C(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Ki.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function qF(n,e,t,r){let i=new Ki.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var kw=k(gd=>{"use strict";Object.defineProperty(gd,"__esModule",{value:!0});gd.StatusBuilder=void 0;var zg=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};gd.StatusBuilder=zg});var Gg=k(ci=>{"use strict";Object.defineProperty(ci,"__esModule",{value:!0});ci.isDuration=ci.durationToMs=ci.msToDuration=void 0;function UF(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}ci.msToDuration=UF;function zF(n){return n.seconds*1e3+n.nanos/1e6|0}ci.durationToMs=zF;function GF(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}ci.isDuration=GF});var Jg=k(ui=>{"use strict";var jg;Object.defineProperty(ui,"__esModule",{value:!0});ui.setup=ui.OutlierDetectionLoadBalancer=ui.OutlierDetectionLoadBalancingConfig=void 0;var vd=cn(),xw=ye(),$i=Gg(),Mw=Xg(),Nw=qr(),jF=Xc(),WF=jr(),Rw=Gn(),HF=od(),KF=Ge(),$F="outlier_detection";function pt(n){KF.trace(xw.LogVerbosity.DEBUG,$F,n)}var Yg="outlier_detection",QF=((jg=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&jg!==void 0?jg:"true")==="true",YF={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},JF={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function So(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function Wg(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,$i.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function yd(n,e,t){let r=t?`${t}.${e}`:e;if(So(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var fl=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},YF),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},JF),o):null}getLoadBalancerName(){return Yg}toJsonObject(){return{interval:(0,$i.msToDuration)(this.intervalMs),base_ejection_time:(0,$i.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,$i.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(Wg(e,"interval"),Wg(e,"base_ejection_time"),Wg(e,"max_ejection_time"),yd(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");So(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),yd(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),So(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),So(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");yd(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),yd(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),So(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),So(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,$i.durationToMs)(e.interval):null,e.base_ejection_time?(0,$i.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,$i.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(Nw.validateLoadBalancingConfig))}};ui.OutlierDetectionLoadBalancingConfig=fl;var Kg=class extends HF.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?vd.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,vd.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,vd.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function Hg(){return{success:0,failure:0}}var $g=class{constructor(){this.activeBucket=Hg(),this.inactiveBucket=Hg()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=Hg()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},Qg=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===WF.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===xw.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},_d=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new jF.ChildLoadBalancerHandler((0,Mw.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,Rw.subchannelAddressToString)(t)),o=new Kg(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===vd.ConnectivityState.READY?e.updateState(t,new Qg(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;pt("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[d,f]of this.addressMap){let v=f.counter.getLastSuccesses(),w=f.counter.getLastFailures();pt("Stats for "+d+": successes="+v+" failures="+w+" targetRequestVolume="+r),v+w>=r&&(i+=1,s.push(v/(v+w)))}if(pt("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((d,f)=>d+f)/s.length,a=0;for(let d of s){let f=d-o;a+=f*f}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);pt("stdev="+c+" ejectionThreshold="+u);for(let[d,f]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let v=f.counter.getLastSuccesses(),w=f.counter.getLastFailures();if(v+w<r)continue;let A=v/(v+w);if(pt("Checking candidate "+d+" successRate="+A),A<u){let T=Math.random()*100;pt("Candidate "+d+" randomNumber="+T+" enforcement_percentage="+t.enforcement_percentage),T<t.enforcement_percentage&&(pt("Ejecting candidate "+d),this.eject(f,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;pt("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(pt("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;pt("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(pt("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(pt("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(pt("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof fl))return;let i=new Set;for(let o of e)i.add((0,Rw.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(pt("Adding map entry for "+o),this.addressMap.set(o,{counter:new $g,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(pt("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,Nw.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){pt("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else pt("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{pt("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return Yg}};ui.OutlierDetectionLoadBalancer=_d;function XF(){QF&&(0,Mw.registerLoadBalancerType)(Yg,_d,fl)}ui.setup=XF});var Xg=k(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.OutlierDetectionLoadBalancingConfig=te.BaseSubchannelWrapper=te.registerAdminService=te.FilterStackFactory=te.BaseFilter=te.PickResultType=te.QueuePicker=te.UnavailablePicker=te.ChildLoadBalancerHandler=te.subchannelAddressToString=te.validateLoadBalancingConfig=te.getFirstUsableConfig=te.registerLoadBalancerType=te.createChildChannelControlHelper=te.BackoffTimeout=te.durationToMs=te.uriToString=te.createResolver=te.registerResolver=te.log=te.trace=void 0;var Ow=Ge();Object.defineProperty(te,"trace",{enumerable:!0,get:function(){return Ow.trace}});Object.defineProperty(te,"log",{enumerable:!0,get:function(){return Ow.log}});var Pw=Un();Object.defineProperty(te,"registerResolver",{enumerable:!0,get:function(){return Pw.registerResolver}});Object.defineProperty(te,"createResolver",{enumerable:!0,get:function(){return Pw.createResolver}});var ZF=tn();Object.defineProperty(te,"uriToString",{enumerable:!0,get:function(){return ZF.uriToString}});var eL=Gg();Object.defineProperty(te,"durationToMs",{enumerable:!0,get:function(){return eL.durationToMs}});var tL=Oa();Object.defineProperty(te,"BackoffTimeout",{enumerable:!0,get:function(){return tL.BackoffTimeout}});var Sd=qr();Object.defineProperty(te,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Sd.createChildChannelControlHelper}});Object.defineProperty(te,"registerLoadBalancerType",{enumerable:!0,get:function(){return Sd.registerLoadBalancerType}});Object.defineProperty(te,"getFirstUsableConfig",{enumerable:!0,get:function(){return Sd.getFirstUsableConfig}});Object.defineProperty(te,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return Sd.validateLoadBalancingConfig}});var nL=Gn();Object.defineProperty(te,"subchannelAddressToString",{enumerable:!0,get:function(){return nL.subchannelAddressToString}});var rL=Xc();Object.defineProperty(te,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return rL.ChildLoadBalancerHandler}});var Zg=jr();Object.defineProperty(te,"UnavailablePicker",{enumerable:!0,get:function(){return Zg.UnavailablePicker}});Object.defineProperty(te,"QueuePicker",{enumerable:!0,get:function(){return Zg.QueuePicker}});Object.defineProperty(te,"PickResultType",{enumerable:!0,get:function(){return Zg.PickResultType}});var iL=pg();Object.defineProperty(te,"BaseFilter",{enumerable:!0,get:function(){return iL.BaseFilter}});var sL=dg();Object.defineProperty(te,"FilterStackFactory",{enumerable:!0,get:function(){return sL.FilterStackFactory}});var oL=eu();Object.defineProperty(te,"registerAdminService",{enumerable:!0,get:function(){return oL.registerAdminService}});var aL=od();Object.defineProperty(te,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return aL.BaseSubchannelWrapper}});var lL=Jg();Object.defineProperty(te,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return lL.OutlierDetectionLoadBalancingConfig}})});var Fw=k(bd=>{"use strict";Object.defineProperty(bd,"__esModule",{value:!0});bd.setup=void 0;var cL=Un(),ey=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function uL(){(0,cL.registerResolver)("unix",ey)}bd.setup=uL});var Uw=k(wd=>{"use strict";Object.defineProperty(wd,"__esModule",{value:!0});wd.setup=void 0;var Lw=Ce("net"),Cd=ye(),ty=Ut(),Bw=Un(),Vw=tn(),dL=Ge(),hL="ip_resolver";function qw(n){dL.trace(Cd.LogVerbosity.DEBUG,hL,n)}var ny="ipv4",ry="ipv6",fL=443,Ed=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,qw("Resolver constructed for target "+(0,Vw.uriToString)(e));let s=[];if(!(e.scheme===ny||e.scheme===ry)){this.error={code:Cd.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new ty.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,Vw.splitHostPort)(a);if(l===null){this.error={code:Cd.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new ty.Metadata};return}if(e.scheme===ny&&!(0,Lw.isIPv4)(l.host)||e.scheme===ry&&!(0,Lw.isIPv6)(l.host)){this.error={code:Cd.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new ty.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:fL})}this.addresses=s,qw("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function pL(){(0,Bw.registerResolver)(ny,Ed),(0,Bw.registerResolver)(ry,Ed)}wd.setup=pL});var jw=k(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0});nr.setup=nr.PickFirstLoadBalancer=nr.shuffled=nr.PickFirstLoadBalancingConfig=void 0;var zw=qr(),Et=cn(),Td=jr(),mL=Ge(),gL=ye(),yL="pick_first";function iy(n){mL.trace(gL.LogVerbosity.DEBUG,yL,n)}var pl="pick_first",vL=250,ml=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return pl}toJsonObject(){return{[pl]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};nr.PickFirstLoadBalancingConfig=ml;var sy=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Td.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function Gw(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}nr.shuffled=Gw;var Ad=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=Et.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(Et.ConnectivityState.READY,new sy(this.currentPick)):this.children.length===0?this.updateState(Et.ConnectivityState.IDLE,new Td.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(Et.ConnectivityState.TRANSIENT_FAILURE,new Td.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Et.ConnectivityState.CONNECTING,new Td.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==Et.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===Et.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===Et.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===Et.ConnectivityState.IDLE||i===Et.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===Et.ConnectivityState.IDLE&&(iy("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},vL)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(iy("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){iy(Et.ConnectivityState[this.currentState]+" -> "+Et.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===Et.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===Et.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof ml&&(t.getShuffleAddressList()&&(e=Gw(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===Et.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return pl}};nr.PickFirstLoadBalancer=Ad;function _L(){(0,zw.registerLoadBalancerType)(pl,Ad,ml),(0,zw.registerDefaultLoadBalancerType)(pl)}nr.setup=_L});var Hw=k(bo=>{"use strict";Object.defineProperty(bo,"__esModule",{value:!0});bo.setup=bo.RoundRobinLoadBalancer=void 0;var SL=qr(),wt=cn(),Id=jr(),bL=Gn(),CL=Ge(),EL=ye(),wL="round_robin";function Ww(n){CL.trace(EL.LogVerbosity.DEBUG,wL,n)}var Dd="round_robin",oy=class n{getLoadBalancerName(){return Dd}constructor(){}toJsonObject(){return{[Dd]:{}}}static createFromJson(e){return new n}},ay=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Id.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},kd=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=wt.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===wt.ConnectivityState.TRANSIENT_FAILURE||i===wt.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(wt.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===wt.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(wt.ConnectivityState.READY,new ay(e,t))}else this.countSubchannelsWithState(wt.ConnectivityState.CONNECTING)>0?this.updateState(wt.ConnectivityState.CONNECTING,new Id.QueuePicker(this)):this.countSubchannelsWithState(wt.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(wt.ConnectivityState.TRANSIENT_FAILURE,new Id.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(wt.ConnectivityState.IDLE,new Id.QueuePicker(this))}updateState(e,t){Ww(wt.ConnectivityState[this.currentState]+" -> "+wt.ConnectivityState[e]),e===wt.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),Ww("Connect to address list "+e.map(r=>(0,bL.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===wt.ConnectivityState.IDLE||i===wt.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Dd}};bo.RoundRobinLoadBalancer=kd;function TL(){(0,SL.registerLoadBalancerType)(Dd,kd,oy)}bo.setup=TL});var Yw=k(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.experimental=W.addAdminServicesToServer=W.getChannelzHandlers=W.getChannelzServiceDefinition=W.InterceptorConfigurationError=W.InterceptingCall=W.RequesterBuilder=W.ListenerBuilder=W.StatusBuilder=W.getClientChannel=W.ServerCredentials=W.Server=W.setLogVerbosity=W.setLogger=W.load=W.loadObject=W.CallCredentials=W.ChannelCredentials=W.waitForClientReady=W.closeClient=W.Channel=W.makeGenericClientConstructor=W.makeClientConstructor=W.loadPackageDefinition=W.Client=W.compressionAlgorithms=W.propagate=W.connectivityState=W.status=W.logVerbosity=W.Metadata=W.credentials=void 0;var Rd=rp();Object.defineProperty(W,"CallCredentials",{enumerable:!0,get:function(){return Rd.CallCredentials}});var AL=Pp();Object.defineProperty(W,"Channel",{enumerable:!0,get:function(){return AL.ChannelImplementation}});var IL=hg();Object.defineProperty(W,"compressionAlgorithms",{enumerable:!0,get:function(){return IL.CompressionAlgorithms}});var DL=cn();Object.defineProperty(W,"connectivityState",{enumerable:!0,get:function(){return DL.ConnectivityState}});var xd=Wc();Object.defineProperty(W,"ChannelCredentials",{enumerable:!0,get:function(){return xd.ChannelCredentials}});var Kw=Op();Object.defineProperty(W,"Client",{enumerable:!0,get:function(){return Kw.Client}});var ly=ye();Object.defineProperty(W,"logVerbosity",{enumerable:!0,get:function(){return ly.LogVerbosity}});Object.defineProperty(W,"status",{enumerable:!0,get:function(){return ly.Status}});Object.defineProperty(W,"propagate",{enumerable:!0,get:function(){return ly.Propagate}});var $w=Ge(),cy=Lp();Object.defineProperty(W,"loadPackageDefinition",{enumerable:!0,get:function(){return cy.loadPackageDefinition}});Object.defineProperty(W,"makeClientConstructor",{enumerable:!0,get:function(){return cy.makeClientConstructor}});Object.defineProperty(W,"makeGenericClientConstructor",{enumerable:!0,get:function(){return cy.makeClientConstructor}});var kL=Ut();Object.defineProperty(W,"Metadata",{enumerable:!0,get:function(){return kL.Metadata}});var RL=Dw();Object.defineProperty(W,"Server",{enumerable:!0,get:function(){return RL.Server}});var xL=Vg();Object.defineProperty(W,"ServerCredentials",{enumerable:!0,get:function(){return xL.ServerCredentials}});var ML=kw();Object.defineProperty(W,"StatusBuilder",{enumerable:!0,get:function(){return ML.StatusBuilder}});W.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:xd.ChannelCredentials.createInsecure,createSsl:xd.ChannelCredentials.createSsl,createFromSecureContext:xd.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:Rd.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:Rd.CallCredentials.createFromGoogleCredential,createEmpty:Rd.CallCredentials.createEmpty};var NL=n=>n.close();W.closeClient=NL;var OL=(n,e,t)=>n.waitForReady(e,t);W.waitForClientReady=OL;var PL=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};W.loadObject=PL;var FL=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};W.load=FL;var LL=n=>{$w.setLogger(n)};W.setLogger=LL;var BL=n=>{$w.setLoggerVerbosity(n)};W.setLogVerbosity=BL;var VL=n=>Kw.Client.prototype.getChannel.call(n);W.getClientChannel=VL;var Md=xp();Object.defineProperty(W,"ListenerBuilder",{enumerable:!0,get:function(){return Md.ListenerBuilder}});Object.defineProperty(W,"RequesterBuilder",{enumerable:!0,get:function(){return Md.RequesterBuilder}});Object.defineProperty(W,"InterceptingCall",{enumerable:!0,get:function(){return Md.InterceptingCall}});Object.defineProperty(W,"InterceptorConfigurationError",{enumerable:!0,get:function(){return Md.InterceptorConfigurationError}});var Qw=Wi();Object.defineProperty(W,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return Qw.getChannelzServiceDefinition}});Object.defineProperty(W,"getChannelzHandlers",{enumerable:!0,get:function(){return Qw.getChannelzHandlers}});var qL=eu();Object.defineProperty(W,"addAdminServicesToServer",{enumerable:!0,get:function(){return qL.addAdminServicesToServer}});var UL=Xg();W.experimental=UL;var zL=Zm(),GL=Fw(),jL=Uw(),WL=jw(),HL=Hw(),KL=Jg(),$L=Wi();zL.setup(),GL.setup(),jL.setup(),WL.setup(),HL.setup(),KL.setup(),$L.setup()});var Nc=class{constructor(){this.name="",this.goalLife="",this.photoUrl="",this.email="",this.phoneNumber="",this.location="",this.socialNetwork=""}};var J1="firebase",X1="10.14.1";Pr(J1,X1,"app");var xa=new Ef("ANGULARFIRE2_VERSION");var Z1=(n,e)=>{let t=e?[e]:aS(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Bi=class{constructor(){return Z1(ek)}},ek="app-check";function Rf(){}var Oc=class{zone;delegate;constructor(e,t=F0){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},xf=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Rf,{},Rf,Rf)),t.pipe(U0({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Pc=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Oc(Zone.current)),this.insideAngular=t.run(()=>new Oc(Zone.current,bc)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(ee(Nr))};static \u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function tk(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function qt(n){return nk(tk())(n)}function nk(n){return function(t){return t=t.lift(new xf(n.ngZone)),t.pipe(xs(n.outsideAngular),Oi(n.insideAngular))}}var sk=new Map,ok={activated:!1,tokenObservers:[]},ak={initialized:!1,enabled:!1};function Cn(n){return sk.get(n)||Object.assign({},ok)}function fS(){return ak}var lk="https://content-firebaseappcheck.googleapis.com/v1";var ck="exchangeDebugToken",cS={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},o9=24*60*60*1e3;var Nf=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return C(this,null,function*(){this.stop();try{this.pending=new If,this.pending.promise.catch(t=>{}),yield uk(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new If,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function uk(n){return new Promise(e=>{setTimeout(e,n)})}var dk={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Fr=new sS("appCheck","AppCheck",dk);function pS(n){if(!Cn(n).activated)throw Fr.create("use-before-activation",{appName:n.name})}function mS(r,i){return C(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let v=yield o.getHeartbeatsHeader();v&&(s["X-Firebase-Client"]=v)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(v){throw Fr.create("fetch-network-error",{originalErrorMessage:v?.message})}if(l.status!==200)throw Fr.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(v){throw Fr.create("fetch-parse-error",{originalErrorMessage:v?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Fr.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let d=Number(u[1])*1e3,f=Date.now();return{token:c.token,expireTimeMillis:f+d,issuedAtTimeMillis:f}})}function gS(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${lk}/projects/${t}/apps/${r}:${ck}?key=${i}`,body:{debug_token:e}}}var hk="firebase-app-check-database",fk=1,Of="firebase-app-check-store";var Fc=null;function pk(){return Fc||(Fc=new Promise((n,e)=>{try{let t=indexedDB.open(hk,fk);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Fr.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Of,{keyPath:"compositeKey"})}}}catch(t){e(Fr.create("storage-open",{originalErrorMessage:t?.message}))}}),Fc)}function mk(n,e){return gk(yk(n),e)}function gk(n,e){return C(this,null,function*(){let r=(yield pk()).transaction(Of,"readwrite"),s=r.objectStore(Of).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var c;a(Fr.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function yk(n){return`${n.options.appId}-${n.name}`}var Pf=new Mc("@firebase/app-check");function Mf(n,e){return xc()?mk(n,e).catch(t=>{Pf.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function yS(){return fS().enabled}function vS(){return C(this,null,function*(){let n=fS();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var vk={error:"UNKNOWN_ERROR"};function _k(n){return nS.encodeString(JSON.stringify(n),!1)}function Ff(n,e=!1){return C(this,null,function*(){let t=n.app;pS(t);let r=Cn(t),i=r.token,s;if(i&&!Ma(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(Ma(l)?i=l:yield Mf(t,void 0))}if(!e&&i&&Ma(i))return{token:i.token};let o=!1;if(yS()){r.exchangeTokenPromise||(r.exchangeTokenPromise=mS(gS(t,yield vS()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield Mf(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield Cn(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?Pf.warn(l.message):Pf.error(l),s=l}let a;return i?s?Ma(i)?a={token:i.token,internalError:s}:a=dS(s):(a={token:i.token},r.token=i,yield Mf(t,i)):a=dS(s),o&&Ek(t,a),a})}function Sk(n){return C(this,null,function*(){let e=n.app;pS(e);let{provider:t}=Cn(e);if(yS()){let r=yield vS(),{token:i}=yield mS(gS(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function bk(n,e,t,r){let{app:i}=n,s=Cn(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Ma(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),uS(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>uS(n))}function _S(n,e){let t=Cn(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function uS(n){let{app:e}=n,t=Cn(e),r=t.tokenRefresher;r||(r=Ck(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function Ck(n){let{app:e}=n;return new Nf(()=>C(this,null,function*(){let t=Cn(e),r;if(t.token?r=yield Ff(n,!0):r=yield Ff(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=Cn(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},cS.RETRIAL_MIN_WAIT,cS.RETRIAL_MAX_WAIT)}function Ek(n,e){let t=Cn(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Ma(n){return n.expireTimeMillis-Date.now()>0}function dS(n){return{token:_k(vk),error:n}}var Lf=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Cn(this.app);for(let t of e)_S(this.app,t.next);return Promise.resolve()}};function wk(n,e){return new Lf(n,e)}function Tk(n){return{getToken:e=>Ff(n,e),getLimitedUseToken:()=>Sk(n),addTokenListener:e=>bk(n,"INTERNAL",e),removeTokenListener:e=>_S(n.app,e)}}var Ak="@firebase/app-check",Ik="0.8.8";var Dk="app-check",hS="app-check-internal";function kk(){Ra(new Li(Dk,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return wk(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(hS).initialize()})),Ra(new Li(hS,n=>{let e=n.getProvider("app-check").getImmediate();return Tk(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Pr(Ak,Ik)}kk();var Rk=["localhost","0.0.0.0","127.0.0.1"],v9=typeof window<"u"&&Rk.includes(window.location.hostname);var xk="firebase",Mk="10.14.1";en.registerVersion(xk,Mk,"app-compat");var Nk=["ngOnDestroy"],CS=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(Nk.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let d=u?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,d),d})})})});var Lc=class{constructor(e){return e}},Ns=new Ke("angularfire2.app.options"),Os=new Ke("angularfire2.app.name");function Na(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=en.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>en.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;Ok("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Lc(o)}var Ok=(n,...e)=>{wf()&&typeof console<"u"&&console[n](...e)},Pk={provide:Lc,useFactory:Na,deps:[Ns,Nr,[new z0,Os]]},ES=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:Ns,useValue:t},{provide:Os,useValue:r}]}}constructor(t){en.registerVersion("angularfire",xa.full,"core"),en.registerVersion("angularfire",xa.full,"app-compat"),en.registerVersion("angular",K0.full,t.toString())}static \u0275fac=function(r){return new(r||n)(ee(Ms))};static \u0275mod=Zt({type:n});static \u0275inj=Xt({providers:[Pk]})}return n})();function Bc(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return Fk(i,o)||(bS("error",`${e} was already initialized on the ${t} Firebase App with different settings.${Lk?" You may need to reload as Firebase is not HMR aware.":""}`),bS("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function Fk(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var Lk=typeof module<"u"&&!!module.hot,bS=(n,...e)=>{wf()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Bf=new Ke("angularfire2.auth.use-emulator"),Vf=new Ke("angularfire2.auth.settings"),qf=new Ke("angularfire2.auth.tenant-id"),Uf=new Ke("angularfire2.auth.langugage-code"),zf=new Ke("angularfire2.auth.use-device-language"),Gf=new Ke("angularfire.auth.persistence"),jf=(n,e,t,r,i,s,o,a)=>Bc(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),wS=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,c,u,d,f,v){let w=new Sc,A=Mr(void 0).pipe(Oi(o.outsideAngular),Pi(()=>s.runOutsideAngular(()=>import("./chunk-QKSRMW26.mjs"))),me(()=>Na(t,s,r)),me(T=>jf(T,s,a,c,u,d,l,f)),vf({bufferSize:1,refCount:!1}));if(Rc(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Mr(null);else{A.pipe(q0()).subscribe();let T=A.pipe(Pi(P=>P.getRedirectResult().then(F=>F,()=>null)),qt,vf({bufferSize:1,refCount:!1})),O=A.pipe(Pi(P=>new Rs(F=>({unsubscribe:s.runOutsideAngular(()=>P.onAuthStateChanged(j=>F.next(j),j=>F.error(j),()=>F.complete()))})))),D=A.pipe(Pi(P=>new Rs(F=>({unsubscribe:s.runOutsideAngular(()=>P.onIdTokenChanged(j=>F.next(j),j=>F.error(j),()=>F.complete()))}))));this.authState=T.pipe(_f(O),xs(o.outsideAngular),Oi(o.insideAngular)),this.user=T.pipe(_f(D),xs(o.outsideAngular),Oi(o.insideAngular)),this.idToken=this.user.pipe(Pi(P=>P?Bn(P.getIdToken()):Mr(null))),this.idTokenResult=this.user.pipe(Pi(P=>P?Bn(P.getIdTokenResult()):Mr(null))),this.credential=B0(T,w,this.authState.pipe(Ta(P=>!P))).pipe(me(P=>P?.user?P:null),xs(o.outsideAngular),Oi(o.insideAngular))}return CS(this,A,s,{spy:{apply:(T,O,D)=>{(T.startsWith("signIn")||T.startsWith("createUser"))&&D.then(P=>w.next(P))}}})}static \u0275fac=function(r){return new(r||n)(ee(Ns),ee(Os,8),ee(Ms),ee(Nr),ee(Pc),ee(Bf,8),ee(Vf,8),ee(qf,8),ee(Uf,8),ee(zf,8),ee(Gf,8),ee(Bi,8))};static \u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();import{inspect as QL,TextEncoder as YL,TextDecoder as JL}from"util";import{randomBytes as XL}from"crypto";var TS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},AS={};var Lr,Wf;(function(){var n;function e(S,g){function y(){}y.prototype=g.prototype,S.D=g.prototype,S.prototype=new y,S.prototype.constructor=S,S.C=function(_,m,b){for(var h=Array(arguments.length-2),p=2;p<arguments.length;p++)h[p-2]=arguments[p];return g.prototype[m].apply(_,h)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(S,g,y){y||(y=0);var _=Array(16);if(typeof g=="string")for(var m=0;16>m;++m)_[m]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(m=0;16>m;++m)_[m]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=S.g[0],y=S.g[1],m=S.g[2];var b=S.g[3],h=g+(b^y&(m^b))+_[0]+3614090360&4294967295;g=y+(h<<7&4294967295|h>>>25),h=b+(m^g&(y^m))+_[1]+3905402710&4294967295,b=g+(h<<12&4294967295|h>>>20),h=m+(y^b&(g^y))+_[2]+606105819&4294967295,m=b+(h<<17&4294967295|h>>>15),h=y+(g^m&(b^g))+_[3]+3250441966&4294967295,y=m+(h<<22&4294967295|h>>>10),h=g+(b^y&(m^b))+_[4]+4118548399&4294967295,g=y+(h<<7&4294967295|h>>>25),h=b+(m^g&(y^m))+_[5]+1200080426&4294967295,b=g+(h<<12&4294967295|h>>>20),h=m+(y^b&(g^y))+_[6]+2821735955&4294967295,m=b+(h<<17&4294967295|h>>>15),h=y+(g^m&(b^g))+_[7]+4249261313&4294967295,y=m+(h<<22&4294967295|h>>>10),h=g+(b^y&(m^b))+_[8]+1770035416&4294967295,g=y+(h<<7&4294967295|h>>>25),h=b+(m^g&(y^m))+_[9]+2336552879&4294967295,b=g+(h<<12&4294967295|h>>>20),h=m+(y^b&(g^y))+_[10]+4294925233&4294967295,m=b+(h<<17&4294967295|h>>>15),h=y+(g^m&(b^g))+_[11]+2304563134&4294967295,y=m+(h<<22&4294967295|h>>>10),h=g+(b^y&(m^b))+_[12]+1804603682&4294967295,g=y+(h<<7&4294967295|h>>>25),h=b+(m^g&(y^m))+_[13]+4254626195&4294967295,b=g+(h<<12&4294967295|h>>>20),h=m+(y^b&(g^y))+_[14]+2792965006&4294967295,m=b+(h<<17&4294967295|h>>>15),h=y+(g^m&(b^g))+_[15]+1236535329&4294967295,y=m+(h<<22&4294967295|h>>>10),h=g+(m^b&(y^m))+_[1]+4129170786&4294967295,g=y+(h<<5&4294967295|h>>>27),h=b+(y^m&(g^y))+_[6]+3225465664&4294967295,b=g+(h<<9&4294967295|h>>>23),h=m+(g^y&(b^g))+_[11]+643717713&4294967295,m=b+(h<<14&4294967295|h>>>18),h=y+(b^g&(m^b))+_[0]+3921069994&4294967295,y=m+(h<<20&4294967295|h>>>12),h=g+(m^b&(y^m))+_[5]+3593408605&4294967295,g=y+(h<<5&4294967295|h>>>27),h=b+(y^m&(g^y))+_[10]+38016083&4294967295,b=g+(h<<9&4294967295|h>>>23),h=m+(g^y&(b^g))+_[15]+3634488961&4294967295,m=b+(h<<14&4294967295|h>>>18),h=y+(b^g&(m^b))+_[4]+3889429448&4294967295,y=m+(h<<20&4294967295|h>>>12),h=g+(m^b&(y^m))+_[9]+568446438&4294967295,g=y+(h<<5&4294967295|h>>>27),h=b+(y^m&(g^y))+_[14]+3275163606&4294967295,b=g+(h<<9&4294967295|h>>>23),h=m+(g^y&(b^g))+_[3]+4107603335&4294967295,m=b+(h<<14&4294967295|h>>>18),h=y+(b^g&(m^b))+_[8]+1163531501&4294967295,y=m+(h<<20&4294967295|h>>>12),h=g+(m^b&(y^m))+_[13]+2850285829&4294967295,g=y+(h<<5&4294967295|h>>>27),h=b+(y^m&(g^y))+_[2]+4243563512&4294967295,b=g+(h<<9&4294967295|h>>>23),h=m+(g^y&(b^g))+_[7]+1735328473&4294967295,m=b+(h<<14&4294967295|h>>>18),h=y+(b^g&(m^b))+_[12]+2368359562&4294967295,y=m+(h<<20&4294967295|h>>>12),h=g+(y^m^b)+_[5]+4294588738&4294967295,g=y+(h<<4&4294967295|h>>>28),h=b+(g^y^m)+_[8]+2272392833&4294967295,b=g+(h<<11&4294967295|h>>>21),h=m+(b^g^y)+_[11]+1839030562&4294967295,m=b+(h<<16&4294967295|h>>>16),h=y+(m^b^g)+_[14]+4259657740&4294967295,y=m+(h<<23&4294967295|h>>>9),h=g+(y^m^b)+_[1]+2763975236&4294967295,g=y+(h<<4&4294967295|h>>>28),h=b+(g^y^m)+_[4]+1272893353&4294967295,b=g+(h<<11&4294967295|h>>>21),h=m+(b^g^y)+_[7]+4139469664&4294967295,m=b+(h<<16&4294967295|h>>>16),h=y+(m^b^g)+_[10]+3200236656&4294967295,y=m+(h<<23&4294967295|h>>>9),h=g+(y^m^b)+_[13]+681279174&4294967295,g=y+(h<<4&4294967295|h>>>28),h=b+(g^y^m)+_[0]+3936430074&4294967295,b=g+(h<<11&4294967295|h>>>21),h=m+(b^g^y)+_[3]+3572445317&4294967295,m=b+(h<<16&4294967295|h>>>16),h=y+(m^b^g)+_[6]+76029189&4294967295,y=m+(h<<23&4294967295|h>>>9),h=g+(y^m^b)+_[9]+3654602809&4294967295,g=y+(h<<4&4294967295|h>>>28),h=b+(g^y^m)+_[12]+3873151461&4294967295,b=g+(h<<11&4294967295|h>>>21),h=m+(b^g^y)+_[15]+530742520&4294967295,m=b+(h<<16&4294967295|h>>>16),h=y+(m^b^g)+_[2]+3299628645&4294967295,y=m+(h<<23&4294967295|h>>>9),h=g+(m^(y|~b))+_[0]+4096336452&4294967295,g=y+(h<<6&4294967295|h>>>26),h=b+(y^(g|~m))+_[7]+1126891415&4294967295,b=g+(h<<10&4294967295|h>>>22),h=m+(g^(b|~y))+_[14]+2878612391&4294967295,m=b+(h<<15&4294967295|h>>>17),h=y+(b^(m|~g))+_[5]+4237533241&4294967295,y=m+(h<<21&4294967295|h>>>11),h=g+(m^(y|~b))+_[12]+1700485571&4294967295,g=y+(h<<6&4294967295|h>>>26),h=b+(y^(g|~m))+_[3]+2399980690&4294967295,b=g+(h<<10&4294967295|h>>>22),h=m+(g^(b|~y))+_[10]+4293915773&4294967295,m=b+(h<<15&4294967295|h>>>17),h=y+(b^(m|~g))+_[1]+2240044497&4294967295,y=m+(h<<21&4294967295|h>>>11),h=g+(m^(y|~b))+_[8]+1873313359&4294967295,g=y+(h<<6&4294967295|h>>>26),h=b+(y^(g|~m))+_[15]+4264355552&4294967295,b=g+(h<<10&4294967295|h>>>22),h=m+(g^(b|~y))+_[6]+2734768916&4294967295,m=b+(h<<15&4294967295|h>>>17),h=y+(b^(m|~g))+_[13]+1309151649&4294967295,y=m+(h<<21&4294967295|h>>>11),h=g+(m^(y|~b))+_[4]+4149444226&4294967295,g=y+(h<<6&4294967295|h>>>26),h=b+(y^(g|~m))+_[11]+3174756917&4294967295,b=g+(h<<10&4294967295|h>>>22),h=m+(g^(b|~y))+_[2]+718787259&4294967295,m=b+(h<<15&4294967295|h>>>17),h=y+(b^(m|~g))+_[9]+3951481745&4294967295,S.g[0]=S.g[0]+g&4294967295,S.g[1]=S.g[1]+(m+(h<<21&4294967295|h>>>11))&4294967295,S.g[2]=S.g[2]+m&4294967295,S.g[3]=S.g[3]+b&4294967295}r.prototype.u=function(S,g){g===void 0&&(g=S.length);for(var y=g-this.blockSize,_=this.B,m=this.h,b=0;b<g;){if(m==0)for(;b<=y;)i(this,S,b),b+=this.blockSize;if(typeof S=="string"){for(;b<g;)if(_[m++]=S.charCodeAt(b++),m==this.blockSize){i(this,_),m=0;break}}else for(;b<g;)if(_[m++]=S[b++],m==this.blockSize){i(this,_),m=0;break}}this.h=m,this.o+=g},r.prototype.v=function(){var S=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);S[0]=128;for(var g=1;g<S.length-8;++g)S[g]=0;var y=8*this.o;for(g=S.length-8;g<S.length;++g)S[g]=y&255,y/=256;for(this.u(S),S=Array(16),g=y=0;4>g;++g)for(var _=0;32>_;_+=8)S[y++]=this.g[g]>>>_&255;return S};function s(S,g){var y=a;return Object.prototype.hasOwnProperty.call(y,S)?y[S]:y[S]=g(S)}function o(S,g){this.h=g;for(var y=[],_=!0,m=S.length-1;0<=m;m--){var b=S[m]|0;_&&b==g||(y[m]=b,_=!1)}this.g=y}var a={};function l(S){return-128<=S&&128>S?s(S,function(g){return new o([g|0],0>g?-1:0)}):new o([S|0],0>S?-1:0)}function c(S){if(isNaN(S)||!isFinite(S))return d;if(0>S)return T(c(-S));for(var g=[],y=1,_=0;S>=y;_++)g[_]=S/y|0,y*=4294967296;return new o(g,0)}function u(S,g){if(S.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(S.charAt(0)=="-")return T(u(S.substring(1),g));if(0<=S.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=c(Math.pow(g,8)),_=d,m=0;m<S.length;m+=8){var b=Math.min(8,S.length-m),h=parseInt(S.substring(m,m+b),g);8>b?(b=c(Math.pow(g,b)),_=_.j(b).add(c(h))):(_=_.j(y),_=_.add(c(h)))}return _}var d=l(0),f=l(1),v=l(16777216);n=o.prototype,n.m=function(){if(A(this))return-T(this).m();for(var S=0,g=1,y=0;y<this.g.length;y++){var _=this.i(y);S+=(0<=_?_:4294967296+_)*g,g*=4294967296}return S},n.toString=function(S){if(S=S||10,2>S||36<S)throw Error("radix out of range: "+S);if(w(this))return"0";if(A(this))return"-"+T(this).toString(S);for(var g=c(Math.pow(S,6)),y=this,_="";;){var m=F(y,g).g;y=O(y,m.j(g));var b=((0<y.g.length?y.g[0]:y.h)>>>0).toString(S);if(y=m,w(y))return b+_;for(;6>b.length;)b="0"+b;_=b+_}},n.i=function(S){return 0>S?0:S<this.g.length?this.g[S]:this.h};function w(S){if(S.h!=0)return!1;for(var g=0;g<S.g.length;g++)if(S.g[g]!=0)return!1;return!0}function A(S){return S.h==-1}n.l=function(S){return S=O(this,S),A(S)?-1:w(S)?0:1};function T(S){for(var g=S.g.length,y=[],_=0;_<g;_++)y[_]=~S.g[_];return new o(y,~S.h).add(f)}n.abs=function(){return A(this)?T(this):this},n.add=function(S){for(var g=Math.max(this.g.length,S.g.length),y=[],_=0,m=0;m<=g;m++){var b=_+(this.i(m)&65535)+(S.i(m)&65535),h=(b>>>16)+(this.i(m)>>>16)+(S.i(m)>>>16);_=h>>>16,b&=65535,h&=65535,y[m]=h<<16|b}return new o(y,y[y.length-1]&-2147483648?-1:0)};function O(S,g){return S.add(T(g))}n.j=function(S){if(w(this)||w(S))return d;if(A(this))return A(S)?T(this).j(T(S)):T(T(this).j(S));if(A(S))return T(this.j(T(S)));if(0>this.l(v)&&0>S.l(v))return c(this.m()*S.m());for(var g=this.g.length+S.g.length,y=[],_=0;_<2*g;_++)y[_]=0;for(_=0;_<this.g.length;_++)for(var m=0;m<S.g.length;m++){var b=this.i(_)>>>16,h=this.i(_)&65535,p=S.i(m)>>>16,B=S.i(m)&65535;y[2*_+2*m]+=h*B,D(y,2*_+2*m),y[2*_+2*m+1]+=b*B,D(y,2*_+2*m+1),y[2*_+2*m+1]+=h*p,D(y,2*_+2*m+1),y[2*_+2*m+2]+=b*p,D(y,2*_+2*m+2)}for(_=0;_<g;_++)y[_]=y[2*_+1]<<16|y[2*_];for(_=g;_<2*g;_++)y[_]=0;return new o(y,0)};function D(S,g){for(;(S[g]&65535)!=S[g];)S[g+1]+=S[g]>>>16,S[g]&=65535,g++}function P(S,g){this.g=S,this.h=g}function F(S,g){if(w(g))throw Error("division by zero");if(w(S))return new P(d,d);if(A(S))return g=F(T(S),g),new P(T(g.g),T(g.h));if(A(g))return g=F(S,T(g)),new P(T(g.g),g.h);if(30<S.g.length){if(A(S)||A(g))throw Error("slowDivide_ only works with positive integers.");for(var y=f,_=g;0>=_.l(S);)y=j(y),_=j(_);var m=X(y,1),b=X(_,1);for(_=X(_,2),y=X(y,2);!w(_);){var h=b.add(_);0>=h.l(S)&&(m=m.add(y),b=h),_=X(_,1),y=X(y,1)}return g=O(S,m.j(g)),new P(m,g)}for(m=d;0<=S.l(g);){for(y=Math.max(1,Math.floor(S.m()/g.m())),_=Math.ceil(Math.log(y)/Math.LN2),_=48>=_?1:Math.pow(2,_-48),b=c(y),h=b.j(g);A(h)||0<h.l(S);)y-=_,b=c(y),h=b.j(g);w(b)&&(b=f),m=m.add(b),S=O(S,h)}return new P(m,S)}n.A=function(S){return F(this,S).h},n.and=function(S){for(var g=Math.max(this.g.length,S.g.length),y=[],_=0;_<g;_++)y[_]=this.i(_)&S.i(_);return new o(y,this.h&S.h)},n.or=function(S){for(var g=Math.max(this.g.length,S.g.length),y=[],_=0;_<g;_++)y[_]=this.i(_)|S.i(_);return new o(y,this.h|S.h)},n.xor=function(S){for(var g=Math.max(this.g.length,S.g.length),y=[],_=0;_<g;_++)y[_]=this.i(_)^S.i(_);return new o(y,this.h^S.h)};function j(S){for(var g=S.g.length+1,y=[],_=0;_<g;_++)y[_]=S.i(_)<<1|S.i(_-1)>>>31;return new o(y,S.h)}function X(S,g){var y=g>>5;g%=32;for(var _=S.g.length-y,m=[],b=0;b<_;b++)m[b]=0<g?S.i(b+y)>>>g|S.i(b+y+1)<<32-g:S.i(b+y);return new o(m,S.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Wf=AS.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,Lr=AS.Integer=o}).apply(typeof TS<"u"?TS:typeof self<"u"?self:typeof window<"u"?window:{});var is=P0(Yw(),1),lA=P0(qm(),1);var Jw="@firebase/firestore",Xw="4.7.3";var lt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};lt.UNAUTHENTICATED=new lt(null);lt.GOOGLE_CREDENTIALS=new lt("google-credentials-uid");lt.FIRST_PARTY=new lt("first-party-uid");lt.MOCK_USER=new lt("mock-user");var ZL="10.14.0";var na=ZL;function e2(n){na=n}function t2(n){return QL(n,{depth:100})}var vi=new Mc("@firebase/firestore");function ko(){return vi.logLevel}function cA(n){vi.setLogLevel(n)}function N(n,...e){if(vi.logLevel<=qn.DEBUG){let t=e.map(b_);vi.debug(`Firestore (${na}): ${n}`,...t)}}function Be(n,...e){if(vi.logLevel<=qn.ERROR){let t=e.map(b_);vi.error(`Firestore (${na}): ${n}`,...t)}}function Mn(n,...e){if(vi.logLevel<=qn.WARN){let t=e.map(b_);vi.warn(`Firestore (${na}): ${n}`,...t)}}function b_(n){if(typeof n=="string")return n;try{return t2(n)}catch{return n}}function G(n="Unexpected state"){let e=`FIRESTORE (${na}) INTERNAL ASSERTION FAILED: `+n;throw Be(e),new Error(e)}function H(n,e){n||G()}function uA(n,e){n||G()}function z(n,e){return n}var I={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},R=class extends iS{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var ot=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var zd=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},by=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(lt.UNAUTHENTICATED))}shutdown(){}},Cy=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Ey=class{constructor(e){this.authProvider=e,this.currentUser=lt.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){H(this.tokenListener===void 0);let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new ot;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new ot,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>C(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),o())};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ot)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(H(typeof r.accessToken=="string"),new zd(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return H(e===null||typeof e=="string"),new lt(e)}},wy=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=lt.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},Ty=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new wy(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(lt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ay=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Iy=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){H(this.tokenListener===void 0);let r=s=>{s.error!=null&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,N("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(H(typeof t.token=="string"),this.latestAppCheckToken=t.token,new Ay(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}};function n2(n){if(!n)return new by;switch(n.type){case"firstParty":return new Ty(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new R(I.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function r2(n){return XL(n)}var Gd=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=r2(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function ne(n,e){return n<e?-1:n>e?1:0}function ss(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function dA(n){return n+"\0"}var Zw=-62135596800,eT=1e6,Ve=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new R(I.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new R(I.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Zw)throw new R(I.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new R(I.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*eT);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/eT}_compareTo(e){return this.seconds===e.seconds?ne(this.nanoseconds,e.nanoseconds):ne(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-Zw,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var Q=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Ve(0,0))}static max(){return new n(new Ve(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var tT="__name__",jd=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&G(),r===void 0?r=e.length-t:r>e.length-t&&G(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},ue=class n extends jd{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new R(I.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},i2=/^[_a-zA-Z][_a-zA-Z0-9]*$/,et=class n extends jd{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return i2.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===tT}static keyField(){return new n([tT])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new R(I.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new R(I.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new R(I.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new R(I.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var U=class n{constructor(e){this.path=e}static fromPath(e){return new n(ue.fromString(e))}static fromName(e){return new n(ue.fromString(e).popFirst(5))}static empty(){return new n(ue.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ue.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ue.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new ue(e.slice()))}};var Bo=-1,s2=0,Dy=(()=>{class n{constructor(t,r,i,s){this.indexId=t,this.collectionGroup=r,this.fields=i,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function C_(n){return n.fields.find(e=>e.kind===2)}function os(n){return n.fields.filter(e=>e.kind!==2)}function o2(n){let e=os(n);return e.length===0?0:e[e.length-1].kind}function a2(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var Po=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Dl=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(s2,Sn.min())}};function hA(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=Q.fromTimestamp(r===1e9?new Ve(t+1,0):new Ve(t,r));return new Sn(i,U.empty(),e)}function fA(n){return new Sn(n.readTime,n.key,Bo)}var Sn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(Q.min(),U.empty(),Bo)}static max(){return new n(Q.max(),U.empty(),Bo)}};function E_(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=U.comparator(n.documentKey,e.documentKey),t!==0)?t:ne(n.largestBatchId,e.largestBatchId)}var pA="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Wd=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function ki(n){return C(this,null,function*(){if(n.code===I.FAILED_PRECONDITION&&n.message===pA)N("LocalStore","Unexpectedly lost primary lease");else throw n})}var E=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&G(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var sn="SimpleDb",l2=3,Hd=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new ot,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new rs(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=r=>{let i=w_(r.target.error);this.completionDeferred.reject(new rs(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new rs(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(N(sn,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new Ry(t)}},_i=class n{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,n.getIOSVersion(ka())===12.2&&Be("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return N(sn,"Removing database:",e),Yi(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!xc())return!1;if(n.isMockPersistence())return!0;let e=ka(),t=n.getIOSVersion(e),r=0<t&&t<10,i=mA(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}ensureDb(e){return C(this,null,function*(){return this.db||(N(sn,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new rs(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new R(I.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new R(I.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new rs(e,o))},i.onupgradeneeded=s=>{N(sn,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,i.transaction,s.oldVersion,this.version).next(()=>{N(sn,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return C(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=Hd.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.maybeCommit(),c)).catch(c=>(a.abort(c),E.reject(c))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&o<l2;if(N(sn,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function mA(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var ky=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return Yi(this.dbCursor.delete())}},rs=class extends R{constructor(e,t){super(I.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Ri(n){return n.name==="IndexedDbTransactionError"}var Ry=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(N(sn,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(N(sn,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Yi(r)}add(e){N(sn,"ADD",this.store.name,e,e);let t=this.store.add(e);return Yi(t)}get(e){let t=this.store.get(e);return Yi(t).next(r=>(r===void 0&&(r=null),N(sn,"GET",this.store.name,e,r),r))}delete(e){N(sn,"DELETE",this.store.name,e);let t=this.store.delete(e);return Yi(t)}count(){N(sn,"COUNT",this.store.name);let e=this.store.count();return Yi(e)}loadAll(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new E((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}else{let s=this.cursor(r),o=[];return this.iterateCursor(s,(a,l)=>{o.push(l)}).next(()=>o)}}loadFirst(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new E((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}deleteAll(e,t){N(sn,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let i=this.cursor(r);return this.iterateCursor(i,(s,o,a)=>a.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.iterateCursor(i,t)}iterateSerial(e){let t=this.cursor({});return new E((r,i)=>{t.onerror=s=>{let o=w_(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){r();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():r()})}})}iterateCursor(e,t){let r=[];return new E((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){i();return}let l=new ky(a),c=t(a.primaryKey,a.value,l);if(c instanceof E){let u=c.catch(d=>(l.done(),E.reject(d)));r.push(u)}l.isDone?i():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>E.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function Yi(n){return new E((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=w_(r.target.error);t(i)}})}var nT=!1;function w_(n){let e=_i.getIOSVersion(ka());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new R("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return nT||(nT=!0,setTimeout(()=>{throw r},0)),r}}return n}var Cl="IndexBackfiller",c2=15*1e3,u2=60*1e3,d2=50,xy=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(c2)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){N(Cl,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>C(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();N(Cl,`Documents written: ${t}`)}catch(t){Ri(t)?N(Cl,"Ignoring IndexedDB error during index backfill: ",t):yield ki(t)}yield this.schedule(u2)}))}},My=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return C(this,arguments,function*(e=d2){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let r=new Set,i=t,s=!0;return E.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||r.has(o))s=!1;else return N(Cl,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,i).next(a=>{i-=a,r.add(o)})})).next(()=>t-i)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(i,s)).next(a=>(N(Cl,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=fA(s);E_(o,r)>0&&(r=o)}),new Sn(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var on=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),Fo="",Ny="",gA="",yA="";function Mt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=rT(e)),e=h2(n.get(t),e);return rT(e)}function h2(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=Fo+gA;break;case Fo:t+=Fo+yA;break;default:t+=s}}return t}function rT(n){return n+Fo+Ny}function ir(n){let e=n.length;if(H(e>=2),e===2)return H(n.charAt(0)===Fo&&n.charAt(1)===Ny),ue.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(Fo,s);switch((o<0||o>t)&&G(),n.charAt(o+1)){case Ny:let l=n.substring(s,o),c;i.length===0?c=l:(i+=l,c=i,i=""),r.push(c);break;case gA:i+=n.substring(s,o),i+="\0";break;case yA:i+=n.substring(s,o+1);break;default:G()}s=o+2}return new ue(r)}var Ji="remoteDocuments";var Xl="owner",Co="owner",Zl="mutationQueues",f2="userId",xn="mutations",vA="batchId",ts="userMutationsIndex",_A=["userId","batchId"];function p2(n){return[n]}function Ld(n,e){return[n,Mt(e)]}function SA(n,e,t){return[n,Mt(e),t]}var m2={},ra="documentMutations",Ph="remoteDocumentsV14",g2=["prefixPath","collectionGroup","readTime","documentId"],Bd="documentKeyIndex",y2=["prefixPath","collectionGroup","documentId"],bA="collectionGroupIndex",v2=["collectionGroup","readTime","prefixPath","documentId"],ec="remoteDocumentGlobal",Oy="remoteDocumentGlobalKey",ia="targets",_2="targetId",CA="queryTargetsIndex",S2=["canonicalId","targetId"],sa="targetDocuments",b2=["targetId","path"],T_="documentTargetsIndex",C2=["path","targetId"],Kd="targetGlobalKey",_s="targetGlobal",kl="collectionParents",E2=["collectionId","parent"],Vo="clientMetadata",w2="clientId",Fh="bundles",T2="bundleId",Lh="namedQueries",A2="name",A_="indexConfiguration",I2="indexId",Py="collectionGroupIndex",D2="collectionGroup",Bh="indexState",k2=["indexId","uid"],EA="sequenceNumberIndex",R2=["uid","sequenceNumber"],Vh="indexEntries",x2=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],wA="documentKeyIndex",M2=["indexId","uid","orderedDocumentKey"],qh="documentOverlays",N2=["userId","collectionPath","documentId"],Fy="collectionPathOverlayIndex",O2=["userId","collectionPath","largestBatchId"],TA="collectionGroupOverlayIndex",P2=["userId","collectionGroup","largestBatchId"],I_="globals",F2="name",L2=[Zl,xn,ra,Ji,ia,Xl,_s,sa],B2=L2,V2=[...B2,Vo],q2=[...V2,ec],U2=[...q2,kl],AA=[...U2,Fh,Lh],z2=[...AA,qh],IA=[Zl,xn,ra,Ph,ia,Xl,_s,sa,Vo,ec,kl,Fh,Lh,qh],DA=IA,D_=[...DA,A_,Bh,Vh],G2=D_,j2=[...D_,I_];function W2(n){if(n===17)return j2;if(n===16)return G2;if(n===15)return D_;if(n===14)return DA;if(n===13)return IA;if(n===12)return z2;if(n===11)return AA;G()}var Rl=class extends Wd{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function dt(n,e){let t=z(n);return _i.getStore(t.simpleDbTransaction,e)}function iT(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ss(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function kA(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Ne=class n{constructor(e,t){this.comparator=e,this.root=t||El.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,El.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,El.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new No(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new No(this.root,e,this.comparator,!1)}getReverseIterator(){return new No(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new No(this.root,e,this.comparator,!0)}},No=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},El=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw G();let t=this.left.check();if(t!==this.right.check())throw G();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),Ly=class{constructor(){this.size=0}get key(){throw G()}get value(){throw G()}get color(){throw G()}get left(){throw G()}get right(){throw G()}copy(e,t,r,i,s){return this}insert(e,t,r){return new El(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};El.EMPTY=new Ly;var Ae=class n{constructor(e){this.comparator=e,this.data=new Ne(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new $d(this.data.getIterator())}getIteratorFrom(e){return new $d(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},$d=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function H2(n,e,t,r,i){let s=n.getIterator(),o=e.getIterator(),a=Eo(s),l=Eo(o);for(;a||l;){let c=!1,u=!1;if(a&&l){let d=t(a,l);d<0?u=!0:d>0&&(c=!0)}else a!=null?u=!0:c=!0;c?(r(l),l=Eo(o)):u?(i(a),a=Eo(s)):(a=Eo(s),l=Eo(o))}}function Eo(n){return n.hasNext()?n.getNext():void 0}var an=class n{constructor(e){this.fields=e,e.sort(et.comparator)}static empty(){return new n([])}unionWith(e){let t=new Ae(et.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ss(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function K2(n){return Buffer.from(n,"base64").toString("binary")}function $2(n){return Buffer.from(n,"binary").toString("base64")}function RA(){return!0}var tt=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=K2(e);return new n(t)}static fromUint8Array(e){let t=Q2(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return $2(this.binaryString)}toUint8Array(){return Y2(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return ne(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};tt.EMPTY_BYTE_STRING=new tt("");function Q2(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function Y2(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var J2=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Er(n){if(H(!!n),typeof n=="string"){let e=0,t=J2.exec(n);if(H(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=Pe(n.seconds),t=Pe(n.nanos);return{seconds:e,nanos:t}}}function Pe(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Si(n){return typeof n=="string"?tt.fromBase64String(n):tt.fromUint8Array(n)}var xA="server_timestamp",MA="__type__",NA="__previous_value__",OA="__local_write_time__";function Uh(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[MA])===null||t===void 0?void 0:t.stringValue)===xA}function X2(n,e){let t={fields:{[MA]:{stringValue:xA},[OA]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&Uh(e)&&(e=k_(e)),e&&(t.fields[NA]=e),{mapValue:t}}function k_(n){let e=n.mapValue.fields[NA];return Uh(e)?k_(e):e}function xl(n){let e=Er(n.mapValue.fields[OA].timestampValue);return new Ve(e.seconds,e.nanos)}var By=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},sT="(default)",bi=class n{constructor(e,t){this.projectId=e,this.database=t||sT}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===sT}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function Z2(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new R(I.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new bi(n.options.projectId,e)}var yi=-1;function tc(n){return n==null}function Ml(n){return n===0&&1/n===-1/0}function PA(n){return typeof n=="number"&&Number.isInteger(n)&&!Ml(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var R_="__type__",FA="__max__",mi={mapValue:{fields:{__type__:{stringValue:FA}}}},x_="__vector__",qo="value",Vd={nullValue:"NULL_VALUE"};function as(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Uh(n)?4:BA(n)?9007199254740991:zh(n)?10:11:G()}function Nn(n,e){if(n===e)return!0;let t=as(n),r=as(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return xl(n).isEqual(xl(e));case 3:return eB(n,e);case 5:return n.stringValue===e.stringValue;case 6:return nB(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return tB(n,e);case 2:return rB(n,e);case 9:return ss(n.arrayValue.values||[],e.arrayValue.values||[],Nn);case 10:case 11:return iB(n,e);case 9007199254740991:return!0;default:return G()}}function eB(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=Er(n.timestampValue),r=Er(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function tB(n,e){return Pe(n.geoPointValue.latitude)===Pe(e.geoPointValue.latitude)&&Pe(n.geoPointValue.longitude)===Pe(e.geoPointValue.longitude)}function nB(n,e){return Si(n.bytesValue).isEqual(Si(e.bytesValue))}function rB(n,e){if("integerValue"in n&&"integerValue"in e)return Pe(n.integerValue)===Pe(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=Pe(n.doubleValue),r=Pe(e.doubleValue);return t===r?Ml(t)===Ml(r):isNaN(t)&&isNaN(r)}return!1}function iB(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(iT(t)!==iT(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!Nn(t[i],r[i])))return!1;return!0}function Nl(n,e){return(n.values||[]).find(t=>Nn(t,e))!==void 0}function Ci(n,e){if(n===e)return 0;let t=as(n),r=as(e);if(t!==r)return ne(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ne(n.booleanValue,e.booleanValue);case 2:return sB(n,e);case 3:return oT(n.timestampValue,e.timestampValue);case 4:return oT(xl(n),xl(e));case 5:return ne(n.stringValue,e.stringValue);case 6:return lB(n.bytesValue,e.bytesValue);case 7:return oB(n.referenceValue,e.referenceValue);case 8:return aB(n.geoPointValue,e.geoPointValue);case 9:return LA(n.arrayValue,e.arrayValue);case 10:return cB(n.mapValue,e.mapValue);case 11:return uB(n.mapValue,e.mapValue);default:throw G()}}function sB(n,e){let t=Pe(n.integerValue||n.doubleValue),r=Pe(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function oT(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ne(n,e);let t=Er(n),r=Er(e),i=ne(t.seconds,r.seconds);return i!==0?i:ne(t.nanos,r.nanos)}function oB(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=ne(t[i],r[i]);if(s!==0)return s}return ne(t.length,r.length)}function aB(n,e){let t=ne(Pe(n.latitude),Pe(e.latitude));return t!==0?t:ne(Pe(n.longitude),Pe(e.longitude))}function lB(n,e){let t=Si(n),r=Si(e);return t.compareTo(r)}function LA(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Ci(t[i],r[i]);if(s)return s}return ne(t.length,r.length)}function cB(n,e){var t,r,i,s;let o=n.fields||{},a=e.fields||{},l=(t=o[qo])===null||t===void 0?void 0:t.arrayValue,c=(r=a[qo])===null||r===void 0?void 0:r.arrayValue,u=ne(((i=l?.values)===null||i===void 0?void 0:i.length)||0,((s=c?.values)===null||s===void 0?void 0:s.length)||0);return u!==0?u:LA(l,c)}function uB(n,e){if(n===mi.mapValue&&e===mi.mapValue)return 0;if(n===mi.mapValue)return 1;if(e===mi.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=ne(r[o],s[o]);if(a!==0)return a;let l=Ci(t[r[o]],i[s[o]]);if(l!==0)return l}return ne(r.length,s.length)}function Uo(n){return M_(n)}function M_(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?hB(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?dB(n.bytesValue):"referenceValue"in n?pB(n.referenceValue):"geoPointValue"in n?fB(n.geoPointValue):"arrayValue"in n?gB(n.arrayValue):"mapValue"in n?mB(n.mapValue):G()}function dB(n){return Si(n).toBase64()}function hB(n){let e=Er(n);return`time(${e.seconds},${e.nanos})`}function fB(n){return`geo(${n.latitude},${n.longitude})`}function pB(n){return U.fromName(n).toString()}function mB(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${M_(n.fields[i])}`;return t+"}"}function gB(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=M_(r);return e+"]"}function ls(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Vy(n){return!!n&&"integerValue"in n}function yB(n){return!!n&&"doubleValue"in n}function vB(n){return Vy(n)||yB(n)}function Ol(n){return!!n&&"arrayValue"in n}function aT(n){return!!n&&"nullValue"in n}function lT(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function qd(n){return!!n&&"mapValue"in n}function zh(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[R_])===null||t===void 0?void 0:t.stringValue)===x_}function wl(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Ss(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=wl(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=wl(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function BA(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===FA}var VA={mapValue:{fields:{[R_]:{stringValue:x_},[qo]:{arrayValue:{}}}}};function _B(n){return"nullValue"in n?Vd:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?ls(bi.empty(),U.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?zh(n)?VA:{mapValue:{}}:G()}function SB(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?ls(bi.empty(),U.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?VA:"mapValue"in n?zh(n)?{mapValue:{}}:mi:G()}function cT(n,e){let t=Ci(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function uT(n,e){let t=Ci(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Tt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!qd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=wl(t)}setAll(e){let t=et.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=wl(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());qd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Nn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!qd(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Ss(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(wl(this.value))}};function qA(n){let e=[];return Ss(n.fields,(t,r)=>{let i=new et([t]);if(qd(r)){let o=qA(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new an(e)}var at=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,Q.min(),Q.min(),Q.min(),Tt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,Q.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,Q.min(),Q.min(),Tt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,Q.min(),Q.min(),Tt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(Q.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Tt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Tt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function bB(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?Ci(r,i):G()}var lr=class{constructor(e,t){this.position=e,this.inclusive=t}};function UA(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=U.comparator(U.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=Ci(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function CB(n,e,t){let r=UA(n,e,t);return n.inclusive?r>=0:r>0}function EB(n,e,t){let r=UA(n,e,t);return n.inclusive?r<=0:r<0}function dT(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!Nn(r,i))return!1}return!0}var cs=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function wB(n){return n.field.canonicalString()+n.dir}function TB(n){return`${n.field.canonicalString()} (${n.dir})`}function AB(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Qd=class{},ae=class n extends Qd{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new zy(e,t,r):t==="array-contains"?new Wy(e,r):t==="in"?new Yd(e,r):t==="not-in"?new Hy(e,r):t==="array-contains-any"?new Ky(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Gy(e,r):new jy(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ci(t,this.value)):t!==null&&as(this.value)===as(t)&&this.matchesComparison(Ci(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return G()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},we=class n extends Qd{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return zo(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function zo(n){return n.op==="and"}function qy(n){return n.op==="or"}function N_(n){return zA(n)&&zo(n)}function zA(n){for(let e of n.filters)if(e instanceof we)return!1;return!0}function Uy(n){if(n instanceof ae)return n.field.canonicalString()+n.op.toString()+Uo(n.value);if(N_(n))return n.filters.map(e=>Uy(e)).join(",");{let e=n.filters.map(t=>Uy(t)).join(",");return`${n.op}(${e})`}}function GA(n,e){if(n instanceof ae)return IB(n,e);if(n instanceof we)return DB(n,e);G()}function IB(n,e){return e instanceof ae&&n.op===e.op&&n.field.isEqual(e.field)&&Nn(n.value,e.value)}function DB(n,e){return e instanceof we&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&GA(i,e.filters[s]),!0):!1}function jA(n,e){let t=n.filters.concat(e);return we.create(t,n.op)}function WA(n){return n instanceof ae?RB(n):n instanceof we?kB(n):"Filter"}function kB(n){return n.op.toString()+" {"+n.getFilters().map(WA).join(" ,")+"}"}function RB(n){return`${n.field.canonicalString()} ${n.op} ${Uo(n.value)}`}var zy=class extends ae{constructor(e,t,r){super(e,t,r),this.key=U.fromName(r.referenceValue)}matches(e){let t=U.comparator(e.key,this.key);return this.matchesComparison(t)}},Gy=class extends ae{constructor(e,t){super(e,"in",t),this.keys=HA("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},jy=class extends ae{constructor(e,t){super(e,"not-in",t),this.keys=HA("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function HA(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>U.fromName(r.referenceValue))}var Wy=class extends ae{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Ol(t)&&Nl(t.arrayValue,this.value)}},Yd=class extends ae{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Nl(this.value.arrayValue,t)}},Hy=class extends ae{constructor(e,t){super(e,"not-in",t)}matches(e){if(Nl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Nl(this.value.arrayValue,t)}},Ky=class extends ae{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!Ol(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>Nl(this.value.arrayValue,r))}};var $y=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function Qy(n,e=null,t=[],r=[],i=null,s=null,o=null){return new $y(n,e,t,r,i,s,o)}function us(n){let e=z(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Uy(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>wB(r)).join(","),tc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Uo(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Uo(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function xB(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>WA(t)).join(", ")}]`),tc(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>TB(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>Uo(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>Uo(t)).join(",")),`Target(${e})`}function nc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!AB(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!GA(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!dT(n.startAt,e.startAt)?!1:dT(n.endAt,e.endAt)}function Jd(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Gh(n,e){return n.filters.filter(t=>t instanceof ae&&t.field.isEqual(e))}function MB(n,e){let t=C_(e);if(t===void 0)return null;for(let r of Gh(n,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}function NB(n,e){let t=new Map;for(let r of os(e))for(let i of Gh(n,r.fieldPath))switch(i.op){case"==":case"in":t.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return t.set(r.fieldPath.canonicalString(),i.value),Array.from(t.values())}return null}function OB(n,e){let t=[],r=!0;for(let i of os(e)){let s=i.kind===0?KA(n,i.fieldPath,n.startAt):$A(n,i.fieldPath,n.startAt);t.push(s.value),r&&(r=s.inclusive)}return new lr(t,r)}function PB(n,e){let t=[],r=!0;for(let i of os(e)){let s=i.kind===0?$A(n,i.fieldPath,n.endAt):KA(n,i.fieldPath,n.endAt);t.push(s.value),r&&(r=s.inclusive)}return new lr(t,r)}function KA(n,e,t){let r=Vd,i=!0;for(let s of Gh(n,e)){let o=Vd,a=!0;switch(s.op){case"<":case"<=":o=_B(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Vd;break}cT({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];cT({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function $A(n,e,t){let r=mi,i=!0;for(let s of Gh(n,e)){let o=mi,a=!0;switch(s.op){case">=":case">":o=SB(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=mi;break}uT({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];uT({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function FB(n){let e=new Ae(et.comparator),t=!1;for(let r of n.filters)for(let i of r.getFlattenedFilters())i.field.isKeyField()||(i.op==="array-contains"||i.op==="array-contains-any"?t=!0:e=e.add(i.field));for(let r of n.orderBy)r.field.isKeyField()||(e=e.add(r.field));return e.size+(t?1:0)}function LB(n){return n.limit!==null}var On=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function QA(n,e,t,r,i,s,o,a){return new On(n,e,t,r,i,s,o,a)}function oa(n){return new On(n)}function BB(n,e){return new On(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function hT(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function VB(n){let e=new Ae(et.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function qB(n){return new On(ue.emptyPath(),n)}function UB(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function O_(n){return n.collectionGroup!==null}function Go(n){let e=z(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";VB(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new cs(s,r))}),t.has(et.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new cs(et.keyField(),r))}return e.memoizedNormalizedOrderBy}function Nt(n){let e=z(n);return e.memoizedTarget||(e.memoizedTarget=zB(e,Go(n))),e.memoizedTarget}function zB(n,e){if(n.limitType==="F")return Qy(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new cs(i.field,s)});let t=n.endAt?new lr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new lr(n.startAt.position,n.startAt.inclusive):null;return Qy(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function P_(n,e){let t=n.filters.concat([e]);return new On(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function GB(n,e){let t=n.explicitOrderBy.concat([e]);return new On(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function Xd(n,e,t){return new On(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function jB(n,e){return new On(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function WB(n,e){return new On(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function rc(n,e){return nc(Nt(n),Nt(e))&&n.limitType===e.limitType}function YA(n){return`${us(Nt(n))}|lt:${n.limitType}`}function Ro(n){return`Query(target=${xB(Nt(n))}; limitType=${n.limitType})`}function ic(n,e){return e.isFoundDocument()&&HB(n,e)&&KB(n,e)&&$B(n,e)&&QB(n,e)}function HB(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):U.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function KB(n,e){for(let t of Go(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function $B(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function QB(n,e){return!(n.startAt&&!EB(n.startAt,Go(n),e)||n.endAt&&!CB(n.endAt,Go(n),e))}function JA(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function XA(n){return(e,t)=>{let r=!1;for(let i of Go(n)){let s=YB(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function YB(n,e,t){let r=n.field.isKeyField()?U.comparator(e.key,t.key):bB(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return G()}}var cr=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ss(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return kA(this.inner)}size(){return this.innerSize}};var JB=new Ne(U.comparator);function Wt(){return JB}var ZA=new Ne(U.comparator);function Sl(...n){let e=ZA;for(let t of n)e=e.insert(t.key,t);return e}function XB(){return Pl()}function eI(n){let e=ZA;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function sr(){return Pl()}function tI(){return Pl()}function Pl(){return new cr(n=>n.toString(),(n,e)=>n.isEqual(e))}var ZB=new Ne(U.comparator);function eV(){return ZB}var tV=new Ae(U.comparator);function re(...n){let e=tV;for(let t of n)e=e.add(t);return e}var nV=new Ae(ne);function F_(){return nV}function L_(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ml(e)?"-0":e}}function nI(n){return{integerValue:""+n}}function rI(n,e){return PA(e)?nI(e):L_(n,e)}var jo=class{constructor(){this._=void 0}};function rV(n,e,t){return n instanceof Ei?X2(t,e):n instanceof wr?sI(n,e):n instanceof Tr?oI(n,e):oV(n,e)}function iV(n,e,t){return n instanceof wr?sI(n,e):n instanceof Tr?oI(n,e):t}function iI(n,e){return n instanceof wi?vB(e)?e:{integerValue:0}:null}function sV(n,e){return n instanceof wr&&e instanceof wr||n instanceof Tr&&e instanceof Tr?ss(n.elements,e.elements,Nn):n instanceof wi&&e instanceof wi?Nn(n.operand,e.operand):n instanceof Ei&&e instanceof Ei}var Ei=class extends jo{},wr=class extends jo{constructor(e){super(),this.elements=e}};function sI(n,e){let t=aI(e);for(let r of n.elements)t.some(i=>Nn(i,r))||t.push(r);return{arrayValue:{values:t}}}var Tr=class extends jo{constructor(e){super(),this.elements=e}};function oI(n,e){let t=aI(e);for(let r of n.elements)t=t.filter(i=>!Nn(i,r));return{arrayValue:{values:t}}}var wi=class extends jo{constructor(e,t){super(),this.serializer=e,this.operand=t}};function oV(n,e){let t=iI(n,e),r=fT(t)+fT(n.operand);return Vy(t)&&Vy(n.operand)?nI(r):L_(n.serializer,r)}function fT(n){return Pe(n.integerValue||n.doubleValue)}function aI(n){return Ol(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var ds=class{constructor(e,t){this.field=e,this.transform=t}};function aV(n,e){return n.field.isEqual(e.field)&&sV(n.transform,e.transform)}function lV(n,e){return n===void 0&&e===void 0?!0:n&&e?ss(n,e,(t,r)=>aV(t,r)):!1}var Yy=class{constructor(e,t){this.version=e,this.transformResults=t}},je=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function jh(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var Wo=class{};function lI(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ai(n.key,je.none()):new Ti(n.key,n.data,je.none());{let t=n.data,r=Tt.empty(),i=new Ae(et.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Pn(n.key,r,new an(i.toArray()),je.none())}}function cV(n,e,t){n instanceof Ti?dV(n,e,t):n instanceof Pn?fV(n,e,t):mV(n,e,t)}function Tl(n,e,t,r){return n instanceof Ti?hV(n,e,t,r):n instanceof Pn?pV(n,e,t,r):gV(n,e,t)}function uV(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=iI(r.transform,i||null);s!=null&&(t===null&&(t=Tt.empty()),t.set(r.field,s))}return t||null}function pT(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!lV(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var Ti=class extends Wo{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function dV(n,e,t){let r=n.value.clone(),i=uI(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function hV(n,e,t,r){if(!jh(n.precondition,e))return t;let i=n.value.clone(),s=dI(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var Pn=class extends Wo{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function fV(n,e,t){if(!jh(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=uI(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(cI(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function pV(n,e,t,r){if(!jh(n.precondition,e))return t;let i=dI(n.fieldTransforms,r,e),s=e.data;return s.setAll(cI(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function cI(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function uI(n,e,t){let r=new Map;H(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,iV(o,a,t[i]))}return r}function dI(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,rV(s,o,e))}return r}var Ai=class extends Wo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function mV(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function gV(n,e,t){return jh(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var Fl=class extends Wo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Ll=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];cV(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Tl(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Tl(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=tI();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=lI(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(Q.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),re())}isEqual(e){return this.batchId===e.batchId&&ss(this.mutations,e.mutations,(t,r)=>pT(t,r))&&ss(this.baseMutations,e.baseMutations,(t,r)=>pT(t,r))}},Jy=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){H(e.mutations.length===r.length);let i=eV(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Bl=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Xy=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var mt=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(mt||{});function hI(n){switch(n){case I.OK:return G();case I.CANCELLED:case I.UNKNOWN:case I.DEADLINE_EXCEEDED:case I.RESOURCE_EXHAUSTED:case I.INTERNAL:case I.UNAVAILABLE:case I.UNAUTHENTICATED:return!1;case I.INVALID_ARGUMENT:case I.NOT_FOUND:case I.ALREADY_EXISTS:case I.PERMISSION_DENIED:case I.FAILED_PRECONDITION:case I.ABORTED:case I.OUT_OF_RANGE:case I.UNIMPLEMENTED:case I.DATA_LOSS:return!0;default:return G()}}function yV(n){return hI(n)&&n!==I.ABORTED}function Ud(n){if(n===void 0)return Be("GRPC error has no .code"),I.UNKNOWN;switch(n){case mt.OK:return I.OK;case mt.CANCELLED:return I.CANCELLED;case mt.UNKNOWN:return I.UNKNOWN;case mt.DEADLINE_EXCEEDED:return I.DEADLINE_EXCEEDED;case mt.RESOURCE_EXHAUSTED:return I.RESOURCE_EXHAUSTED;case mt.INTERNAL:return I.INTERNAL;case mt.UNAVAILABLE:return I.UNAVAILABLE;case mt.UNAUTHENTICATED:return I.UNAUTHENTICATED;case mt.INVALID_ARGUMENT:return I.INVALID_ARGUMENT;case mt.NOT_FOUND:return I.NOT_FOUND;case mt.ALREADY_EXISTS:return I.ALREADY_EXISTS;case mt.PERMISSION_DENIED:return I.PERMISSION_DENIED;case mt.FAILED_PRECONDITION:return I.FAILED_PRECONDITION;case mt.ABORTED:return I.ABORTED;case mt.OUT_OF_RANGE:return I.OUT_OF_RANGE;case mt.UNIMPLEMENTED:return I.UNIMPLEMENTED;case mt.DATA_LOSS:return I.DATA_LOSS;default:return G()}}var Zy=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var uy=null;function fI(){return new YL}function vV(){return new JL("utf-8")}var _V=new Lr([4294967295,4294967295],0);function mT(n){let e=fI().encode(n),t=new Wf;return t.update(e),new Uint8Array(t.digest())}function gT(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new Lr([t,r],0),a=new Lr([i,s],0);return[o,a]}var ev=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ns(`Invalid padding: ${t}`);if(r<0)throw new ns(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ns(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ns(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=Lr.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(Lr.fromNumber(r)));return i.compare(_V)===1&&(i=new Lr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=mT(e),[r,i]=gT(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=mT(e),[r,i]=gT(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},ns=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Vl=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,ql.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(Q.min(),i,new Ne(ne),Wt(),re())}},ql=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,re(),re(),re())}};var Lo=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},Zd=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},eh=class{constructor(e,t,r=tt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},th=class{constructor(){this.pendingResponses=0,this.documentChanges=vT(),this._resumeToken=tt.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=re(),t=re(),r=re();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:G()}}),new ql(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=vT()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,H(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},SV="WatchChangeAggregator",tv=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=Wt(),this.pendingDocumentTargetMapping=yT(),this.pendingTargetResets=new Ne(ne)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:G()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(Jd(s))if(r===0){let o=new U(s.path);this.removeDocumentFromTarget(t,o,at.newNoDocument(o,Q.min()))}else H(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}uy?.notifyOnExistenceFilterMismatch(bV(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=Si(r).toUint8Array()}catch(l){if(l instanceof Zy)return Mn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new ev(o,i,s)}catch(l){return l instanceof ns?Mn("BloomFilter error: ",l):Mn("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&Jd(a.target)){let l=new U(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,at.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=re();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new Vl(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Wt(),this.pendingDocumentTargetMapping=yT(),this.pendingTargetResets=new Ne(ne),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new th,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new Ae(ne),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||N(SV,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new th),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function yT(){return new Ne(U.comparator)}function vT(){return new Ne(U.comparator)}function bV(n,e,t,r,i){var s,o,a,l,c,u;let d={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},f=e.unchangedNames;return f&&(d.bloomFilter={applied:i===0,hashCount:(s=f?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=f?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=f?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:v=>{var w;return(w=r?.mightContain(v))!==null&&w!==void 0?w:!1}}),d}var CV=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),EV=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),wV=(()=>{let n={};return n.and="AND",n.or="OR",n})();var nv=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function TV(n){let e=n.code===void 0?I.UNKNOWN:Ud(n.code);return new R(e,n.message||"")}function rv(n,e){return n.useProto3Json||tc(e)?e:{value:e}}function AV(n){let e;return typeof n=="object"?e=n.value:e=n,tc(e)?null:e}function Ho(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function IV(n){let e=Er(n);return new Ve(e.seconds,e.nanos)}function pI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function DV(n,e){return n.useProto3Json?(H(e===void 0||typeof e=="string"),tt.fromBase64String(e||"")):(H(e===void 0||e instanceof Buffer||e instanceof Uint8Array),tt.fromUint8Array(e||new Uint8Array))}function kV(n,e){return Ho(n,e.toTimestamp())}function Ze(n){return H(!!n),Q.fromTimestamp(IV(n))}function B_(n,e){return iv(n,e).canonicalString()}function iv(n,e){let t=RV(n).child("documents");return e===void 0?t:t.child(e)}function mI(n){let e=ue.fromString(n);return H(TI(e)),e}function Ul(n,e){return B_(n.databaseId,e.path)}function or(n,e){let t=mI(e);if(t.get(1)!==n.databaseId.projectId)throw new R(I.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new R(I.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new U(vI(t))}function gI(n,e){return B_(n.databaseId,e)}function yI(n){let e=mI(n);return e.length===4?ue.emptyPath():vI(e)}function sv(n){return new ue(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function RV(n){return new ue(["projects",n.projectId,"databases",n.database])}function vI(n){return H(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function _T(n,e,t){return{name:Ul(n,e),fields:t.value.mapValue.fields}}function xV(n,e){return{name:Ul(n,e.key),fields:e.data.value.mapValue.fields,updateTime:Ho(n,e.version.toTimestamp()),createTime:Ho(n,e.createTime.toTimestamp())}}function _I(n,e,t){let r=or(n,e.name),i=Ze(e.updateTime),s=e.createTime?Ze(e.createTime):Q.min(),o=new Tt({mapValue:{fields:e.fields}}),a=at.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function MV(n,e){H(!!e.found),e.found.name,e.found.updateTime;let t=or(n,e.found.name),r=Ze(e.found.updateTime),i=e.found.createTime?Ze(e.found.createTime):Q.min(),s=new Tt({mapValue:{fields:e.found.fields}});return at.newFoundDocument(t,r,i,s)}function NV(n,e){H(!!e.missing),H(!!e.readTime);let t=or(n,e.missing),r=Ze(e.readTime);return at.newNoDocument(t,r)}function OV(n,e){return"found"in e?MV(n,e):"missing"in e?NV(n,e):G()}function PV(n,e){let t;if("targetChange"in e){e.targetChange;let r=FV(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=DV(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&TV(o);t=new eh(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=or(n,r.document.name),s=Ze(r.document.updateTime),o=r.document.createTime?Ze(r.document.createTime):Q.min(),a=new Tt({mapValue:{fields:r.document.fields}}),l=at.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new Lo(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=or(n,r.document),s=r.readTime?Ze(r.readTime):Q.min(),o=at.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Lo([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=or(n,r.document),s=r.removedTargetIds||[];t=new Lo([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Xy(i,s),a=r.targetId;t=new Zd(a,o)}else return G();return t}function FV(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:G()}function LV(n){if(!("targetChange"in n))return Q.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Q.min():Ze(e.readTime)}function zl(n,e){let t;if(e instanceof Ti)t={update:_T(n,e.key,e.value)};else if(e instanceof Ai)t={delete:Ul(n,e.key)};else if(e instanceof Pn)t={update:_T(n,e.key,e.data),updateMask:gq(e.fieldMask)};else if(e instanceof Fl)t={verify:Ul(n,e.key)};else return G();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>zV(n,r))),e.precondition.isNone||(t.currentDocument=BV(n,e.precondition)),t}function ov(n,e){let t=e.currentDocument?VV(e.currentDocument):je.none(),r=e.updateTransforms?e.updateTransforms.map(i=>GV(n,i)):[];if(e.update){e.update.name;let i=or(n,e.update.name),s=new Tt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=yq(e.updateMask);return new Pn(i,s,o,t,r)}else return new Ti(i,s,t,r)}else if(e.delete){let i=or(n,e.delete);return new Ai(i,t)}else if(e.verify){let i=or(n,e.verify);return new Fl(i,t)}else return G()}function BV(n,e){return e.updateTime!==void 0?{updateTime:kV(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:G()}function VV(n){return n.updateTime!==void 0?je.updateTime(Ze(n.updateTime)):n.exists!==void 0?je.exists(n.exists):je.none()}function qV(n,e){let t=n.updateTime?Ze(n.updateTime):Ze(e);return t.isEqual(Q.min())&&(t=Ze(e)),new Yy(t,n.transformResults||[])}function UV(n,e){return n&&n.length>0?(H(e!==void 0),n.map(t=>qV(t,e))):[]}function zV(n,e){let t=e.transform;if(t instanceof Ei)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof wr)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Tr)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof wi)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw G()}function GV(n,e){let t=null;if("setToServerValue"in e)H(e.setToServerValue==="REQUEST_TIME"),t=new Ei;else if("appendMissingElements"in e){let i=e.appendMissingElements.values||[];t=new wr(i)}else if("removeAllFromArray"in e){let i=e.removeAllFromArray.values||[];t=new Tr(i)}else"increment"in e?t=new wi(n,e.increment):G();let r=et.fromServerFormat(e.fieldPath);return new ds(r,t)}function SI(n,e){return{documents:[gI(n,e.path)]}}function jV(n){let e=n.documents.length;H(e===1);let t=n.documents[0];return Nt(oa(yI(t)))}function bI(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=gI(n,i);let s=QV(e.filters);s&&(t.structuredQuery.where=s);let o=JV(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=rv(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=ZV(e.startAt)),e.endAt&&(t.structuredQuery.endAt=eq(e.endAt)),{queryTarget:t,parent:i}}function CI(n){let e=yI(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){H(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=YV(t.where));let o=[];t.orderBy&&(o=XV(t.orderBy));let a=null;t.limit&&(a=AV(t.limit));let l=null;t.startAt&&(l=tq(t.startAt));let c=null;return t.endAt&&(c=nq(t.endAt)),QA(e,i,o,s,a,"F",l,c)}function WV(n){return Nt(CI(n))}function HV(n,e){let t=KV(e.purpose);return t==null?null:{"goog-listen-tags":t}}function KV(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return G()}}function $V(n,e){let t,r=e.target;if(Jd(r)?t={documents:SI(n,r)}:t={query:bI(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=pI(n,e.resumeToken);let i=rv(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(Q.min())>0){t.readTime=Ho(n,e.snapshotVersion.toTimestamp());let i=rv(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function QV(n){if(n.length!==0)return wI(we.create(n,"and"))}function YV(n){let e=EI(n);return e instanceof we&&N_(e)?e.getFilters():[e]}function EI(n){return n.unaryFilter!==void 0?fq(n):n.fieldFilter!==void 0?pq(n):n.compositeFilter!==void 0?mq(n):G()}function JV(n){if(n.length!==0)return n.map(e=>cq(e))}function XV(n){return n.map(e=>uq(e))}function ZV(n){return{before:n.inclusive,values:n.position}}function eq(n){return{before:!n.inclusive,values:n.position}}function tq(n){let e=!!n.before,t=n.values||[];return new lr(t,e)}function nq(n){let e=!n.before,t=n.values||[];return new lr(t,e)}function rq(n){return CV[n]}function iq(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function sq(n){return EV[n]}function oq(n){return wV[n]}function aq(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return G();default:return G()}}function lq(n){switch(n){case"AND":return"and";case"OR":return"or";default:return G()}}function xo(n){return{fieldPath:n.canonicalString()}}function Oo(n){return et.fromServerFormat(n.fieldPath)}function cq(n){return{field:xo(n.field),direction:rq(n.dir)}}function uq(n){return new cs(Oo(n.field),iq(n.direction))}function wI(n){return n instanceof ae?hq(n):n instanceof we?dq(n):G()}function dq(n){let e=n.getFilters().map(t=>wI(t));return e.length===1?e[0]:{compositeFilter:{op:oq(n.op),filters:e}}}function hq(n){if(n.op==="=="){if(lT(n.value))return{unaryFilter:{field:xo(n.field),op:"IS_NAN"}};if(aT(n.value))return{unaryFilter:{field:xo(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(lT(n.value))return{unaryFilter:{field:xo(n.field),op:"IS_NOT_NAN"}};if(aT(n.value))return{unaryFilter:{field:xo(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xo(n.field),op:sq(n.op),value:n.value}}}function fq(n){switch(n.unaryFilter.op){case"IS_NAN":let e=Oo(n.unaryFilter.field);return ae.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=Oo(n.unaryFilter.field);return ae.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=Oo(n.unaryFilter.field);return ae.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=Oo(n.unaryFilter.field);return ae.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return G();default:return G()}}function pq(n){return ae.create(Oo(n.fieldFilter.field),aq(n.fieldFilter.op),n.fieldFilter.value)}function mq(n){return we.create(n.compositeFilter.filters.map(e=>EI(e)),lq(n.compositeFilter.op))}function gq(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function yq(n){let e=n.fieldPaths||[];return new an(e.map(t=>et.fromServerFormat(t)))}function TI(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Ko=class n{constructor(e,t,r,i,s=Q.min(),o=Q.min(),a=tt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var nh=class{constructor(e){this.remoteSerializer=e}};function vq(n,e){let t;if(e.document)t=_I(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=U.fromSegments(e.noDocument.path),i=fs(e.noDocument.readTime);t=at.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let r=U.fromSegments(e.unknownDocument.path),i=fs(e.unknownDocument.version);t=at.newUnknownDocument(r,i)}else return G();return e.readTime&&t.setReadTime(_q(e.readTime)),t}function ST(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Wh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=xV(n.remoteSerializer,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:hs(e.version)};else if(e.isUnknownDocument())r.unknownDocument={path:t.path.toArray(),version:hs(e.version)};else return G();return r}function Wh(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function _q(n){let e=new Ve(n[0],n[1]);return Q.fromTimestamp(e)}function hs(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function fs(n){let e=new Ve(n.seconds,n.nanoseconds);return Q.fromTimestamp(e)}function Sq(n,e,t){let r=t.baseMutations.map(s=>zl(n.remoteSerializer,s)),i=t.mutations.map(s=>zl(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function Xi(n,e){let t=(e.baseMutations||[]).map(s=>ov(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>ov(n.remoteSerializer,s)),i=Ve.fromMillis(e.localWriteTimeMs);return new Ll(e.batchId,i,t,r)}function bl(n){let e=fs(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?fs(n.lastLimboFreeSnapshotVersion):Q.min(),r;return bq(n.query)?r=jV(n.query):r=WV(n.query),new Ko(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,tt.fromBase64String(n.resumeToken))}function AI(n,e){let t=hs(e.snapshotVersion),r=hs(e.lastLimboFreeSnapshotVersion),i;Jd(e.target)?i=SI(n.remoteSerializer,e.target):i=bI(n.remoteSerializer,e.target).queryTarget;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:us(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function bq(n){return n.documents!==void 0}function Cq(n){return{id:n.bundleId,createTime:fs(n.createTime),version:n.version}}function Eq(n){return{bundleId:n.id,createTime:hs(Ze(n.createTime)),version:n.version}}function wq(n){return{name:n.name,query:V_(n.bundledQuery),readTime:fs(n.readTime)}}function Tq(n){return{name:n.name,readTime:hs(Ze(n.readTime)),bundledQuery:n.bundledQuery}}function V_(n){let e=CI({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Xd(e,e.limit,"L"):e}function Aq(n){return{name:n.name,query:V_(n.bundledQuery),readTime:Ze(n.readTime)}}function Iq(n){return{id:n.id,version:n.version,createTime:Ze(n.createTime)}}function dy(n,e){return new Bl(e.largestBatchId,ov(n.remoteSerializer,e.overlayMutation))}function Dq(n,e,t){let[r,i,s]=II(e,t.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:zl(n.remoteSerializer,t.mutation)}}function II(n,e){let t=e.path.lastSegment(),r=Mt(e.path.popLast());return[n,r,t]}function kq(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function Rq(n,e){let t=e?new Dl(e.sequenceNumber,new Sn(fs(e.readTime),new U(ir(e.documentKey)),e.largestBatchId)):Dl.empty(),r=n.fields.map(([i,s])=>new Po(et.fromServerFormat(i),s));return new Dy(n.indexId,n.collectionGroup,r,t)}function bT(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:hs(r.readTime),documentKey:Mt(r.documentKey.path),largestBatchId:r.largestBatchId}}var av=class{getBundleMetadata(e,t){return CT(e).get(t).next(r=>{if(r)return Cq(r)})}saveBundleMetadata(e,t){return CT(e).put(Eq(t))}getNamedQuery(e,t){return ET(e).get(t).next(r=>{if(r)return wq(r)})}saveNamedQuery(e,t){return ET(e).put(Tq(t))}};function CT(n){return dt(n,Fh)}function ET(n){return dt(n,Lh)}var rh=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return gl(e).get(II(this.userId,t)).next(r=>r?dy(this.serializer,r):null)}getOverlays(e,t){let r=sr();return E.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Bl(t,o);i.push(this.saveOverlay(e,a))}),E.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Mt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(gl(e).deleteAll(Fy,a))}),E.waitFor(s)}getOverlaysForCollection(e,t,r){let i=sr(),s=Mt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return gl(e).loadAll(Fy,o).next(a=>{for(let l of a){let c=dy(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=sr(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return gl(e).iterate({index:TA,range:a},(l,c,u)=>{let d=dy(this.serializer,c);s.size()<i||d.largestBatchId===o?(s.set(d.getKey(),d),o=d.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return gl(e).put(Dq(this.serializer,this.userId,t))}};function gl(n){return dt(n,qh)}var lv=class{globalsStore(e){return dt(e,I_)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(r=>{let i=r?.value;return i?tt.fromUint8Array(i):tt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}};var xq=5,Mq=10,Nq=13,hy=15,Oq=20,Pq=25,Fq=30,Lq=37,Bq=45,Vq=50,qq=53,Uq=55,zq=60,Gq=2,Cr=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,xq);else if("booleanValue"in e)this.writeValueTypeLabel(t,Mq),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,hy),t.writeNumber(Pe(e.integerValue));else if("doubleValue"in e){let r=Pe(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,Nq):(this.writeValueTypeLabel(t,hy),Ml(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,Oq),typeof r=="string"&&(r=Er(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,Fq),t.writeBytes(Si(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,Bq),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?BA(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):zh(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):G()}writeIndexString(e,t){this.writeValueTypeLabel(t,Pq),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,Uq);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexVector(e,t){var r,i;let s=e.fields||{};this.writeValueTypeLabel(t,qq);let o=qo,a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.writeValueTypeLabel(t,hy),t.writeNumber(Pe(a)),this.writeIndexString(o,t),this.writeIndexValueAux(s[o],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,Vq);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,Lq),U.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,zq),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(Gq)}};Cr.INSTANCE=new Cr;var wT="\uD800",TT="\uDBFF",wo=0,AT=255,IT=1,To=255,DT=255,kT=0,jq=64,Wq=8,Hq=1024;function Kq(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function $q(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function Qq(n){let e=0;for(let t=0;t<8;++t){let r=$q(n[t]&255);if(e+=r,r!==8)break}return e}function RT(n){let e=jq-Qq(n);return Math.ceil(e/Wq)}var cv=class{constructor(){this.buffer=new Uint8Array(Hq),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteAscending(r);else if(r<2048)this.writeByteAscending(960|r>>>6),this.writeByteAscending(128|63&r);else if(t<wT||TT<t)this.writeByteAscending(480|r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r);else{let i=t.codePointAt(0);this.writeByteAscending(240|i>>>18),this.writeByteAscending(128|63&i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteDescending(r);else if(r<2048)this.writeByteDescending(960|r>>>6),this.writeByteDescending(128|63&r);else if(t<wT||TT<t)this.writeByteDescending(480|r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r);else{let i=t.codePointAt(0);this.writeByteDescending(240|i>>>18),this.writeByteDescending(128|63&i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=RT(t);this.ensureAvailable(1+r),this.buffer[this.position++]=r&255;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=t[i]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),r=RT(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(r&255);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(t[i]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(To),this.writeEscapedByteAscending(DT)}writeInfinityDescending(){this.writeEscapedByteDescending(To),this.writeEscapedByteDescending(DT)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=Kq(e),r=(t[0]&128)!==0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}writeByteAscending(e){let t=e&255;t===wo?(this.writeEscapedByteAscending(wo),this.writeEscapedByteAscending(AT)):t===To?(this.writeEscapedByteAscending(To),this.writeEscapedByteAscending(kT)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===wo?(this.writeEscapedByteDescending(wo),this.writeEscapedByteDescending(AT)):t===To?(this.writeEscapedByteDescending(To),this.writeEscapedByteDescending(kT)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(wo),this.writeEscapedByteAscending(IT)}writeSeparatorDescending(){this.writeEscapedByteDescending(wo),this.writeEscapedByteDescending(IT)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=this.buffer.length*2;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},uv=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},dv=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},Zi=class{constructor(){this.orderedCode=new cv,this.ascending=new uv(this.orderedCode),this.descending=new dv(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var es=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function di(n,e){let t=n.indexId-e.indexId;return t!==0||(t=xT(n.arrayValue,e.arrayValue),t!==0)||(t=xT(n.directionalValue,e.directionalValue),t!==0)?t:U.comparator(n.documentKey,e.documentKey)}function xT(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var ih=class{constructor(e){this.inequalityFilters=new Ae((t,r)=>et.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let r=t;r.isInequality()?this.inequalityFilters=this.inequalityFilters.add(r):this.equalityFilters.push(r)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(H(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=C_(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let r=os(e),i=new Set,s=0,o=0;for(;s<r.length&&this.hasMatchingEqualityFilter(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new Ae(et.comparator),t=[];for(let r of this.equalityFilters){if(r.field.isKeyField())continue;if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Po(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Po(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Po(r.field,r.dir==="asc"?0:1)));return new Dy(Dy.UNKNOWN_ID,this.collectionId,t,Dl.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function DI(n){var e,t;if(H(n instanceof ae||n instanceof we),n instanceof ae)if(n instanceof Yd){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>ae.create(n.field,"==",s)))||[];return we.create(i,"or")}else return n;let r=n.filters.map(i=>DI(i));return we.create(r,n.op)}function Yq(n){if(n.getFilters().length===0)return[];let e=hv(DI(n));return H(kI(e)),q_(e)||U_(e)?[e]:e.getFilters()}function q_(n){return n instanceof ae}function U_(n){return n instanceof we&&N_(n)}function kI(n){return q_(n)||U_(n)||Jq(n)}function Jq(n){if(n instanceof we&&qy(n)){for(let e of n.getFilters())if(!q_(e)&&!U_(e))return!1;return!0}return!1}function hv(n){if(H(n instanceof ae||n instanceof we),n instanceof ae)return n;if(n.filters.length===1)return hv(n.filters[0]);let e=n.filters.map(r=>hv(r)),t=we.create(e,n.op);return t=sh(t),kI(t)?t:(H(t instanceof we),H(zo(t)),H(t.filters.length>1),t.filters.reduce((r,i)=>z_(r,i)))}function z_(n,e){H(n instanceof ae||n instanceof we),H(e instanceof ae||e instanceof we);let t;return n instanceof ae?e instanceof ae?t=Xq(n,e):t=MT(n,e):e instanceof ae?t=MT(e,n):t=Zq(n,e),sh(t)}function Xq(n,e){return we.create([n,e],"and")}function Zq(n,e){if(H(n.filters.length>0&&e.filters.length>0),zo(n)&&zo(e))return jA(n,e.getFilters());let t=qy(n)?n:e,r=qy(n)?e:n,i=t.filters.map(s=>z_(s,r));return we.create(i,"or")}function MT(n,e){if(zo(e))return jA(e,n.getFilters());{let t=e.filters.map(r=>z_(n,r));return we.create(t,"or")}}function sh(n){if(H(n instanceof ae||n instanceof we),n instanceof ae)return n;let e=n.getFilters();if(e.length===1)return sh(e[0]);if(zA(n))return n;let t=e.map(i=>sh(i)),r=[];return t.forEach(i=>{i instanceof ae?r.push(i):i instanceof we&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:we.create(r,n.op)}var fv=class{constructor(){this.collectionParentIndex=new Gl}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),E.resolve()}getCollectionParents(e,t){return E.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return E.resolve()}deleteFieldIndex(e,t){return E.resolve()}deleteAllFieldIndexes(e){return E.resolve()}createTargetIndexes(e,t){return E.resolve()}getDocumentsMatchingTarget(e,t){return E.resolve(null)}getIndexType(e,t){return E.resolve(0)}getFieldIndexes(e,t){return E.resolve([])}getNextCollectionGroupToUpdate(e){return E.resolve(null)}getMinOffset(e,t){return E.resolve(Sn.min())}getMinOffsetFromCollectionGroup(e,t){return E.resolve(Sn.min())}updateCollectionGroup(e,t,r){return E.resolve()}updateIndexEntries(e,t){return E.resolve()}},Gl=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Ae(ue.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ae(ue.comparator)).toArray()}};var NT="IndexedDbIndexManager",Nd=new Uint8Array(0),pv=class{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new Gl,this.targetToDnfSubTargets=new cr(r=>us(r),(r,i)=>nc(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:r,parent:Mt(i)};return OT(e).put(s)}return E.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[dA(t),""],!1,!0);return OT(e).loadAll(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(ir(o.parent))}return r})}addFieldIndex(e,t){let r=yl(e),i=kq(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Io(e);return s.next(a=>{o.put(bT(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let r=yl(e),i=Io(e),s=Ao(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=yl(e),r=Ao(e),i=Io(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>i.deleteAll())}createTargetIndexes(e,t){return E.forEach(this.getSubTargets(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let o=new ih(r).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let r=Ao(e),i=!0,s=new Map;return E.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=re(),a=[];return E.forEach(s,(l,c)=>{N(NT,`Using index ${a2(l)} to execute ${us(t)}`);let u=MB(c,l),d=NB(c,l),f=OB(c,l),v=PB(c,l),w=this.encodeBound(l,c,f),A=this.encodeBound(l,c,v),T=this.encodeValues(l,c,d),O=this.generateIndexRanges(l.indexId,u,w,f.inclusive,A,v.inclusive,T);return E.forEach(O,D=>r.loadFirst(D,t.limit).next(P=>{P.forEach(F=>{let j=U.fromSegments(F.documentKey);o.has(j)||(o=o.add(j),a.push(j))})}))}).next(()=>a)}else return E.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=Yq(we.create(e.filters,"and")).map(i=>Qy(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,r,i,s,o,a){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let d=0;d<l;++d){let f=t?this.encodeSingleElement(t[d/c]):Nd,v=this.generateLowerBound(e,f,r[d%c],i),w=this.generateUpperBound(e,f,s[d%c],o),A=a.map(T=>this.generateLowerBound(e,f,T,!0));u.push(...this.createRange(v,w,A))}return u}generateLowerBound(e,t,r,i){let s=new es(e,U.empty(),t,r);return i?s:s.successor()}generateUpperBound(e,t,r,i){let s=new es(e,U.empty(),t,r);return i?s.successor():s}getFieldIndex(e,t){let r=new ih(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.getSubTargets(t);return E.forEach(i,s=>this.getFieldIndex(e,s).next(o=>{o?r!==0&&o.fields.length<FB(s)&&(r=1):r=0})).next(()=>LB(t)&&i.length>1&&r===2?1:r)}encodeDirectionalElements(e,t){let r=new Zi;for(let i of os(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.forKind(i.kind);Cr.INSTANCE.writeIndexValue(s,o)}return r.encodedBytes()}encodeSingleElement(e){let t=new Zi;return Cr.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new Zi;return Cr.INSTANCE.writeIndexValue(ls(this.databaseId,t),r.forKind(o2(e))),r.encodedBytes()}encodeValues(e,t,r){if(r===null)return[];let i=[];i.push(new Zi);let s=0;for(let o of os(e)){let a=r[s++];for(let l of i)if(this.isInFilter(t,o.fieldPath)&&Ol(a))i=this.expandIndexValues(i,o,a);else{let c=l.forKind(o.kind);Cr.INSTANCE.writeIndexValue(a,c)}}return this.getEncodedBytes(i)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let l=new Zi;l.seed(a.encodedBytes()),Cr.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(r=>r instanceof ae&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=yl(e),i=Io(e);return(t?r.loadAll(Py,IDBKeyRange.bound(t,t)):r.loadAll()).next(s=>{let o=[];return E.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(Rq(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:ne(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=yl(e),s=Io(e);return this.getNextSequenceNumber(e).next(o=>i.loadAll(Py,IDBKeyRange.bound(t,t)).next(a=>E.forEach(a,l=>s.put(bT(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return E.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?E.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),E.forEach(l,c=>this.getExistingIndexEntries(e,i,c).next(u=>{let d=this.computeIndexEntries(s,c);return u.isEqual(d)?E.resolve():this.updateEntries(e,s,c,u,d)}))))})}addIndexEntry(e,t,r,i){return Ao(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,i){return Ao(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let i=Ao(e),s=new Ae(di);return i.iterate({index:wA,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(o,a)=>{s=s.add(new es(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let r=new Ae(di),i=this.encodeDirectionalElements(t,e);if(i==null)return r;let s=C_(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Ol(o))for(let a of o.arrayValue.values||[])r=r.add(new es(t.indexId,e.key,this.encodeSingleElement(a),i))}else r=r.add(new es(t.indexId,e.key,Nd,i));return r}updateEntries(e,t,r,i,s){N(NT,"Updating index entries for document '%s'",t.key);let o=[];return H2(i,s,di,a=>{o.push(this.addIndexEntry(e,t,r,a))},a=>{o.push(this.deleteIndexEntry(e,t,r,a))}),E.waitFor(o)}getNextSequenceNumber(e){let t=1;return Io(e).iterate({index:EA,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>di(o,a)).filter((o,a,l)=>!a||di(o,l[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=di(o,e),l=di(o,t);if(a===0)i[0]=e.successor();else if(a>0&&l<0)i.push(o),i.push(o.successor());else if(l>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.isRangeMatchable(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Nd,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Nd,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return di(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(PT)}getMinOffset(e,t){return E.mapArray(this.getSubTargets(t),r=>this.getFieldIndex(e,r).next(i=>i||G())).next(PT)}};function OT(n){return dt(n,kl)}function Ao(n){return dt(n,Vh)}function yl(n){return dt(n,A_)}function Io(n){return dt(n,Bh)}function PT(n){H(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;E_(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Sn(e.readTime,e.documentKey,t)}function RI(n,e,t){let r=n.store(xn),i=n.store(ra),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=r.iterate({range:o},(u,d,f)=>(a++,f.delete()));s.push(l.next(()=>{H(a===1)}));let c=[];for(let u of t.mutations){let d=SA(e,u.key.path,t.batchId);s.push(i.delete(d)),c.push(u.key)}return E.waitFor(s).next(()=>c)}function oh(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw G();return JSON.stringify(e).length}var ah=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.documentKeysByBatchId={}}static forUser(e,t,r,i){H(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return hi(e).iterate({index:ts,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Mo(e),o=hi(e);return o.add({}).next(a=>{H(typeof a=="number");let l=new Ll(a,t,r,i),c=Sq(this.serializer,this.userId,l),u=[],d=new Ae((f,v)=>ne(f.canonicalString(),v.canonicalString()));for(let f of i){let v=SA(this.userId,f.key.path,a);d=d.add(f.key.path.popLast()),u.push(o.put(c)),u.push(s.put(v,m2))}return d.forEach(f=>{u.push(this.indexManager.addToCollectionParentIndex(e,f))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),E.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return hi(e).get(t).next(r=>r?(H(r.userId===this.userId),Xi(this.serializer,r)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?E.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.documentKeysByBatchId[t]=i,i}else return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return hi(e).iterate({index:ts,range:i},(o,a,l)=>{a.userId===this.userId&&(H(a.batchId>=r),s=Xi(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=yi;return hi(e).iterate({index:ts,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,yi],[this.userId,Number.POSITIVE_INFINITY]);return hi(e).loadAll(ts,t).next(r=>r.map(i=>Xi(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Ld(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Mo(e).iterate({range:i},(o,a,l)=>{let[c,u,d]=o,f=ir(u);if(c!==this.userId||!t.path.isEqual(f)){l.done();return}return hi(e).get(d).next(v=>{if(!v)throw G();H(v.userId===this.userId),s.push(Xi(this.serializer,v))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ae(ne),i=[];return t.forEach(s=>{let o=Ld(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=Mo(e).iterate({range:a},(c,u,d)=>{let[f,v,w]=c,A=ir(v);if(f!==this.userId||!s.path.isEqual(A)){d.done();return}r=r.add(w)});i.push(l)}),E.waitFor(i).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Ld(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new Ae(ne);return Mo(e).iterate({range:o},(l,c,u)=>{let[d,f,v]=l,w=ir(f);if(d!==this.userId||!r.isPrefixOf(w)){u.done();return}w.length===i&&(a=a.add(v))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],i=[];return t.forEach(s=>{i.push(hi(e).get(s).next(o=>{if(o===null)throw G();H(o.userId===this.userId),r.push(Xi(this.serializer,o))}))}),E.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return RI(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),E.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return E.resolve();let r=IDBKeyRange.lowerBound(p2(this.userId)),i=[];return Mo(e).iterate({range:r},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let c=ir(s[1]);i.push(c)}}).next(()=>{H(i.length===0)})})}containsKey(e,t){return xI(e,this.userId,t)}getMutationQueueMetadata(e){return MI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:yi,lastStreamToken:""})}};function xI(n,e,t){let r=Ld(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Mo(n).iterate({range:s,keysOnly:!0},(a,l,c)=>{let[u,d,f]=a;u===e&&d===i&&(o=!0),c.done()}).next(()=>o)}function eU(n,e){let t=!1;return MI(n).iterateSerial(r=>xI(n,r,e).next(i=>(i&&(t=!0),E.resolve(!i)))).next(()=>t)}function hi(n){return dt(n,xn)}function Mo(n){return dt(n,ra)}function MI(n){return dt(n,Zl)}var fy=2,$o=class n{constructor(e){this.lastId=e}next(){return this.lastId+=fy,this.lastId}static forTargetCache(){return new n(2-fy)}static forSyncEngine(){return new n(1-fy)}};var mv=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new $o(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>Q.fromTimestamp(new Ve(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.saveMetadata(e,i)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Do(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(r=>(H(r.targetCount>0),r.targetCount-=1,this.saveMetadata(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Do(e).iterate((o,a)=>{let l=bl(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>E.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Do(e).iterate((r,i)=>{let s=bl(i);t(s)})}retrieveMetadata(e){return FT(e).get(Kd).next(t=>(H(t!==null),t))}saveMetadata(e,t){return FT(e).put(Kd,t)}saveTargetData(e,t){return Do(e).put(AI(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let r=us(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Do(e).iterate({range:i,index:CA},(o,a,l)=>{let c=bl(a);nc(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=pi(e);return t.forEach(o=>{let a=Mt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),E.waitFor(i)}removeMatchingKeys(e,t,r){let i=pi(e);return E.forEach(t,s=>{let o=Mt(s.path);return E.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=pi(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=pi(e),s=re();return i.iterate({range:r,keysOnly:!0},(o,a,l)=>{let c=ir(o[1]),u=new U(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let r=Mt(t.path),i=IDBKeyRange.bound([r],[dA(r)],!1,!0),s=0;return pi(e).iterate({index:T_,keysOnly:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return Do(e).get(t).next(r=>r?bl(r):null)}};function Do(n){return dt(n,ia)}function FT(n){return dt(n,_s)}function pi(n){return dt(n,sa)}var LT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},sc=-1,NI=40*1024*1024,_n=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};_n.DEFAULT_COLLECTION_PERCENTILE=10;_n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;_n.DEFAULT=new _n(NI,_n.DEFAULT_COLLECTION_PERCENTILE,_n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);_n.DISABLED=new _n(sc,0,0);var BT="LruGarbageCollector",VT=1*1024*1024,tU=1*60*1e3,nU=5*60*1e3;function qT([n,e],[t,r]){let i=ne(n,t);return i===0?ne(e,r):i}var gv=class{constructor(e){this.maxElements=e,this.buffer=new Ae(qT),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();qT(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},yv=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==sc&&this.scheduleGC(tU)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){N(BT,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>C(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ri(t)?N(BT,"Ignoring IndexedDB error during garbage collection: ",t):yield ki(t)}yield this.scheduleGC(nU)}))}},vv=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return E.resolve(on.INVALID);let r=new gv(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===sc?(N("LruGarbageCollector","Garbage collection skipped; disabled"),E.resolve(LT)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),LT):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,o=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(s=d,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>{if(c=Date.now(),ko()<=qn.DEBUG){let f=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${d} documents in ${c-l}ms
Total Duration: ${c-u}ms`;N("LruGarbageCollector",f)}return E.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})})}};function rU(n,e){return new vv(n,e)}var _v=class{constructor(e,t){this.db=e,this.garbageCollector=rU(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(r,i)=>t(i))}addReference(e,t,r){return Od(e,r)}removeReference(e,t,r){return Od(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Od(e,t)}isPinned(e,t){return eU(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(d=>{if(!d)return o++,i.getEntry(e,l).next(()=>(i.removeEntry(l,Q.min()),pi(e).delete(iU(l))))});s.push(u)}}).next(()=>E.waitFor(s)).next(()=>i.apply(e)).next(()=>o)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Od(e,t)}forEachOrphanedDocument(e,t){let r=pi(e),i=on.INVALID,s;return r.iterate({index:T_},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==on.INVALID&&t(new U(ir(s)),i),i=c,s=l):i=on.INVALID}).next(()=>{i!==on.INVALID&&t(new U(ir(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function iU(n){return[0,Mt(n.path)]}function sU(n,e){return{targetId:0,path:Mt(n.path),sequenceNumber:e}}function Od(n,e){return pi(n).put(sU(e,n.currentSequenceNumber))}var lh=class{constructor(){this.changes=new cr(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,at.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?E.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Sv=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Qi(e).put(r)}removeEntry(e,t,r){return Qi(e).delete(oU(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=at.newInvalidDocument(t);return Qi(e).iterate({index:Bd,range:IDBKeyRange.only(vl(t))},(i,s)=>{r=this.maybeDecodeDocument(t,s)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:at.newInvalidDocument(t)};return Qi(e).iterate({index:Bd,range:IDBKeyRange.only(vl(t))},(i,s)=>{r={document:this.maybeDecodeDocument(t,s),size:oh(s)}}).next(()=>r)}getEntries(e,t){let r=Wt();return this.forEachDbEntry(e,t,(i,s)=>{let o=this.maybeDecodeDocument(i,s);r=r.insert(i,o)}).next(()=>r)}getSizedEntries(e,t){let r=Wt(),i=new Ne(U.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);r=r.insert(s,a),i=i.insert(s,oh(o))}).next(()=>({documents:r,sizeMap:i}))}forEachDbEntry(e,t,r){if(t.isEmpty())return E.resolve();let i=new Ae(GT);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(vl(i.first()),vl(i.last())),o=i.getIterator(),a=o.getNext();return Qi(e).iterate({index:Bd,range:s},(l,c,u)=>{let d=U.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&GT(a,d)<0;)r(a,null),a=o.getNext();a&&a.isEqual(d)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.skip(vl(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Wh(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Qi(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=Wt();for(let d of c){let f=this.maybeDecodeDocument(U.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);f.isFoundDocument()&&(ic(t,f)||i.has(f.key))&&(u=u.insert(f.key,f))}return u})}getAllFromCollectionGroup(e,t,r,i){let s=Wt(),o=zT(t,r),a=zT(t,Sn.max());return Qi(e).iterate({index:bA,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{let d=this.maybeDecodeDocument(U.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(d.key,d),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new bv(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return UT(e).get(Oy).next(t=>(H(!!t),t))}setMetadata(e,t){return UT(e).put(Oy,t)}maybeDecodeDocument(e,t){if(t){let r=vq(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Q.min())))return r}return at.newInvalidDocument(e)}};function OI(n){return new Sv(n)}var bv=class extends lh{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new cr(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new Ae((s,o)=>ne(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=ST(this.documentCache.serializer,o);i=i.add(s.path.popLast());let c=oh(l);r+=c-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){let l=ST(this.documentCache.serializer,o.convertToNoDocument(Q.min()));t.push(this.documentCache.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,r)),E.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(r=>(this.documentStates.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:r,sizeMap:i})=>(i.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function UT(n){return dt(n,ec)}function Qi(n){return dt(n,Ph)}function vl(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function oU(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],Wh(e),t[t.length-1]]}function zT(n,e){let t=e.documentKey.path.toArray();return[n,Wh(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function GT(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=ne(t[s],r[s]),i)return i;return i=ne(t.length,r.length),i||(i=ne(t[t.length-2],r[r.length-2]),i)?i:ne(t[t.length-1],r[r.length-1])}var aU=17;var Cv=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var ch=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Tl(r.mutation,i,an.empty(),Ve.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,re()).next(()=>r))}getLocalViewOfDocuments(e,t,r=re()){let i=sr();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Sl();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=sr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,re()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Wt(),o=Pl(),a=XB();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof Pn)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),Tl(u.mutation,c,u.mutation.getFieldMask(),Ve.now())):o.set(c.key,an.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var d;return a.set(c,new Cv(u,(d=o.get(c))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){let r=Pl(),i=new Ne((o,a)=>o-a),s=re();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||an.empty();u=a.applyToLocalView(c,u),r.set(l,u);let d=(i.get(a.batchId)||re()).add(l);i=i.insert(a.batchId,d)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,d=tI();u.forEach(f=>{if(!s.has(f)){let v=lI(t.get(f),r.get(f));v!==null&&d.set(f,v),s=s.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return E.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return UB(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):O_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):E.resolve(sr()),a=Bo,l=s;return o.next(c=>E.forEach(c,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?E.resolve():this.remoteDocumentCache.getEntry(e,u).next(f=>{l=l.insert(u,f)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,re())).next(u=>({batchId:a,changes:eI(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new U(t)).next(r=>{let i=Sl();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Sl();return this.indexManager.getCollectionParents(e,s).next(a=>E.forEach(a,l=>{let c=BB(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((d,f)=>{o=o.insert(d,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,at.newInvalidDocument(u)))});let a=Sl();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&Tl(u.mutation,c,an.empty(),Ve.now()),ic(t,c)&&(a=a.insert(l,c))}),a})}};var Ev=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return E.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,Iq(t)),E.resolve()}getNamedQuery(e,t){return E.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,Aq(t)),E.resolve()}};var wv=class{constructor(){this.overlays=new Ne(U.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return E.resolve(this.overlays.get(t))}getOverlays(e,t){let r=sr();return E.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),E.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),E.resolve()}getOverlaysForCollection(e,t,r){let i=sr(),s=t.length+1,o=new U(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return E.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Ne((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let f=s.get(u.largestBatchId);f===null&&(f=sr(),s=s.insert(u.largestBatchId,f)),f.set(u.getKey(),u)}}let a=sr(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,f)=>a.set(d,f)),!(a.size()>=i)););return E.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Bl(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=re(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var Tv=class{constructor(){this.sessionToken=tt.EMPTY_BYTE_STRING}getSessionToken(e){return E.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,E.resolve()}};var jl=class{constructor(){this.refsByKey=new Ae(st.compareByKey),this.refsByTarget=new Ae(st.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new st(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new st(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new U(new ue([])),r=new st(t,e),i=new st(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new U(new ue([])),r=new st(t,e),i=new st(t,e+1),s=re();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new st(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},st=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return U.comparator(e.key,t.key)||ne(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return ne(e.targetOrBatchId,t.targetOrBatchId)||U.comparator(e.key,t.key)}};var Av=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new Ae(st.compareByKey)}checkEmpty(e){return E.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Ll(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new st(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return E.resolve(o)}lookupMutationBatch(e,t){return E.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return E.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return E.resolve(this.mutationQueue.length===0?yi:this.nextBatchId-1)}getAllMutationBatches(e){return E.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new st(t,0),i=new st(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),E.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ae(ne);return t.forEach(i=>{let s=new st(i,0),o=new st(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),E.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;U.isDocumentKey(s)||(s=s.child(""));let o=new st(new U(s),0),a=new Ae(ne);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),E.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");H(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return E.forEach(t.mutations,s=>{let o=new st(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new st(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return E.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,E.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function lU(){return new Ne(U.comparator)}var Iv=class{constructor(e){this.sizer=e,this.docs=lU(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return E.resolve(r?r.document.mutableCopy():at.newInvalidDocument(t))}getEntries(e,t){let r=Wt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():at.newInvalidDocument(i))}),E.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Wt(),o=t.path,a=new U(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||E_(fA(u),r)<=0||!i.has(u.key)&&!ic(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return E.resolve(s)}getAllFromCollectionGroup(e,t,r,i){G()}forEachDocumentKey(e,t){return E.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Dv(this)}getSize(e){return E.resolve(this.size)}};function cU(n){return new Iv(n)}var Dv=class extends lh{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),E.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var kv=class{constructor(e){this.persistence=e,this.targets=new cr(t=>us(t),nc),this.lastRemoteSnapshotVersion=Q.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new jl,this.targetCount=0,this.targetIdGenerator=$o.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),E.resolve()}getLastRemoteSnapshotVersion(e){return E.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return E.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),E.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),E.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new $o(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,E.resolve()}updateTargetData(e,t){return this.saveTargetData(t),E.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,E.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),E.waitFor(s).next(()=>i)}getTargetCount(e){return E.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return E.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),E.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),E.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),E.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return E.resolve(r)}containsKey(e,t){return E.resolve(this.references.containsKey(t))}};var uU="MemoryPersistence",uh=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new on(0),this._started=!1,this._started=!0,this.globalsCache=new Tv,this.referenceDelegate=e(this),this.targetCache=new kv(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new fv,this.remoteDocumentCache=cU(r),this.serializer=new nh(t),this.bundleCache=new Ev(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new wv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new Av(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){N(uU,"Starting transaction:",e);let i=new Rv(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return E.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},Rv=class extends Wd{constructor(e){super(),this.currentSequenceNumber=e}},dh=class n{constructor(e){this.persistence=e,this.localViewReferences=new jl,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw G()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),E.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),E.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),E.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return E.forEach(this.orphanedDocuments,i=>{let s=U.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,Q.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return E.or([()=>E.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var xv=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,i){let s=new Hd("createOrUpgrade",t);r<1&&i>=1&&(hU(e),fU(e),jT(e),mU(e));let o=E.resolve();return r<3&&i>=3&&(r!==0&&(vU(e),jT(e)),o=o.next(()=>SU(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>pU(e,s))),o=o.next(()=>{bU(e)})),r<5&&i>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),r<6&&i>=6&&(o=o.next(()=>(yU(e),this.addDocumentGlobal(s)))),r<7&&i>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),r<8&&i>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),r<9&&i>=9&&(o=o.next(()=>{_U(e)})),r<10&&i>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),r<11&&i>=11&&(o=o.next(()=>{CU(e),EU(e)})),r<12&&i>=12&&(o=o.next(()=>{TU(e)})),r<13&&i>=13&&(o=o.next(()=>gU(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(Ji))),r<14&&i>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),r<15&&i>=15&&(o=o.next(()=>wU(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore(Bh).clear()}).next(()=>{t.objectStore(Vh).clear()})),r<17&&i>=17&&(o=o.next(()=>{AU(e)})),o}addDocumentGlobal(e){let t=0;return e.store(Ji).iterate((r,i)=>{t+=oh(i)}).next(()=>{let r={byteSize:t};return e.store(ec).put(Oy,r)})}removeAcknowledgedMutations(e){let t=e.store(Zl),r=e.store(xn);return t.loadAll().next(i=>E.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,yi],[s.userId,s.lastAcknowledgedBatchId]);return r.loadAll(ts,o).next(a=>E.forEach(a,l=>{H(l.userId===s.userId);let c=Xi(this.serializer,l);return RI(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(sa),r=e.store(Ji);return e.store(_s).get(Kd).next(s=>{let o=l=>t.put({targetId:0,path:Mt(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return r.iterate((l,c)=>{let u=new ue(l),d=dU(u);a.push(t.get(d).next(f=>f?E.resolve():o(u)))}).next(()=>E.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(kl,{keyPath:E2});let r=t.store(kl),i=new Gl,s=o=>{if(i.add(o)){let a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Mt(l)})}};return t.store(Ji).iterate({keysOnly:!0},(o,a)=>{let l=new ue(o);return s(l.popLast())}).next(()=>t.store(ra).iterate({keysOnly:!0},([o,a,l],c)=>{let u=ir(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(ia);return t.iterate((r,i)=>{let s=bl(i),o=AI(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let r=t.store(Ji),i=[];return r.iterate((s,o)=>{let a=t.store(Ph),l=IU(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>E.waitFor(i))}runOverlayMigration(e,t){let r=t.store(xn),i=OI(this.serializer),s=new uh(dh.factory,this.serializer.remoteSerializer);return r.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:re();Xi(this.serializer,l).keys().forEach(f=>u=u.add(f)),a.set(l.userId,u)}),E.forEach(a,(l,c)=>{let u=new lt(c),d=rh.forUser(this.serializer,u),f=s.getIndexManager(u),v=ah.forUser(u,this.serializer,f,s.referenceDelegate);return new ch(i,v,d,f).recalculateAndSaveOverlaysForDocumentKeys(new Rl(t,on.INVALID),l).next()})})}};function dU(n){return[0,Mt(n)]}function hU(n){n.createObjectStore(Xl)}function fU(n){n.createObjectStore(Zl,{keyPath:f2}),n.createObjectStore(xn,{keyPath:vA,autoIncrement:!0}).createIndex(ts,_A,{unique:!0}),n.createObjectStore(ra)}function pU(n,e){return e.store(xn).loadAll().next(r=>{n.deleteObjectStore(xn),n.createObjectStore(xn,{keyPath:vA,autoIncrement:!0}).createIndex(ts,_A,{unique:!0});let s=e.store(xn),o=r.map(a=>s.put(a));return E.waitFor(o)})}function mU(n){n.createObjectStore(Ji)}function gU(n){let e=n.createObjectStore(Ph,{keyPath:g2});e.createIndex(Bd,y2),e.createIndex(bA,v2)}function yU(n){n.createObjectStore(ec)}function jT(n){n.createObjectStore(sa,{keyPath:b2}).createIndex(T_,C2,{unique:!0}),n.createObjectStore(ia,{keyPath:_2}).createIndex(CA,S2,{unique:!0}),n.createObjectStore(_s)}function vU(n){n.deleteObjectStore(sa),n.deleteObjectStore(ia),n.deleteObjectStore(_s)}function _U(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function SU(n){let e=n.store(_s),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Q.min().toTimestamp(),targetCount:0};return e.put(Kd,t)}function bU(n){n.createObjectStore(Vo,{keyPath:w2})}function CU(n){n.createObjectStore(Fh,{keyPath:T2})}function EU(n){n.createObjectStore(Lh,{keyPath:A2})}function wU(n){n.createObjectStore(A_,{keyPath:I2,autoIncrement:!0}).createIndex(Py,D2,{unique:!1}),n.createObjectStore(Bh,{keyPath:k2}).createIndex(EA,R2,{unique:!1}),n.createObjectStore(Vh,{keyPath:x2}).createIndex(wA,M2,{unique:!1})}function TU(n){let e=n.createObjectStore(qh,{keyPath:N2});e.createIndex(Fy,O2,{unique:!1}),e.createIndex(TA,P2,{unique:!1})}function AU(n){n.createObjectStore(I_,{keyPath:F2})}function IU(n){return n.document?new U(ue.fromString(n.document.name).popFirst(5)):n.noDocument?U.fromSegments(n.noDocument.path):n.unknownDocument?U.fromSegments(n.unknownDocument.path):G()}var fi="IndexedDbPersistence",py=30*60*1e3,my=5e3,DU=4e3,gy="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",kU="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",RU="firestore_zombie",PI="main",Mv=class n{constructor(e,t,r,i,s,o,a,l,c,u,d=aU){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=d,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=f=>Promise.resolve(),!n.isAvailable())throw new R(I.UNIMPLEMENTED,kU);this.referenceDelegate=new _v(this,i),this.dbName=t+PI,this.serializer=new nh(l),this.simpleDb=new _i(this.dbName,this.schemaVersion,new xv(this.serializer)),this.globalsCache=new lv,this.targetCache=new mv(this.referenceDelegate,this.serializer),this.remoteDocumentCache=OI(this.serializer),this.bundleCache=new av,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&Be(fi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new R(I.FAILED_PRECONDITION,gy);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new on(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>C(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>C(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>C(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Pd(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(r=>{r||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(r=>this.isPrimary&&!r?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):r?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(Ri(e))return N(fi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return N(fi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return _l(e).get(Co).next(r=>E.resolve(this.isLocalClient(r)))}removeClientMetadata(e){return Pd(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return C(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,py)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=dt(t,Vo);return r.loadAll().next(i=>{let s=this.filterActiveClients(i,py),o=i.filter(a=>s.indexOf(a)===-1);return E.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",DU,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?E.resolve(!0):_l(e).get(Co).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,my)&&!this.isClientZombied(r.ownerId)){if(this.isLocalClient(r)&&this.networkEnabled)return!0;if(!this.isLocalClient(r)){if(!r.allowTabSynchronization)throw new R(I.FAILED_PRECONDITION,gy);return!1}}return this.networkEnabled&&this.inForeground?!0:Pd(e).loadAll().next(s=>this.filterActiveClients(s,my).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&N(fi,`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){return C(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[Xl,Vo],e=>{let t=new Rl(e,on.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(r=>this.isWithinAge(r.updateTimeMs,t)&&!this.isClientZombied(r.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>Pd(e).loadAll().next(t=>this.filterActiveClients(t,py).map(r=>r.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return ah.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new pv(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return rh.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){N(fi,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=W2(this.schemaVersion),o;return this.simpleDb.runTransaction(e,i,s,a=>(o=new Rl(a,this.listenSequence?this.listenSequence.next():on.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw Be(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new R(I.FAILED_PRECONDITION,pA);return r(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return _l(e).get(Co).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,my)&&!this.isClientZombied(r.ownerId)&&!this.isLocalClient(r)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!r.allowTabSynchronization))throw new R(I.FAILED_PRECONDITION,gy)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return _l(e).put(Co,t)}static isAvailable(){return _i.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=_l(e);return t.get(Co).next(r=>this.isLocalClient(r)?(N(fi,"Releasing primary lease."),t.delete(Co)):E.resolve())}isWithinAge(e,t){let r=Date.now(),i=r-t,s=r;return e<i?!1:e>s?(Be(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;Df()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return N(fi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Be(fi,"Failed to get zombied client id.",r),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){Be("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${RU}_${this.persistenceKey}_${e}`}};function _l(n){return dt(n,Xl)}function Pd(n){return dt(n,Vo)}function G_(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function xU(n){return C(this,null,function*(){if(!_i.isAvailable())return Promise.resolve();let e=n+PI;yield _i.delete(e)})}function MU(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}var j_="LocalStore",NU=5*60*1e6,Wl=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new Ne(ne),this.targetIdByTarget=new cr(s=>us(s),nc),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ch(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function FI(n,e,t,r){return new Wl(n,e,t,r)}function LI(n,e){return C(this,null,function*(){let t=z(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=re();for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of o){l.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function OU(n,e){let t=z(n),r=Ve.now(),i=e.reduce((a,l)=>a.add(l.key),re()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=Wt(),c=re();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((d,f)=>{f.isValidDocument()||(c=c.add(d))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let d=[];for(let f of e){let v=uV(f,s.get(f.key).overlayedDocument);v!=null&&d.push(new Pn(f.key,v,qA(v.value.mapValue),je.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,d,e)}).next(u=>{o=u;let d=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,d)})}).then(()=>({batchId:o.batchId,changes:eI(s)}))}function PU(n,e){let t=z(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return WU(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,FU(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function FU(n){let e=re();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function LU(n,e){let t=z(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(H(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function BU(n){let e=z(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function BI(n){let e=z(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function VU(n,e){let t=z(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,d)=>{let f=i.get(d);if(!f)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,d)));let v=f.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?v=v.withResumeToken(tt.EMPTY_BYTE_STRING,Q.min()).withLastLimboFreeSnapshotVersion(Q.min()):u.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(u.resumeToken,r)),i=i.insert(d,v),qU(f,v,u)&&a.push(t.targetCache.updateTargetData(s,v))});let l=Wt(),c=re();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(VI(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(Q.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(d=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return E.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function VI(n,e,t){let r=re(),i=re();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Wt();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(Q.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):N(j_,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function qU(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=NU?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function UU(n,e){return C(this,null,function*(){let t=z(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>E.forEach(e,i=>E.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>E.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(Ri(r))N(j_,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function zU(n,e){let t=z(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=yi),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function GU(n,e){let t=z(n);return t.persistence.runTransaction("read document","readonly",r=>t.localDocuments.getDocument(r,e))}function Qo(n,e){let t=z(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,E.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new Ko(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function jU(n,e,t){let r=z(n),i=r.targetIdByTarget.get(t);return i!==void 0?E.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function Yo(n,e,t){return C(this,null,function*(){let r=z(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(Ri(o))N(j_,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function Hh(n,e,t){let r=z(n),i=Q.min(),s=re();return r.persistence.runTransaction("Execute query","readwrite",o=>jU(r,o,Nt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:Q.min(),t?s:re())).next(a=>(zI(r,JA(e),a),{documents:a,remoteKeys:s})))}function WU(n,e,t,r){let i=t.batch,s=i.keys(),o=E.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);H(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function HU(n,e){let t=z(n),r=z(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",i=>r.lookupMutationKeys(i,e).next(s=>s?t.localDocuments.getDocuments(i,s):E.resolve(null)))}function KU(n,e){z(z(n,Wl).mutationQueue).removeCachedMutationKeys(e)}function $U(n){return z(z(n,Wl).persistence).getActiveClients()}function qI(n,e){let t=z(n),r=z(t.targetCache),i=t.targetDataByTarget.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function UI(n,e){let t=z(n),r=t.collectionGroupReadTime.get(e)||Q.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.remoteDocuments.getAllFromCollectionGroup(i,e,hA(r,Bo),Number.MAX_SAFE_INTEGER)).then(i=>(zI(t,e,i),i))}function zI(n,e,t){let r=n.collectionGroupReadTime.get(e)||Q.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function QU(n){return Nt(oa(ue.fromString(`__bundle__/docs/${n}`)))}function YU(n,e,t,r){return C(this,null,function*(){let i=z(n),s=re(),o=Wt();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let d=e.toMutableDocument(c);d.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),o=o.insert(u,d)}let a=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield Qo(i,QU(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>VI(c,a,o).next(u=>(a.apply(c),u)).next(u=>i.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>i.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function JU(n,e){let t=z(n),r=Ze(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",i=>t.bundleCache.getBundleMetadata(i,e.id)).then(i=>!!i&&i.createTime.compareTo(r)>=0)}function XU(n,e){let t=z(n);return t.persistence.runTransaction("Save bundle","readwrite",r=>t.bundleCache.saveBundleMetadata(r,e))}function ZU(n,e){let t=z(n);return t.persistence.runTransaction("Get named query","readonly",r=>t.bundleCache.getNamedQuery(r,e))}function e3(r,i){return C(this,arguments,function*(n,e,t=re()){let s=yield Qo(n,Nt(V_(e.bundledQuery))),o=z(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=Ze(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let c=s.withResumeToken(tt.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(c.targetId,c),o.targetCache.updateTargetData(a,c).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var Nv=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var t3=100;function n3(){return Df()?8:mA(ka())>0?6:4}var hh=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=t3,this.relativeIndexReadCostPerDocument=n3()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Nv;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(ko()<=qn.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",Ro(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),E.resolve()):(ko()<=qn.DEBUG&&N("QueryEngine","Query:",Ro(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(ko()<=qn.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",Ro(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Nt(t))):E.resolve())}performQueryUsingIndex(e,t){if(hT(t))return E.resolve(null);let r=Nt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Xd(t,null,"F"),r=Nt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=re(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,Xd(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return hT(t)||i.isEqual(Q.min())?E.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?E.resolve(null):(ko()<=qn.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ro(t)),this.appendRemainingResults(e,o,t,hA(i,Bo)).next(a=>a))})}applyQuery(e,t){let r=new Ae(XA(e));return t.forEach((i,s)=>{ic(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return ko()<=qn.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",Ro(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,Sn.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var GI="firestore_clients";function WT(n,e){return`${GI}_${n}_${e}`}var jI="firestore_mutations";function HT(n,e,t){let r=`${jI}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var WI="firestore_targets";function yy(n,e){return`${WI}_${n}_${e}`}var r3="firestore_online_state";function i3(n){return`${r3}_${n}`}var s3="firestore_bundle_loaded_v2";function o3(n){return`${s3}_${n}`}var a3="firestore_sequence_number";function l3(n){return`${a3}_${n}`}var rr="SharedClientState",fh=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fromWebStorageEntry(e,t,r){let i=JSON.parse(r),s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),o;return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(o=new R(i.error.code,i.error.message))),s?new n(e,t,i.state,o):(Be(rr,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Al=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),s;return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new R(r.error.code,r.error.message))),i?new n(e,r.state,s):(Be(rr,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},ph=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=F_();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=PA(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Be(rr,`Failed to parse client data for instance '${e}': ${t}`),null)}},Ov=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Be(rr,`Failed to parse online state: ${e}`),null)}},Hl=class{constructor(){this.activeTargetIds=F_()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Il=class{constructor(e,t,r,i,s){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new Ne(ne),this.started=!1,this.earlyEvents=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=WT(this.persistenceKey,this.localClientId),this.sequenceNumberKey=l3(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new Hl),this.clientStateKeyRe=new RegExp(`^${GI}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${jI}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${WI}_${o}_(\\d+)$`),this.onlineStateKey=i3(this.persistenceKey),this.bundleLoadedKey=o3(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return C(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let r of e){if(r===this.localClientId)continue;let i=this.getItem(WT(this.persistenceKey,r));if(i){let s=ph.fromWebStorageEntry(r,i);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let r=this.fromWebStorageOnlineState(t);r&&this.handleOnlineStateEvent(r)}for(let r of this.earlyEvents)this.handleWebStorageEvent(r);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(yy(this.persistenceKey,e));if(i){let s=Al.fromWebStorageEntry(e,i);s&&(r=s.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),r}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(yy(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.removeMutationState(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return N(rr,"READ",e,t),t}setItem(e,t){N(rr,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){N(rr,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(N(rr,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){Be("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>C(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let r=this.fromWebStorageClientState(t.key,t.newValue);if(r)return this.handleClientStateEvent(r.clientId,r)}else{let r=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(r,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(r)return this.handleMutationBatchEvent(r)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(r)return this.handleQueryTargetEvent(r)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let r=this.fromWebStorageOnlineState(t.newValue);if(r)return this.handleOnlineStateEvent(r)}}else if(t.key===this.sequenceNumberKey){let r=c3(t.newValue);r!==on.INVALID&&this.sequenceNumberHandler(r)}else if(t.key===this.bundleLoadedKey){let r=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.synchronizeWithChangedDocuments(i)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let i=new fh(this.currentUser,e,t,r),s=HT(this.persistenceKey,this.currentUser,e);this.setItem(s,i.toWebStorageJSON())}removeMutationState(e){let t=HT(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let i=yy(this.persistenceKey,e),s=new Al(e,t,r);this.setItem(i,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return ph.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return fh.fromWebStorageEntry(new lt(s),i,t)}fromWebStorageQueryTargetMetadata(e,t){let r=this.queryTargetKeyRe.exec(e),i=Number(r[1]);return Al.fromWebStorageEntry(i,t)}fromWebStorageOnlineState(e){return Ov.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return C(this,null,function*(){if(e.user.uid!==this.currentUser.uid){N(rr,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=F_();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}};function c3(n){let e=on.INVALID;if(n!=null)try{let t=JSON.parse(n);H(typeof t=="number"),e=t}catch(t){Be(rr,"Failed to read sequence number from WebStorage",t)}return e}var mh=class{constructor(){this.localState=new Hl,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Hl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Pv=class{addCallback(e){}shutdown(){}};var Fv=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var Fd=null;function u3(){return 268435456+Math.round(2147483648*Math.random())}function vy(){return Fd===null?Fd=u3():Fd++,"0x"+Fd.toString(16)}function d3(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var h3="1.9.1",xt="GrpcConnection",f3=`gl-node/${process.versions.node} fire/${na} grpc/${h3}`;function _y(n,e,t,r){H(e===null||e.type==="OAuth");let i=new is.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",f3),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var Lv=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){N(xt,"Creating Firestore stub.");let e=this.databaseInfo.ssl?is.credentials.createSsl():is.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=vy(),a=this.ensureActiveStub(),l=_y(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return d3(u=>(N(xt,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(d,f)=>{d?(N(xt,`RPC '${e}' ${o} failed with error:`,d),u(new R(Ud(d.code),d.message))):(N(xt,`RPC '${e}' ${o} completed with response:`,f),u(void 0,f))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=vy(),l=[],c=new ot;N(xt,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),d=_y(this.databasePath,i,s,this.databaseInfo.appId),f=Object.assign(Object.assign({},r),{database:this.databasePath}),v=u[e](f,d),w=!1;return v.on("data",A=>{N(xt,`RPC ${e} ${a} received result:`,A),l.push(A),o!==void 0&&l.length===o&&(w=!0,c.resolve(l))}),v.on("end",()=>{N(xt,`RPC '${e}' ${a} completed.`),w||(w=!0,c.resolve(l))}),v.on("error",A=>{N(xt,`RPC '${e}' ${a} failed with error:`,A);let T=Ud(A.code);c.reject(new R(T,A.message))}),c.promise}openStream(e,t,r){let i=vy(),s=this.ensureActiveStub(),o=_y(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=f=>{l||(l=!0,u.callOnClose(f),a.end())},u=new Fv({sendFn:f=>{if(l)N(xt,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,f);else{N(xt,`RPC '${e}' stream ${i} sending:`,f);try{a.write(f)}catch(v){throw Be("Failure sending:",f),Be("Error:",v),v}}},closeFn:()=>{N(xt,`RPC '${e}' stream ${i} closed locally via close().`),c()}}),d=!1;return a.on("data",f=>{l||(N(xt,`RPC '${e}' stream ${i} received:`,f),d||(u.callOnConnected(),d=!0),u.callOnMessage(f))}),a.on("end",()=>{N(xt,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",f=>{if(!l){Mn(xt,`RPC '${e}' stream ${i} error. Code:`,f.code,"Message:",f.message);let v=Ud(f.code);c(new R(v,f.message))}}),N(xt,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},HI={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},p3={nested:HI},m3=Object.freeze({__proto__:null,nested:HI,default:p3});var g3={longs:String,enums:String,defaults:!0,oneofs:!1};function y3(){let n=lA.fromJSON(m3,g3);return is.loadPackageDefinition(n)}function v3(n){let e=y3();return new Lv(e,n)}function _3(){return new Pv}function KI(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function S3(){return null}function oc(n){return new nv(n,!1)}var b3="ExponentialBackoff",C3=1e3,E3=1.5,w3=60*1e3,Kl=class{constructor(e,t,r=C3,i=E3,s=w3){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&N(b3,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var KT="PersistentStream",T3=60*1e3,A3=10*1e3,gh=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new Kl(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.responseCount=0,this.state===4){this.performBackoff();return}this.auth()}stop(){return C(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,T3,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return C(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return C(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===I.RESOURCE_EXHAUSTED?(Be(t.toString()),Be("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===I.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new R(I.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,A3,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>++this.responseCount===1?this.onFirst(i):this.onNext(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>C(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return N(KT,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(N(KT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Bv=class extends gh{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=PV(this.serializer,e),r=LV(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=sv(this.serializer),t.addTarget=$V(this.serializer,e);let r=HV(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=sv(this.serializer),t.removeTarget=e,this.sendRequest(t)}},Vv=class extends gh{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return H(!!e.streamToken),this.lastStreamToken=e.streamToken,H(!e.writeResults||e.writeResults.length===0),this.listener.onHandshakeComplete()}onNext(e){H(!!e.streamToken),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=UV(e.writeResults,e.commitTime),r=Ze(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=sv(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>zl(this.serializer,r))};this.sendRequest(t)}};var qv=class{},Uv=class extends qv{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new R(I.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,iv(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===I.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new R(I.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,iv(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===I.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new R(I.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function I3(n,e,t,r){return new Uv(n,e,t,r)}function D3(n,e){return C(this,null,function*(){let t=z(n),r={writes:e.map(i=>zl(t.serializer,i))};yield t.invokeRPC("Commit",t.serializer.databaseId,ue.emptyPath(),r)})}function k3(n,e){return C(this,null,function*(){let t=z(n),r={documents:e.map(a=>Ul(t.serializer,a))},i=yield t.invokeStreamingRPC("BatchGetDocuments",t.serializer.databaseId,ue.emptyPath(),r,e.length),s=new Map;i.forEach(a=>{let l=OV(t.serializer,a);s.set(l.key.toString(),l)});let o=[];return e.forEach(a=>{let l=s.get(a.toString());H(!!l),o.push(l)}),o})}function R3(n,e,t){let r=z(n);return r.verifyInitialized(),new Vv(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function x3(n,e,t){let r=z(n);return r.verifyInitialized(),new Bv(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var M3="OnlineStateTracker",$T=1,QT=10*1e3,zv=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",QT,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${QT/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=$T&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${$T} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(Be(t),this.shouldWarnClientIsOffline=!1):N(M3,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var ps="RemoteStore",N3=10,Gv=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>C(this,null,function*(){xi(this)&&(N(ps,"Restarting streams for network reachability change."),yield J3(this))}))}),this.onlineStateTracker=new zv(r,i)}};function O3(n,e,t,r,i){return new Gv(n,e,t,r,i)}function P3(n){let e=z(n);return e.offlineCauses.delete(0),ac(e)}function ac(n){return C(this,null,function*(){if(xi(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function F3(n){return C(this,null,function*(){let e=z(n);e.offlineCauses.add(0),yield aa(e),e.onlineStateTracker.set("Offline")})}function aa(n){return C(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function L3(n){return C(this,null,function*(){let e=z(n);N(ps,"RemoteStore shutting down."),e.offlineCauses.add(5),yield aa(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function Kh(n,e){let t=z(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),K_(t)?H_(t):ua(t).isOpen()&&W_(t,e))}function la(n,e){let t=z(n),r=ua(t);t.listenTargets.delete(e),r.isOpen()&&$I(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():xi(t)&&t.onlineStateTracker.set("Unknown"))}function W_(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Q.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ua(n).watch(e)}function $I(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),ua(n).unwatch(e)}function H_(n){n.watchChangeAggregator=new tv({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),ua(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function K_(n){return xi(n)&&!ua(n).isStarted()&&n.listenTargets.size>0}function xi(n){return z(n).offlineCauses.size===0}function QI(n){n.watchChangeAggregator=void 0}function B3(n){return C(this,null,function*(){n.onlineStateTracker.set("Online")})}function V3(n){return C(this,null,function*(){n.listenTargets.forEach((e,t)=>{W_(n,e)})})}function q3(n,e){return C(this,null,function*(){QI(n),K_(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),H_(n)):n.onlineStateTracker.set("Unknown")})}function U3(n,e,t){return C(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof eh&&e.state===2&&e.cause){try{yield G3(n,e)}catch(r){N(ps,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield yh(n,r)}return}if(e instanceof Lo?n.watchChangeAggregator.handleDocumentChange(e):e instanceof Zd?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(Q.min()))try{let r=yield BI(n.localStore);t.compareTo(r)>=0&&(yield z3(n,t))}catch(r){N(ps,"Failed to raise snapshot:",r),yield yh(n,r)}})}function yh(n,e,t){return C(this,null,function*(){if(Ri(e))n.offlineCauses.add(1),yield aa(n),n.onlineStateTracker.set("Offline"),t||(t=()=>BI(n.localStore)),n.asyncQueue.enqueueRetryable(()=>C(this,null,function*(){N(ps,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield ac(n)}));else throw e})}function YI(n,e){return e().catch(t=>yh(n,t,e))}function z3(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(tt.EMPTY_BYTE_STRING,s.snapshotVersion)),$I(n,r);let o=new Ko(s.target,r,i,s.sequenceNumber);W_(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function G3(n,e){return C(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function ca(n){return C(this,null,function*(){let e=z(n),t=Mi(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:yi;for(;j3(e);)try{let i=yield zU(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,W3(e,i)}catch(i){yield yh(e,i)}JI(e)&&XI(e)})}function j3(n){return xi(n)&&n.writePipeline.length<N3}function W3(n,e){n.writePipeline.push(e);let t=Mi(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function JI(n){return xi(n)&&!Mi(n).isStarted()&&n.writePipeline.length>0}function XI(n){Mi(n).start()}function H3(n){return C(this,null,function*(){Mi(n).writeHandshake()})}function K3(n){return C(this,null,function*(){let e=Mi(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function $3(n,e,t){return C(this,null,function*(){let r=n.writePipeline.shift(),i=Jy.from(r,e,t);yield YI(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield ca(n)})}function Q3(n,e){return C(this,null,function*(){e&&Mi(n).handshakeComplete&&(yield Y3(n,e)),JI(n)&&XI(n)})}function Y3(n,e){return C(this,null,function*(){if(yV(e.code)){let t=n.writePipeline.shift();Mi(n).inhibitBackoff(),yield YI(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield ca(n)}})}function J3(n){return C(this,null,function*(){let e=z(n);e.offlineCauses.add(4),yield aa(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield ac(e)})}function YT(n,e){return C(this,null,function*(){let t=z(n);t.asyncQueue.verifyOperationInProgress(),N(ps,"RemoteStore received new credentials");let r=xi(t);t.offlineCauses.add(3),yield aa(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield ac(t)})}function jv(n,e){return C(this,null,function*(){let t=z(n);e?(t.offlineCauses.delete(2),yield ac(t)):e||(t.offlineCauses.add(2),yield aa(t),t.onlineStateTracker.set("Unknown"))})}function ua(n){return n.watchStream||(n.watchStream=x3(n.datastore,n.asyncQueue,{onConnected:B3.bind(null,n),onOpen:V3.bind(null,n),onClose:q3.bind(null,n),onWatchChange:U3.bind(null,n)}),n.onNetworkStatusChange.push(e=>C(this,null,function*(){e?(n.watchStream.inhibitBackoff(),K_(n)?H_(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),QI(n))}))),n.watchStream}function Mi(n){return n.writeStream||(n.writeStream=R3(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:H3.bind(null,n),onClose:Q3.bind(null,n),onHandshakeComplete:K3.bind(null,n),onMutationResult:$3.bind(null,n)}),n.onNetworkStatusChange.push(e=>C(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield ca(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(N(ps,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var X3="AsyncQueue",Wv=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ot,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new R(I.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function da(n,e){if(Be(X3,`${e}: ${n}`),Ri(n))return new R(I.UNAVAILABLE,`${e}: ${n}`);throw n}var vh=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||U.comparator(t.key,r.key):this.comparator=(t,r)=>U.comparator(t.key,r.key),this.keyedMap=Sl(),this.sortedSet=new Ne(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var _h=class{constructor(){this.changeMap=new Ne(U.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):G()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},Jo=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,vh.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!rc(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Hv=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function Z3(){return new Kv}var Kv=class{constructor(){this.queries=ZI(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){s4(this,new R(I.ABORTED,"Firestore shutting down"))}};function ZI(){return new cr(n=>YA(n),rc)}function $_(n,e){return C(this,null,function*(){let t=z(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new Hv,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=da(o,`Initialization of query '${Ro(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&Y_(t)})}function Q_(n,e){return C(this,null,function*(){let t=z(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function e4(n,e){let t=z(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&Y_(t)}function t4(n,e,t){let r=z(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function n4(n,e){let t=z(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&Y_(t)}function r4(n,e){z(n).snapshotsInSyncListeners.add(e),e.next()}function i4(n,e){z(n).snapshotsInSyncListeners.delete(e)}function s4(n,e){let t=z(n),r=t.queries;t.queries=ZI(),r.forEach((i,s)=>{for(let o of s.listeners)o.onError(e)})}function Y_(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var eD=function(n){return n.Default="default",n.Cache="cache",n}(eD||{}),$l=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Jo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=Jo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==eD.Cache}};var $v=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=re(),i=re();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var Sh=class{constructor(e){this.serializer=e}toDocumentKey(e){return or(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?_I(this.serializer,e.document,!1):at.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return Ze(e)}},Qv=class{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=tD(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let r=ue.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new Sh(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.toDocumentKey(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||re()).add(s);t.set(o,a)}}return t}complete(){return C(this,null,function*(){let e=yield YU(this.localStore,new Sh(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let r of this.queries)yield e3(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function tD(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function o4(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var bh=class{constructor(e){this.key=e}},Ch=class{constructor(e){this.key=e}},Eh=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=re(),this.mutatedKeys=re(),this.docComparator=XA(e),this.documentSet=new vh(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new _h,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,d)=>{let f=i.get(u),v=ic(this.query,d)?d:null,w=f?this.mutatedKeys.has(f.key):!1,A=v?v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations:!1,T=!1;f&&v?f.data.isEqual(v.data)?w!==A&&(r.track({type:3,doc:v}),T=!0):this.shouldWaitForSyncedDocument(f,v)||(r.track({type:2,doc:v}),T=!0,(l&&this.docComparator(v,l)>0||c&&this.docComparator(v,c)<0)&&(a=!0)):!f&&v?(r.track({type:0,doc:v}),T=!0):f&&!v&&(r.track({type:1,doc:f}),T=!0,(l||c)&&(a=!0)),T&&(v?(o=o.add(v),A?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((d,f)=>a4(d.type,f.type)||this.docComparator(d.doc,f.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new Jo(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new _h,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=re(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new Ch(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new bh(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=re();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return Jo.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function a4(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return G()}};return t(n)-t(e)}var Ni="SyncEngine",Yv=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Jv=class{constructor(e){this.key=e,this.receivedDocument=!1}},Xv=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new cr(a=>YA(a),rc),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new Ne(U.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new jl,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=$o.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function l4(n,e,t,r,i,s,o){let a=new Xv(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function c4(n,e,t=!0){return C(this,null,function*(){let r=$h(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield nD(r,e,t,!0),i})}function u4(n,e){return C(this,null,function*(){let t=$h(n);yield nD(t,e,!0,!1)})}function nD(n,e,t,r){return C(this,null,function*(){let i=yield Qo(n.localStore,Nt(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=yield J_(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Kh(n.remoteStore,i),a})}function J_(n,e,t,r,i){return C(this,null,function*(){n.applyDocChanges=(d,f,v)=>b4(n,d,f,v);let s=yield Hh(n.localStore,e,!0),o=new Eh(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=ql.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);e0(n,t,c.limboChanges);let u=new Yv(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function d4(n,e,t){return C(this,null,function*(){let r=z(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!rc(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Yo(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&la(r.remoteStore,i.targetId),Xo(r,i.targetId)}).catch(ki))):(Xo(r,i.targetId),yield Yo(r.localStore,i.targetId,!0))})}function h4(n,e){return C(this,null,function*(){let t=z(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),la(t.remoteStore,r.targetId))})}function f4(n,e,t){return C(this,null,function*(){let r=n0(n);try{let i=yield OU(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),_4(r,i.batchId,t),yield kr(r,i.changes),yield ca(r.remoteStore)}catch(i){let s=da(i,"Failed to persist write");t.reject(s)}})}function rD(n,e){return C(this,null,function*(){let t=z(n);try{let r=yield VU(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(H(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?H(o.receivedDocument):i.removedDocuments.size>0&&(H(o.receivedDocument),o.receivedDocument=!1))}),yield kr(t,r,e)}catch(r){yield ki(r)}})}function JT(n,e,t){let r=z(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),n4(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function p4(n,e,t){return C(this,null,function*(){let r=z(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new Ne(U.comparator);o=o.insert(s,at.newNoDocument(s,Q.min()));let a=re().add(s),l=new Vl(Q.min(),new Map,new Ne(ne),o,a);yield rD(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),t0(r)}else yield Yo(r.localStore,e,!1).then(()=>Xo(r,e,t)).catch(ki)})}function m4(n,e){return C(this,null,function*(){let t=z(n),r=e.batch.batchId;try{let i=yield PU(t.localStore,e);Z_(t,r,null),X_(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield kr(t,i)}catch(i){yield ki(i)}})}function g4(n,e,t){return C(this,null,function*(){let r=z(n);try{let i=yield LU(r.localStore,e);Z_(r,e,t),X_(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield kr(r,i)}catch(i){yield ki(i)}})}function y4(n,e){return C(this,null,function*(){let t=z(n);xi(t.remoteStore)||N(Ni,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield BU(t.localStore);if(r===yi){e.resolve();return}let i=t.pendingWritesCallbacks.get(r)||[];i.push(e),t.pendingWritesCallbacks.set(r,i)}catch(r){let i=da(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function X_(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function v4(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new R(I.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function _4(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new Ne(ne)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function Z_(n,e,t){let r=z(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function Xo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||iD(n,i)})}function iD(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(la(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),t0(n))}function e0(n,e,t){for(let r of t)r instanceof bh?(n.limboDocumentRefs.addReference(r.key,e),S4(n,r)):r instanceof Ch?(N(Ni,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||iD(n,r.key)):G()}function S4(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(N(Ni,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),t0(n))}function t0(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new U(ue.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new Jv(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),Kh(n.remoteStore,new Ko(Nt(oa(t.path)),r,"TargetPurposeLimboResolution",on.INVALID))}}function kr(n,e,t){return C(this,null,function*(){let r=z(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{var u;if((c||t)&&r.isPrimaryClient){let d=c?!c.fromCache:(u=t?.targetChanges.get(l.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,d?"current":"not-current")}if(c){i.push(c);let d=$v.fromSnapshot(l.targetId,c);s.push(d)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield UU(r.localStore,s))})}function b4(n,e,t,r){return C(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield Hh(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return e0(n,e.targetId,a.limboChanges),a.snapshot})}function C4(n,e){return C(this,null,function*(){let t=z(n);if(!t.currentUser.isEqual(e)){N(Ni,"User change. New user:",e.toKey());let i=yield LI(t.localStore,e);t.currentUser=e,v4(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield kr(t,i.affectedDocuments)}})}function E4(n,e){let t=z(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return re().add(r.key);{let i=re(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function w4(n,e){return C(this,null,function*(){let t=z(n),r=yield Hh(t.localStore,e.query,!0),i=e.view.synchronizeWithPersistedState(r);return t.isPrimaryClient&&e0(t,e.targetId,i.limboChanges),i})}function T4(n,e){return C(this,null,function*(){let t=z(n);return UI(t.localStore,e).then(r=>kr(t,r))})}function A4(n,e,t,r){return C(this,null,function*(){let i=z(n),s=yield HU(i.localStore,e);if(s===null){N(Ni,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield ca(i.remoteStore):t==="acknowledged"||t==="rejected"?(Z_(i,e,r||null),X_(i,e),KU(i.localStore,e)):G(),yield kr(i,s)})}function I4(n,e){return C(this,null,function*(){let t=z(n);if($h(t),n0(t),e===!0&&t._isPrimaryClient!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield XT(t,r.toArray());t._isPrimaryClient=!0,yield jv(t.remoteStore,!0);for(let s of i)Kh(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let r=[],i=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Xo(t,o),Yo(t.localStore,o,!0))),la(t.remoteStore,o)}),yield i,yield XT(t,r),D4(t),t._isPrimaryClient=!1,yield jv(t.remoteStore,!1)}})}function D4(n){let e=z(n);e.activeLimboResolutionsByTarget.forEach((t,r)=>{la(e.remoteStore,r)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new Ne(U.comparator)}function XT(n,e,t){return C(this,null,function*(){let r=z(n),i=[],s=[];for(let o of e){let a,l=r.queriesByTarget.get(o);if(l&&l.length!==0){a=yield Qo(r.localStore,Nt(l[0]));for(let c of l){let u=r.queryViewsByQuery.get(c),d=yield w4(r,u);d.snapshot&&s.push(d.snapshot)}}else{let c=yield qI(r.localStore,o);a=yield Qo(r.localStore,c),yield J_(r,sD(c),o,!1,a.resumeToken)}i.push(a)}return r.syncEngineListener.onWatchChange(s),i})}function sD(n){return QA(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function k4(n){let e=z(n);return $U(e.localStore)}function R4(n,e,t,r){return C(this,null,function*(){let i=z(n);if(i._isPrimaryClient){N(Ni,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield UI(i.localStore,JA(s[0])),a=Vl.createSynthesizedRemoteEventForCurrentChange(e,t==="current",tt.EMPTY_BYTE_STRING);yield kr(i,o,a);break}case"rejected":{yield Yo(i.localStore,e,!0),Xo(i,e,r);break}default:G()}})}function x4(n,e,t){return C(this,null,function*(){let r=$h(n);if(r._isPrimaryClient){for(let i of e){if(r.queriesByTarget.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){N(Ni,"Adding an already active target "+i);continue}let o=yield qI(r.localStore,i),a=yield Qo(r.localStore,o);yield J_(r,sD(o),a.targetId,!1,a.resumeToken),Kh(r.remoteStore,a)}for(let i of t)r.queriesByTarget.has(i)&&(yield Yo(r.localStore,i,!1).then(()=>{la(r.remoteStore,i),Xo(r,i)}).catch(ki))}})}function $h(n){let e=z(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=rD.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=E4.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=p4.bind(null,e),e.syncEngineListener.onWatchChange=e4.bind(null,e.eventManager),e.syncEngineListener.onWatchError=t4.bind(null,e.eventManager),e}function n0(n){let e=z(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=m4.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=g4.bind(null,e),e}function M4(n,e,t){let r=z(n);N4(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function N4(n,e,t){return C(this,null,function*(){try{let r=yield e.getMetadata();if(yield JU(n.localStore,r))return yield e.close(),t._completeWith(o4(r)),Promise.resolve(new Set);t._updateProgress(tD(r));let s=new Qv(r,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield kr(n,a.changedDocs,void 0),yield XU(n.localStore,r),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(r){return Mn(Ni,`Loading bundle failed with ${r}`),t._failWith(r),Promise.resolve(new Set)}})}var Zv=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return C(this,null,function*(){this.serializer=oc(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,r){return null}createIndexBackfillerScheduler(t,r){return null}createLocalStore(t){return FI(this.persistence,new hh,t.initialUser,this.serializer)}createPersistence(t){return new uh(dh.factory,this.serializer)}createSharedClientState(t){return new mh}terminate(){return C(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var wh=class n extends Zv{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return C(this,null,function*(){yield yf(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield n0(this.onlineComponentProvider.syncEngine),yield ca(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return FI(this.persistence,new hh,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new yv(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new My(t,this.persistence);return new xy(e.asyncQueue,r)}createPersistence(e){let t=G_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?_n.withCacheSize(this.cacheSizeBytes):_n.DEFAULT;return new Mv(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,KI(),S3(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new mh}},e_=class n extends wh{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return C(this,null,function*(){yield yf(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof Il&&(this.sharedClientState.syncEngine={applyBatchState:A4.bind(null,t),applyTargetState:R4.bind(null,t),applyActiveTargetsChange:x4.bind(null,t),getActiveClients:k4.bind(null,t),synchronizeWithChangedDocuments:T4.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(r=>C(this,null,function*(){yield I4(this.onlineComponentProvider.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=KI();if(!Il.isAvailable(t))throw new R(I.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=G_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Il(t,e.asyncQueue,r,e.clientId,e.initialUser)}},r0=(()=>{class n{initialize(t,r){return C(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>JT(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=C4.bind(null,this.syncEngine),yield jv(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return Z3()}createDatastore(t){let r=oc(t.databaseInfo.databaseId),i=v3(t.databaseInfo);return I3(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return O3(this.localStore,this.datastore,t.asyncQueue,r=>JT(this.syncEngine,r,0),_3())}createSyncEngine(t,r){return l4(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return C(this,null,function*(){var t,r;yield L3(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}n.provider={build:()=>new n};return n})(),O4=10240;function P4(n,e=O4){let t=0;return{read(){return C(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return C(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function i0(n,e,t){if(!t)throw new R(I.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function s0(n,e,t,r){if(e===!0&&r===!0)throw new R(I.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ZT(n){if(!U.isDocumentKey(n))throw new R(I.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function eA(n){if(U.isDocumentKey(n))throw new R(I.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function F4(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function lc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=L4(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":G()}function L4(n){return n.constructor?n.constructor.name:null}function fe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new R(I.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=lc(n);throw new R(I.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function oD(n,e){if(e<=0)throw new R(I.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function B4(n,e){if(!(n instanceof Uint8Array))throw new R(I.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${lc(n)}`);return P4(n,e)}var Zo=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):Be("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var t_=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var n_=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new ot,this.buffer=new Uint8Array,this.textDecoder=vV(),this.nextElementImpl().then(r=>{r&&r.isBundleMetadata()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.reader.cancel()}getMetadata(){return C(this,null,function*(){return this.metadata.promise})}nextElement(){return C(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return C(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),r=Number(t);isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`);let i=yield this.readJsonString(r);return new t_(JSON.parse(i),e.length+r)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e===123)}readLength(){return C(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return C(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return C(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function V4(n,e){return new n_(n,e)}var r_=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return C(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new R(I.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield k3(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ai(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return C(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=U.fromPath(r);this.mutations.push(new Fl(i,this.precondition(i)))}),yield D3(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=Q.min();else throw G();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new R(I.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Q.min())?je.exists(!1):je.updateTime(t):je.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Q.min()))throw new R(I.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return je.updateTime(t)}else return je.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var i_=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.attemptsRemaining=r.maxAttempts,this.backoff=new Kl(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>C(this,null,function*(){let e=new r_(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.handleTransactionError(i)}))}).catch(r=>{this.handleTransactionError(r)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return tc(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!hI(t)}return!1}};var Ii="FirestoreClient",q4=100,U4=11,z4=20,G4=22,s_=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=lt.UNAUTHENTICATED,this.clientId=Gd.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>C(this,null,function*(){N(Ii,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(N(Ii,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:q4}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ot;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>C(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=da(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Sy(n,e){return C(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),N(Ii,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>C(this,null,function*(){r.isEqual(i)||(yield LI(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function tA(n,e){return C(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield o0(n);N(Ii,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>YT(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>YT(e.remoteStore,i)),n._onlineComponents=e})}function j4(n){return n.name==="FirebaseError"?n.code===I.FAILED_PRECONDITION||n.code===I.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===G4||n.code===z4||n.code===U4:!0}function o0(n){return C(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){N(Ii,"Using user provided OfflineComponentProvider");try{yield Sy(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!j4(t))throw t;Mn("Error using user provided cache. Falling back to memory cache: "+t),yield Sy(n,new Zv)}}else N(Ii,"Using default OfflineComponentProvider"),yield Sy(n,new Zv);return n._offlineComponents})}function Qh(n){return C(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(N(Ii,"Using user provided OnlineComponentProvider"),yield tA(n,n._uninitializedComponentsProvider._online)):(N(Ii,"Using default OnlineComponentProvider"),yield tA(n,new r0))),n._onlineComponents})}function aD(n){return o0(n).then(e=>e.persistence)}function a0(n){return o0(n).then(e=>e.localStore)}function lD(n){return Qh(n).then(e=>e.remoteStore)}function l0(n){return Qh(n).then(e=>e.syncEngine)}function W4(n){return Qh(n).then(e=>e.datastore)}function ea(n){return C(this,null,function*(){let e=yield Qh(n),t=e.eventManager;return t.onListen=c4.bind(null,e.syncEngine),t.onUnlisten=d4.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=u4.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=h4.bind(null,e.syncEngine),t})}function H4(n){return n.asyncQueue.enqueue(()=>C(this,null,function*(){let e=yield aD(n),t=yield lD(n);return e.setNetworkEnabled(!0),P3(t)}))}function K4(n){return n.asyncQueue.enqueue(()=>C(this,null,function*(){let e=yield aD(n),t=yield lD(n);return e.setNetworkEnabled(!1),F3(t)}))}function $4(n){let e=new ot;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let t=yield l0(n);return y4(t,e)})),e.promise}function Q4(n,e,t,r){let i=new Zo(r),s=new $l(e,i,t);return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let o=yield ea(n);return $_(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let o=yield ea(n);return Q_(o,s)}))}}function Y4(n,e){let t=new ot;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let r=yield a0(n);return t6(r,e,t)})),t.promise}function cD(n,e,t={}){let r=new ot;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let i=yield ea(n);return n6(i,n.asyncQueue,e,t,r)})),r.promise}function J4(n,e){let t=new ot;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let r=yield a0(n);return r6(r,e,t)})),t.promise}function uD(n,e,t={}){let r=new ot;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let i=yield ea(n);return i6(i,n.asyncQueue,e,t,r)})),r.promise}function X4(n,e){let t=new ot;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let r=yield l0(n);return f4(r,e,t)})),t.promise}function Z4(n,e){let t=new Zo(e);return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let r=yield ea(n);return r4(r,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let r=yield ea(n);return i4(r,t)}))}}function e6(n,e,t){let r=new ot;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let i=yield W4(n);new i_(n.asyncQueue,i,t,e,r).run()})),r.promise}function t6(n,e,t){return C(this,null,function*(){try{let r=yield GU(n,e);r.isFoundDocument()?t.resolve(r):r.isNoDocument()?t.resolve(null):t.reject(new R(I.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let i=da(r,`Failed to get document '${e} from cache`);t.reject(i)}})}function n6(n,e,t,r,i){let s=new Zo({next:a=>{s.mute(),e.enqueueAndForget(()=>Q_(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new R(I.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new R(I.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new $l(oa(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return $_(n,o)}function r6(n,e,t){return C(this,null,function*(){try{let r=yield Hh(n,e,!0),i=new Eh(e,r.remoteKeys),s=i.computeDocChanges(r.documents),o=i.applyChanges(s,!1);t.resolve(o.snapshot)}catch(r){let i=da(r,`Failed to execute query '${e} against cache`);t.reject(i)}})}function i6(n,e,t,r,i){let s=new Zo({next:a=>{s.mute(),e.enqueueAndForget(()=>Q_(n,o)),a.fromCache&&r.source==="server"?i.reject(new R(I.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new $l(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return $_(n,o)}function s6(n,e,t,r){let i=a6(t,oc(e));n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){M4(yield l0(n),i,r)}))}function o6(n,e){return n.asyncQueue.enqueue(()=>C(this,null,function*(){return ZU(yield a0(n),e)}))}function a6(n,e){let t;return typeof n=="string"?t=fI().encode(n):t=n,V4(B4(t),e)}function l6(n,e){return n.timeoutSeconds===e.timeoutSeconds}function dD(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var c6="ComponentProvider",nA=new Map;function u6(n){let e=nA.get(n);e&&(N(c6,"Removing Datastore"),nA.delete(n),e.terminate())}function d6(n,e,t,r){return new By(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,dD(r.experimentalLongPollingOptions),r.useFetchStreams)}var hD="firestore.googleapis.com",rA=!0,iA=5,sA=30,h6=!0,Th=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new R(I.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=hD,this.ssl=rA}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:rA;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=NI;else{if(e.cacheSizeBytes!==sc&&e.cacheSizeBytes<VT)throw new R(I.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${VT}`);this.cacheSizeBytes=e.cacheSizeBytes}s0("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=h6:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=dD((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),f6(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&l6(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function f6(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new R(I.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<iA)throw new R(I.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${iA})`);if(n.timeoutSeconds>sA)throw new R(I.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${sA})`)}}var ms=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Th({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new R(I.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new R(I.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Th(e),e.credentials!==void 0&&(this._authCredentials=n2(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return C(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return u6(this),Promise.resolve()}};function fD(n,e,t,r={}){var i;n=fe(n,ms);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==hD&&s.host!==o&&Mn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=lt.MOCK_USER;else{a=rS(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new R(I.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new lt(c)}n._authCredentials=new Cy(new zd(a,l))}}var yt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},xe=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ar(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},ar=class n extends yt{constructor(e,t,r){super(e,t,oa(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new xe(this.firestore,null,new U(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function c0(n,e,...t){if(n=Le(n),i0("collection","path",e),n instanceof ms){let r=ue.fromString(e,...t);return eA(r),new ar(n,null,r)}else{if(!(n instanceof xe)&&!(n instanceof ar))throw new R(I.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ue.fromString(e,...t));return eA(r),new ar(n.firestore,null,r)}}function pD(n,e){if(n=fe(n,ms),i0("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new R(I.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new yt(n,null,qB(e))}function cc(n,e,...t){if(n=Le(n),arguments.length===1&&(e=Gd.newId()),i0("doc","path",e),n instanceof ms){let r=ue.fromString(e,...t);return ZT(r),new xe(n,null,new U(r))}else{if(!(n instanceof xe)&&!(n instanceof ar))throw new R(I.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ue.fromString(e,...t));return ZT(r),new xe(n.firestore,n instanceof ar?n.converter:null,new U(r))}}function u0(n,e){return n=Le(n),e=Le(e),(n instanceof xe||n instanceof ar)&&(e instanceof xe||e instanceof ar)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function d0(n,e){return n=Le(n),e=Le(e),n instanceof yt&&e instanceof yt?n.firestore===e.firestore&&rc(n._query,e._query)&&n.converter===e.converter:!1}var p6="AsyncQueue",Ah=class{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new Kl(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new ot;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return C(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(Ri(e))N(p6,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=m6(r);throw Be("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=Wv.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&G()}verifyOperationInProgress(){}drain(){return C(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function m6(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var o_=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new ot,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var mD=sc,qe=class extends ms{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Ah,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return C(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Ah(e),this._firestoreClient=void 0,yield e}})}};function vt(n){if(n._terminated)throw new R(I.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||gD(n),n._firestoreClient}function gD(n){var e,t,r;let i=n._freezeSettings(),s=d6(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new s_(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&g6(n._componentsProvider))}function g6(n){let e=n?._online.build();return{_offline:n?._offline.build(e),_online:e}}function yD(n,e){Mn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return _D(n,r0.provider,{build:r=>new wh(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function vD(n){return C(this,null,function*(){Mn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();_D(n,r0.provider,{build:t=>new e_(t,e.cacheSizeBytes)})})}function _D(n,e,t){if(n=fe(n,qe),n._firestoreClient||n._terminated)throw new R(I.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new R(I.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},gD(n)}function SD(n){if(n._initialized&&!n._terminated)throw new R(I.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new ot;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>C(this,null,function*(){try{yield xU(G_(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function bD(n){n=fe(n,qe);let e=vt(n);return $4(e)}function CD(n){n=fe(n,qe);let e=vt(n);return H4(e)}function ED(n){n=fe(n,qe);let e=vt(n);return K4(e)}function wD(n,e){n=fe(n,qe);let t=vt(n),r=new o_;return s6(t,n._databaseId,e,r),r}function TD(n,e){n=fe(n,qe);let t=vt(n);return o6(t,e).then(r=>r?new yt(n,null,r.query):null)}function y6(n,e=!0){e2(oS),Ra(new Li("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new qe(new Ey(t.getProvider("auth-internal")),new Iy(t.getProvider("app-check-internal")),Z2(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),Pr(Jw,Xw,n),Pr(Jw,Xw,"esm2017")}var ur=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(tt.fromBase64String(e))}catch(t){throw new R(I.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(tt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Fn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new R(I.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new et(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Ar=class{constructor(e){this._methodName=e}};var gs=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new R(I.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new R(I.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ne(this._lat,e._lat)||ne(this._long,e._long)}};var Ql=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return MU(this._values,e._values)}};var v6=/^__.*__$/,a_=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Pn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ti(e,this.data,t,this.fieldTransforms)}},Ih=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Pn(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function AD(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw G()}}var Dh=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return kh(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(AD(this.dataSource)&&v6.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},l_=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||oc(e)}createContext(e,t,r,i=!1){return new Dh({dataSource:e,methodName:t,targetDoc:r,path:et.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function bs(n){let e=n._freezeSettings(),t=oc(n._databaseId);return new l_(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Yh(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);p0("Data must be an object, but it was:",o,r);let a=kD(r,o),l,c;if(s.merge)l=new an(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let d of s.mergeFields){let f=f_(e,d,t);if(!o.contains(f))throw new R(I.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);xD(u,f)||u.push(f)}l=new an(u),c=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,c=o.fieldTransforms;return new a_(new Tt(a),l,c)}var Yl=class n extends Ar{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function ID(n,e,t){return new Dh({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var c_=class n extends Ar{_toFieldTransform(e){return new ds(e.path,new Ei)}isEqual(e){return e instanceof n}},u_=class n extends Ar{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=ID(this,e,!0),r=this._elements.map(s=>Cs(s,t)),i=new wr(r);return new ds(e.path,i)}isEqual(e){return e instanceof n&&kf(this._elements,e._elements)}},d_=class n extends Ar{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=ID(this,e,!0),r=this._elements.map(s=>Cs(s,t)),i=new Tr(r);return new ds(e.path,i)}isEqual(e){return e instanceof n&&kf(this._elements,e._elements)}},h_=class n extends Ar{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new wi(e.serializer,rI(e.serializer,this._operand));return new ds(e.path,t)}isEqual(e){return e instanceof n&&this._operand===e._operand}};function h0(n,e,t,r){let i=n.createContext(1,e,t);p0("Data must be an object, but it was:",i,r);let s=[],o=Tt.empty();Ss(r,(l,c)=>{let u=m0(e,l,t);c=Le(c);let d=i.childContextForFieldPath(u);if(c instanceof Yl)s.push(u);else{let f=Cs(c,d);f!=null&&(s.push(u),o.set(u,f))}});let a=new an(s);return new Ih(o,a,i.fieldTransforms)}function f0(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[f_(e,r,t)],l=[i];if(s.length%2!==0)throw new R(I.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)a.push(f_(e,s[f])),l.push(s[f+1]);let c=[],u=Tt.empty();for(let f=a.length-1;f>=0;--f)if(!xD(c,a[f])){let v=a[f],w=l[f];w=Le(w);let A=o.childContextForFieldPath(v);if(w instanceof Yl)c.push(v);else{let T=Cs(w,A);T!=null&&(c.push(v),u.set(v,T))}}let d=new an(c);return new Ih(u,d,o.fieldTransforms)}function DD(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return Cs(t,i)}function Cs(n,e){if(n=Le(n),RD(n))return p0("Unsupported field value:",e,n),kD(n,e);if(n instanceof Ar)return S6(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return _6(n,e)}else return b6(n,e)}function kD(n,e){let t={};return kA(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ss(n,(r,i)=>{let s=Cs(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function _6(n,e){let t=[],r=0;for(let i of n){let s=Cs(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function S6(n,e){if(!AD(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function b6(n,e){if(n=Le(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return rI(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=Ve.fromDate(n);return{timestampValue:Ho(e.serializer,t)}}else if(n instanceof Ve){let t=new Ve(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:Ho(e.serializer,t)}}else{if(n instanceof gs)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof ur)return{bytesValue:pI(e.serializer,n._byteString)};if(n instanceof xe){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:B_(n.firestore._databaseId||e.databaseId,n._key.path)}}else{if(n instanceof Ql)return C6(n,e);throw e.createError(`Unsupported field value: ${lc(n)}`)}}}function C6(n,e){return{mapValue:{fields:{[R_]:{stringValue:x_},[qo]:{arrayValue:{values:n.toArray().map(r=>{if(typeof r!="number")throw e.createError("VectorValues must only contain numeric values.");return L_(e.serializer,r)})}}}}}}function RD(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof Ve)&&!(n instanceof gs)&&!(n instanceof ur)&&!(n instanceof xe)&&!(n instanceof Ar)&&!(n instanceof Ql)}function p0(n,e,t){if(!RD(t)||!F4(t)){let r=lc(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function f_(n,e,t){if(e=Le(e),e instanceof Fn)return e._internalPath;if(typeof e=="string")return m0(n,e);throw kh("Field path arguments must be of type string or ",n,!1,void 0,t)}var E6=new RegExp("[~\\*/\\[\\]]");function m0(n,e,t){if(e.search(E6)>=0)throw kh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Fn(...e.split("."))._internalPath}catch{throw kh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function kh(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new R(I.INVALID_ARGUMENT,a+n+l)}function xD(n,e){return n.some(t=>t.isEqual(e))}var ys=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new xe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new p_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(Jh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},p_=class extends ys{data(){return super.data()}};function Jh(n,e){return typeof e=="string"?m0(n,e):e instanceof Fn?e._internalPath:e._delegate._internalPath}function MD(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new R(I.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Jl=class{},vs=class extends Jl{};function Rr(n,e,...t){let r=[];e instanceof Jl&&r.push(e),r=r.concat(t),x6(r);for(let i of r)n=i._apply(n);return n}var Rh=class n extends vs{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return zD(e._query,t),new yt(e.firestore,e.converter,P_(e._query,t))}_parse(e){let t=bs(e.firestore);return w6(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function ND(n,e,t){let r=e,i=Jh("where",n);return Rh._create(i,r,t)}var m_=class n extends Jl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:we.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(k6(e._query,t),new yt(e.firestore,e.converter,P_(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var g_=class n extends vs{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=T6(e._query,this._field,this._direction);return new yt(e.firestore,e.converter,GB(e._query,t))}};function OD(n,e="asc"){let t=e,r=Jh("orderBy",n);return g_._create(r,t)}var xh=class n extends vs{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new yt(e.firestore,e.converter,Xd(e._query,this._limit,this._limitType))}};function PD(n){return oD("limit",n),xh._create("limit",n,"F")}function FD(n){return oD("limitToLast",n),xh._create("limitToLast",n,"L")}var Mh=class n extends vs{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=UD(e,this.type,this._docOrFields,this._inclusive);return new yt(e.firestore,e.converter,jB(e._query,t))}};function LD(...n){return Mh._create("startAt",n,!0)}function BD(...n){return Mh._create("startAfter",n,!1)}var Nh=class n extends vs{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=UD(e,this.type,this._docOrFields,this._inclusive);return new yt(e.firestore,e.converter,WB(e._query,t))}};function VD(...n){return Nh._create("endBefore",n,!1)}function qD(...n){return Nh._create("endAt",n,!0)}function UD(n,e,t,r){if(t[0]=Le(t[0]),t[0]instanceof ys)return A6(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=bs(n.firestore);return I6(n._query,n.firestore._databaseId,i,e,t,r)}}function w6(n,e,t,r,i,s,o){let a;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new R(I.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){aA(o,s);let c=[];for(let u of o)c.push(oA(r,n,u));a={arrayValue:{values:c}}}else a=oA(r,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&aA(o,s),a=DD(t,e,o,s==="in"||s==="not-in");return ae.create(i,s,a)}function T6(n,e,t){if(n.startAt!==null)throw new R(I.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new R(I.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new cs(e,t)}function A6(n,e,t,r,i){if(!r)throw new R(I.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of Go(n))if(o.field.isKeyField())s.push(ls(e,r.key));else{let a=r.data.field(o.field);if(Uh(a))throw new R(I.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new R(I.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new lr(s,i)}function I6(n,e,t,r,i,s){let o=n.explicitOrderBy;if(i.length>o.length)throw new R(I.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<i.length;l++){let c=i[l];if(o[l].field.isKeyField()){if(typeof c!="string")throw new R(I.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!O_(n)&&c.indexOf("/")!==-1)throw new R(I.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);let d=n.path.child(ue.fromString(c));if(!U.isDocumentKey(d))throw new R(I.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${d}' is not because it contains an odd number of segments.`);let f=new U(d);a.push(ls(e,f))}else{let d=DD(t,r,c);a.push(d)}}return new lr(a,s)}function oA(n,e,t){if(t=Le(t),typeof t=="string"){if(t==="")throw new R(I.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!O_(e)&&t.indexOf("/")!==-1)throw new R(I.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(ue.fromString(t));if(!U.isDocumentKey(r))throw new R(I.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ls(n,new U(r))}else{if(t instanceof xe)return ls(n,t._key);throw new R(I.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${lc(t)}.`)}}function aA(n,e){if(!Array.isArray(n)||n.length===0)throw new R(I.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function D6(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function zD(n,e){let t=R6(n.filters,D6(e.op));if(t!==null)throw t===e.op?new R(I.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new R(I.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function k6(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)zD(t,i),t=P_(t,i)}function R6(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function x6(n){let e=n.filter(r=>r instanceof m_).length,t=n.filter(r=>r instanceof Rh).length;if(e>1||e>0&&t>0)throw new R(I.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var ta=class{convertValue(e,t="none"){switch(as(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Pe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Si(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw G()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Ss(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[qo].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>Pe(o.doubleValue));return new Ql(s)}convertGeoPoint(e){return new gs(Pe(e.latitude),Pe(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=k_(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(xl(e));default:return null}}convertTimestamp(e){let t=Er(e);return new Ve(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ue.fromString(e);H(TI(r));let i=new bi(r.get(1),r.get(3)),s=new U(r.popFirst(5));return i.isEqual(t)||Be(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Xh(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var y_=class extends ta{constructor(e){super(),this.firestore=e}convertBytes(e){return new ur(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new xe(this.firestore,null,t)}};function v_(n){return M6(n,["next","error","complete"])}function M6(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var Ir=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},bn=class extends ys{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new Di(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(Jh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Di=class extends bn{data(e={}){return super.data(e)}},Ln=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Ir(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Di(this._firestore,this._userDataWriter,r.key,r,new Ir(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new R(I.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=N6(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function N6(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new Di(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Ir(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new Di(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Ir(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:O6(r.type),doc:i,oldIndex:s,newIndex:o}})}}function O6(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return G()}}function g0(n,e){return n instanceof bn&&e instanceof bn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ln&&e instanceof Ln?n._firestore===e._firestore&&d0(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function GD(n){n=fe(n,xe);let e=fe(n.firestore,qe),t=vt(e);return cD(t,n._key).then(r=>S0(e,n,r))}var Dr=class extends ta{constructor(e){super(),this.firestore=e}convertBytes(e){return new ur(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new xe(this.firestore,null,t)}};function jD(n){n=fe(n,xe);let e=fe(n.firestore,qe),t=vt(e),r=new Dr(e);return Y4(t,n._key).then(i=>new bn(e,r,n._key,i,new Ir(i!==null&&i.hasLocalMutations,!0),n.converter))}function WD(n){n=fe(n,xe);let e=fe(n.firestore,qe),t=vt(e);return cD(t,n._key,{source:"server"}).then(r=>S0(e,n,r))}function HD(n){n=fe(n,yt);let e=fe(n.firestore,qe),t=vt(e),r=new Dr(e);return MD(n._query),uD(t,n._query).then(i=>new Ln(e,r,n,i))}function KD(n){n=fe(n,yt);let e=fe(n.firestore,qe),t=vt(e),r=new Dr(e);return J4(t,n._query).then(i=>new Ln(e,r,n,i))}function $D(n){n=fe(n,yt);let e=fe(n.firestore,qe),t=vt(e),r=new Dr(e);return uD(t,n._query,{source:"server"}).then(i=>new Ln(e,r,n,i))}function y0(n,e,t){n=fe(n,xe);let r=fe(n.firestore,qe),i=Xh(n.converter,e,t),s=bs(r),a=Yh(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,je.none());return ha(r,[a])}function v0(n,e,t,...r){n=fe(n,xe);let i=fe(n.firestore,qe),s=bs(i);e=Le(e);let o;typeof e=="string"||e instanceof Fn?o=f0(s,"updateDoc",n._key,e,t,r):o=h0(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,je.exists(!0));return ha(i,[a])}function QD(n){let e=fe(n.firestore,qe),t=[new Ai(n._key,je.none())];return ha(e,t)}function YD(n,e){let t=fe(n.firestore,qe),r=cc(n),i=Xh(n.converter,e),s=bs(n.firestore),a=Yh(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,je.exists(!1));return ha(t,[a]).then(()=>r)}function _0(n,...e){var t,r,i;n=Le(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!v_(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(v_(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(i=f.complete)===null||i===void 0?void 0:i.bind(f)}let l,c,u;if(n instanceof xe)c=fe(n.firestore,qe),u=oa(n._key.path),l={next:f=>{e[o]&&e[o](S0(c,n,f))},error:e[o+1],complete:e[o+2]};else{let f=fe(n,yt);c=fe(f.firestore,qe),u=f._query;let v=new Dr(c);l={next:w=>{e[o]&&e[o](new Ln(c,v,f,w))},error:e[o+1],complete:e[o+2]},MD(n._query)}let d=vt(c);return Q4(d,u,a,l)}function JD(n,e){n=fe(n,qe);let t=vt(n),r=v_(e)?e:{next:e};return Z4(t,r)}function ha(n,e){let t=vt(n);return X4(t,e)}function S0(n,e,t){let r=t.docs.get(e._key),i=new Dr(n);return new bn(n,i,e._key,r,new Ir(t.hasPendingWrites,t.fromCache),e.converter)}var P6={maxAttempts:5};function F6(n){if(n.maxAttempts<1)throw new R(I.INVALID_ARGUMENT,"Max attempts must be at least 1")}var Oh=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=bs(e)}set(e,t,r){this._verifyNotCommitted();let i=gi(e,this._firestore),s=Xh(i.converter,t,r),o=Yh(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,je.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=gi(e,this._firestore);t=Le(t);let o;return typeof t=="string"||t instanceof Fn?o=f0(this._dataReader,"WriteBatch.update",s._key,t,r,i):o=h0(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,je.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=gi(e,this._firestore);return this._mutations=this._mutations.concat(new Ai(t._key,je.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new R(I.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function gi(n,e){if(n=Le(n),n.firestore!==e)throw new R(I.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var __=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=bs(e)}get(e){let t=gi(e,this._firestore),r=new y_(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return G();let s=i[0];if(s.isFoundDocument())return new ys(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new ys(this._firestore,r,t._key,null,t.converter);throw G()})}set(e,t,r){let i=gi(e,this._firestore),s=Xh(i.converter,t,r),o=Yh(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=gi(e,this._firestore);t=Le(t);let o;return typeof t=="string"||t instanceof Fn?o=f0(this._dataReader,"Transaction.update",s._key,t,r,i):o=h0(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=gi(e,this._firestore);return this._transaction.delete(t._key),this}};var S_=class extends __{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=gi(e,this._firestore),r=new Dr(this._firestore);return super.get(e).then(i=>new bn(this._firestore,r,t._key,i._document,new Ir(!1,!1),t.converter))}};function XD(n,e,t){n=fe(n,qe);let r=Object.assign(Object.assign({},P6),t);F6(r);let i=vt(n);return e6(i,s=>e(new S_(n,s)),r)}function ZD(){return new Yl("deleteField")}function e1(){return new c_("serverTimestamp")}function t1(...n){return new u_("arrayUnion",n)}function n1(...n){return new d_("arrayRemove",n)}function r1(n){return new h_("increment",n)}y6("node");var L6="@firebase/firestore-compat",B6="0.3.38";function A0(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new R("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function i1(){if(typeof Uint8Array>"u")throw new R("unimplemented","Uint8Arrays are not available in this environment.")}function s1(){if(!RA())throw new R("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Zh=class n{constructor(e){this._delegate=e}static fromBase64String(e){return s1(),new n(ur.fromBase64String(e))}static fromUint8Array(e){return i1(),new n(ur.fromUint8Array(e))}toBase64(){return s1(),this._delegate.toBase64()}toUint8Array(){return i1(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function b0(n){return V6(n,["next","error","complete"])}function V6(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var C0=class{enableIndexedDbPersistence(e,t){return yD(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return vD(e._delegate)}clearIndexedDbPersistence(e){return SD(e._delegate)}},ef=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof bi||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Mn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){fD(this._delegate,e,t,r)}enableNetwork(){return CD(this._delegate)}disableNetwork(){return ED(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,s0("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return bD(this._delegate)}onSnapshotsInSync(e){return JD(this._delegate,e)}get app(){if(!this._appCompat)throw new R("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new ma(this,c0(this._delegate,e))}catch(t){throw Ot(t,"collection()","Firestore.collection()")}}doc(e){try{return new dr(this,cc(this._delegate,e))}catch(t){throw Ot(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new As(this,pD(this._delegate,e))}catch(t){throw Ot(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return XD(this._delegate,t=>e(new tf(this,t)))}batch(){return vt(this._delegate),new nf(new Oh(this._delegate,e=>ha(this._delegate,e)))}loadBundle(e){return wD(this._delegate,e)}namedQuery(e){return TD(this._delegate,e).then(t=>t?new As(this,t):null)}},fa=class extends ta{constructor(e){super(),this.firestore=e}convertBytes(e){return new Zh(new ur(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return dr.forKey(t,this.firestore,null)}};function q6(n){cA(n)}var tf=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new fa(e)}get(e){let t=Es(e);return this._delegate.get(t).then(r=>new ws(this._firestore,new bn(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Es(e);return r?(A0("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Es(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Es(e);return this._delegate.delete(t),this}},nf=class{constructor(e){this._delegate=e}set(e,t,r){let i=Es(e);return r?(A0("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Es(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Es(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},pa=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new Di(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Ts(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new fa(e),t),i.set(t,s)),s}};pa.INSTANCES=new WeakMap;var dr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new fa(e)}static forPath(e,t,r){if(e.length%2!==0)throw new R("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new xe(t._delegate,r,new U(e)))}static forKey(e,t,r){return new n(t,new xe(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new ma(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new ma(this.firestore,c0(this._delegate,e))}catch(t){throw Ot(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=Le(e),e instanceof xe?u0(this._delegate,e):!1}set(e,t){t=A0("DocumentReference.set",t);try{return t?y0(this._delegate,e,t):y0(this._delegate,e)}catch(r){throw Ot(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?v0(this._delegate,e):v0(this._delegate,e,t,...r)}catch(i){throw Ot(i,"updateDoc()","DocumentReference.update()")}}delete(){return QD(this._delegate)}onSnapshot(...e){let t=o1(e),r=a1(e,i=>new ws(this.firestore,new bn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return _0(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=jD(this._delegate):e?.source==="server"?t=WD(this._delegate):t=GD(this._delegate),t.then(r=>new ws(this.firestore,new bn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(pa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Ot(n,e,t){return n.message=n.message.replace(e,t),n}function o1(n){for(let e of n)if(typeof e=="object"&&!b0(e))return e;return{}}function a1(n,e){var t,r;let i;return b0(n[0])?i=n[0]:b0(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var ws=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new dr(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return g0(this._delegate,e._delegate)}},Ts=class extends ws{data(e){let t=this._delegate.data(e);return this._delegate._converter||uA(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},As=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new fa(e)}where(e,t,r){try{return new n(this.firestore,Rr(this._delegate,ND(e,t,r)))}catch(i){throw Ot(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,Rr(this._delegate,OD(e,t)))}catch(r){throw Ot(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,Rr(this._delegate,PD(e)))}catch(t){throw Ot(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,Rr(this._delegate,FD(e)))}catch(t){throw Ot(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,Rr(this._delegate,LD(...e)))}catch(t){throw Ot(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,Rr(this._delegate,BD(...e)))}catch(t){throw Ot(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,Rr(this._delegate,VD(...e)))}catch(t){throw Ot(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,Rr(this._delegate,qD(...e)))}catch(t){throw Ot(t,"endAt()","Query.endAt()")}}isEqual(e){return d0(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=KD(this._delegate):e?.source==="server"?t=$D(this._delegate):t=HD(this._delegate),t.then(r=>new uc(this.firestore,new Ln(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=o1(e),r=a1(e,i=>new uc(this.firestore,new Ln(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return _0(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(pa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},E0=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Ts(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},uc=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new As(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Ts(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new E0(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Ts(this._firestore,r))})}isEqual(e){return g0(this._delegate,e._delegate)}},ma=class n extends As{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new dr(this.firestore,e):null}doc(e){try{return e===void 0?new dr(this.firestore,cc(this._delegate)):new dr(this.firestore,cc(this._delegate,e))}catch(t){throw Ot(t,"doc()","CollectionReference.doc()")}}add(e){return YD(this._delegate,e).then(t=>new dr(this.firestore,t))}isEqual(e){return u0(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(pa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Es(n){return fe(n,xe)}var w0=class n{constructor(...e){this._delegate=new Fn(...e)}static documentId(){return new n(et.keyField().canonicalString())}isEqual(e){return e=Le(e),e instanceof Fn?this._delegate._internalPath.isEqual(e._internalPath):!1}};var T0=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=e1();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=ZD();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=t1(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=n1(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=r1(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var U6={Firestore:ef,GeoPoint:gs,Timestamp:Ve,Blob:Zh,Transaction:tf,WriteBatch:nf,DocumentReference:dr,DocumentSnapshot:ws,Query:As,QueryDocumentSnapshot:Ts,QuerySnapshot:uc,CollectionReference:ma,FieldPath:w0,FieldValue:T0,setLogLevel:q6,CACHE_SIZE_UNLIMITED:mD};function z6(n,e){n.INTERNAL.registerComponent(new Li("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},U6)))}function G6(n){z6(n,(e,t)=>new ef(e,t,new C0)),n.registerVersion(L6,B6,"node")}G6(en);function j6(n,e=bc){return new Rs(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function l1(n,e){return j6(n,e)}function W6(n,e){return l1(n,e).pipe(wc(void 0),Cc(),me(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function k0(n,e){return l1(n,e).pipe(me(t=>({payload:t,type:"query"})))}var rf=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=d1(r,t);return new of(i,s,this.afs)}snapshotChanges(){return W6(this.ref,this.afs.schedulers.outsideAngular).pipe(qt)}valueChanges(e={}){return this.snapshotChanges().pipe(me(({payload:t})=>e.idField?Jt(Z({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Bn(this.ref.get(e)).pipe(qt)}};function sf(n,e){return k0(n,e).pipe(wc(void 0),Cc(),me(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,l)=>{let c=s.find(d=>d.doc.ref.isEqual(a.ref)),u=r?.payload.docs.find(d=>d.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function c1(n,e,t){return sf(n,t).pipe(Ec((r,i)=>H6(r,i.map(s=>s.payload),e),[]),V0(),me(r=>r.map(i=>({type:i.type,payload:i}))))}function H6(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=K6(n,r))}),n}function I0(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function K6(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return I0(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return I0(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return I0(n,e.oldIndex,1);break}return n}function u1(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var of=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=sf(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(me(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(wc(void 0),Cc(),Ta(([r,i])=>i.length>0||!r),me(([,r])=>r),qt)}auditTrail(e){return this.stateChanges(e).pipe(Ec((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=u1(e);return c1(this.query,t,this.afs.schedulers.outsideAngular).pipe(qt)}valueChanges(e={}){return k0(this.query,this.afs.schedulers.outsideAngular).pipe(me(t=>t.payload.docs.map(r=>e.idField?Jt(Z({},r.data()),{[e.idField]:r.id}):r.data())),qt)}get(e){return Bn(this.query.get(e)).pipe(qt)}add(e){return this.ref.add(e)}doc(e){return new rf(this.ref.doc(e),this.afs)}},D0=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?sf(this.query,this.afs.schedulers.outsideAngular).pipe(qt):sf(this.query,this.afs.schedulers.outsideAngular).pipe(me(t=>t.filter(r=>e.indexOf(r.type)>-1)),Ta(t=>t.length>0),qt)}auditTrail(e){return this.stateChanges(e).pipe(Ec((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=u1(e);return c1(this.query,t,this.afs.schedulers.outsideAngular).pipe(qt)}valueChanges(e={}){return k0(this.query,this.afs.schedulers.outsideAngular).pipe(me(r=>r.payload.docs.map(i=>e.idField?Z({[e.idField]:i.id},i.data()):i.data())),qt)}get(e){return Bn(this.query.get(e)).pipe(qt)}},$6=new Ke("angularfire2.enableFirestorePersistence"),Q6=new Ke("angularfire2.firestore.persistenceSettings"),Y6=new Ke("angularfire2.firestore.settings"),J6=new Ke("angularfire2.firestore.use-emulator");function d1(n,e=t=>t){return{query:e(n),ref:n}}var Ht=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,l,c,u,d,f,v,w,A,T,O,D){this.schedulers=l;let P=Na(t,a,r),F=u;d&&jf(P,a,f,w,A,T,v,O),[this.firestore,this.persistenceEnabled$]=Bc(`${P.name}.firestore`,"AngularFirestore",P.name,()=>{let j=a.runOutsideAngular(()=>P.firestore());if(s&&j.settings(s),F&&j.useEmulator(...F),i&&!Rc(o)){let X=()=>{try{return Bn(j.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(S){return typeof console<"u"&&console.warn(S),Mr(!1)}};return[j,a.runOutsideAngular(X)]}else return[j,Mr(!1)]},[s,F,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=d1(i,r),a=this.schedulers.ngZone.run(()=>s);return new of(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new D0(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new rf(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(ee(Ns),ee(Os,8),ee($6,8),ee(Y6,8),ee(Ms),ee(Nr),ee(Pc),ee(Q6,8),ee(J6,8),ee(wS,8),ee(Bf,8),ee(Vf,8),ee(qf,8),ee(Uf,8),ee(zf,8),ee(Gf,8),ee(Bi,8))};static \u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var h1=(()=>{class n{constructor(t){this.db=t,this.dbPath="/header",this.headerRef=t.collection(this.dbPath)}getHeader(){return this.headerRef}updateHeader(t,r){return this.db.collection(this.dbPath).doc(t).update(r)}deleteHeader(t){return this.headerRef.doc(t).delete()}static{this.\u0275fac=function(r){return new(r||n)(ee(Ht))}}static{this.\u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var S1=(()=>{class n{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=i=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static{this.\u0275fac=function(r){return new(r||n)(ge(bf),ge(Sf))}}static{this.\u0275dir=hr({type:n})}}return n})(),Z6=(()=>{class n extends S1{static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=j0(n)))(i||n)}})()}static{this.\u0275dir=hr({type:n,features:[Fi]})}}return n})(),b1=new Ke("");var ez={provide:b1,useExisting:Ac(()=>At),multi:!0};function tz(){let n=Tf()?Tf().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var nz=new Ke(""),At=(()=>{class n extends S1{constructor(t,r,i){super(t,r),this._compositionMode=i,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!tz())}writeValue(t){let r=t??"";this.setProperty("value",r)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static{this.\u0275fac=function(r){return new(r||n)(ge(bf),ge(Sf),ge(nz,8))}}static{this.\u0275dir=hr({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,i){r&1&&ve("input",function(o){return i._handleInput(o.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(o){return i._compositionEnd(o.target.value)})},features:[kc([ez]),Fi]})}}return n})();var C1=new Ke(""),E1=new Ke("");function w1(n){return n!=null}function T1(n){return $0(n)?Bn(n):n}function A1(n){let e={};return n.forEach(t=>{e=t!=null?Z(Z({},e),t):e}),Object.keys(e).length===0?null:e}function I1(n,e){return e.map(t=>t(n))}function rz(n){return!n.validate}function D1(n){return n.map(e=>rz(e)?e:t=>e.validate(t))}function iz(n){if(!n)return null;let e=n.filter(w1);return e.length==0?null:function(t){return A1(I1(t,e))}}function x0(n){return n!=null?iz(D1(n)):null}function sz(n){if(!n)return null;let e=n.filter(w1);return e.length==0?null:function(t){let r=I1(t,e).map(T1);return L0(r).pipe(me(A1))}}function M0(n){return n!=null?sz(D1(n)):null}function f1(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function oz(n){return n._rawValidators}function az(n){return n._rawAsyncValidators}function R0(n){return n?Array.isArray(n)?n:[n]:[]}function lf(n,e){return Array.isArray(n)?n.includes(e):n===e}function p1(n,e){let t=R0(e);return R0(n).forEach(i=>{lf(t,i)||t.push(i)}),t}function m1(n,e){return R0(e).filter(t=>!lf(n,t))}var cf=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=x0(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=M0(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},va=class extends cf{get formDirective(){return null}get path(){return null}},gc=class extends cf{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},uf=class{constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},lz={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},KW=Jt(Z({},lz),{"[class.ng-submitted]":"isSubmitted"}),Kt=(()=>{class n extends uf{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(ge(gc,2))}}static{this.\u0275dir=hr({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,i){r&2&&Cf("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[Fi]})}}return n})(),$t=(()=>{class n extends uf{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(ge(va,10))}}static{this.\u0275dir=hr({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,i){r&2&&Cf("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},features:[Fi]})}}return n})();var dc="VALID",af="INVALID",ga="PENDING",hc="DISABLED",_a=class{},df=class extends _a{constructor(e,t){super(),this.value=e,this.source=t}},pc=class extends _a{constructor(e,t){super(),this.pristine=e,this.source=t}},mc=class extends _a{constructor(e,t){super(),this.touched=e,this.source=t}},ya=class extends _a{constructor(e,t){super(),this.status=e,this.source=t}};function k1(n){return(pf(n)?n.validators:n)||null}function cz(n){return Array.isArray(n)?x0(n):n||null}function R1(n,e){return(pf(e)?e.asyncValidators:n)||null}function uz(n){return Array.isArray(n)?M0(n):n||null}function pf(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function dz(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new Tc(1e3,"");if(!r[t])throw new Tc(1001,"")}function hz(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new Tc(1002,"")})}var hf=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=Da(()=>this.statusReactive()),this.statusReactive=Ia(void 0),this._pristine=Da(()=>this.pristineReactive()),this.pristineReactive=Ia(!0),this._touched=Da(()=>this.touchedReactive()),this.touchedReactive=Ia(!1),this._events=new Sc,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return Or(this.statusReactive)}set status(e){Or(()=>this.statusReactive.set(e))}get valid(){return this.status===dc}get invalid(){return this.status===af}get pending(){return this.status==ga}get disabled(){return this.status===hc}get enabled(){return this.status!==hc}get pristine(){return Or(this.pristineReactive)}set pristine(e){Or(()=>this.pristineReactive.set(e))}get dirty(){return!this.pristine}get touched(){return Or(this.touchedReactive)}set touched(e){Or(()=>this.touchedReactive.set(e))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(p1(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(p1(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(m1(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(m1(e,this._rawAsyncValidators))}hasValidator(e){return lf(this._rawValidators,e)}hasAsyncValidator(e){return lf(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(Jt(Z({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new mc(!0,r))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:r})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,r),t&&e.emitEvent!==!1&&this._events.next(new mc(!1,r))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(Jt(Z({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new pc(!1,r))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,r),t&&e.emitEvent!==!1&&this._events.next(new pc(!0,r))}markAsPending(e={}){this.status=ga;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new ya(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(Jt(Z({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=hc,this.errors=null,this._forEachChild(i=>{i.disable(Jt(Z({},e),{onlySelf:!0}))}),this._updateValue();let r=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new df(this.value,r)),this._events.next(new ya(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Jt(Z({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=dc,this._forEachChild(r=>{r.enable(Jt(Z({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Jt(Z({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===dc||this.status===ga)&&this._runAsyncValidator(r,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new df(this.value,t)),this._events.next(new ya(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(Jt(Z({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?hc:dc}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=ga,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1};let r=T1(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(i=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(i,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,r){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||r)&&this._events.next(new ya(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,r)}_initObservables(){this.valueChanges=new Aa,this.statusChanges=new Aa}_calculateStatus(){return this._allControlsDisabled()?hc:this.errors?af:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ga)?ga:this._anyControlsHaveStatus(af)?af:dc}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let r=!this._anyControlsDirty(),i=this.pristine!==r;this.pristine=r,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),i&&this._events.next(new pc(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new mc(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){pf(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=cz(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=uz(this._rawAsyncValidators)}},ff=class extends hf{constructor(e,t,r){super(k1(t),R1(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){hz(this,!0,e),Object.keys(e).forEach(r=>{dz(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var N0=new Ke("CallSetDisabledState",{providedIn:"root",factory:()=>O0}),O0="always";function fz(n,e){return[...e.path,n]}function x1(n,e,t=O0){M1(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),mz(n,e),yz(n,e),gz(n,e),pz(n,e)}function g1(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function pz(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function M1(n,e){let t=oz(n);e.validator!==null?n.setValidators(f1(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=az(n);e.asyncValidator!==null?n.setAsyncValidators(f1(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();g1(e._rawValidators,i),g1(e._rawAsyncValidators,i)}function mz(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&N1(n,e)})}function gz(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&N1(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function N1(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function yz(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function vz(n,e){n==null,M1(n,e)}function _z(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function Sz(n){return Object.getPrototypeOf(n.constructor)===Z6}function bz(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function Cz(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===At?t=s:Sz(s)?r=s:i=s}),i||r||t||null}var Ez={provide:va,useExisting:Ac(()=>Pt)},fc=Promise.resolve(),Pt=(()=>{class n extends va{get submitted(){return Or(this.submittedReactive)}constructor(t,r,i){super(),this.callSetDisabledState=i,this._submitted=Da(()=>this.submittedReactive()),this.submittedReactive=Ia(!1),this._directives=new Set,this.ngSubmit=new Aa,this.form=new ff({},x0(t),M0(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){fc.then(()=>{let r=this._findContainer(t.path);t.control=r.registerControl(t.name,t.control),x1(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){fc.then(()=>{let r=this._findContainer(t.path);r&&r.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){fc.then(()=>{let r=this._findContainer(t.path),i=new ff({});vz(i,t),r.registerControl(t.name,i),i.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){fc.then(()=>{let r=this._findContainer(t.path);r&&r.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,r){fc.then(()=>{this.form.get(t.path).setValue(r)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submittedReactive.set(!0),bz(this.form,this._directives),this.ngSubmit.emit(t),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static{this.\u0275fac=function(r){return new(r||n)(ge(C1,10),ge(E1,10),ge(N0,8))}}static{this.\u0275dir=hr({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,i){r&1&&ve("submit",function(o){return i.onSubmit(o)})("reset",function(){return i.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[kc([Ez]),Fi]})}}return n})();function y1(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function v1(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var wz=class extends hf{constructor(e=null,t,r){super(k1(t),R1(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),pf(t)&&(t.nonNullable||t.initialValueIsDefault)&&(v1(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){y1(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){y1(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){v1(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var Tz={provide:gc,useExisting:Ac(()=>Ft)},_1=Promise.resolve(),Ft=(()=>{class n extends gc{constructor(t,r,i,s,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this.control=new wz,this._registered=!1,this.name="",this.update=new Aa,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=Cz(this,s)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let r=t.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),_z(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){x1(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){_1.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let r=t.isDisabled.currentValue,i=r!==0&&Y0(r);_1.then(()=>{i&&!this.control.disabled?this.control.disable():!i&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?fz(t,this._parent):[t]}static{this.\u0275fac=function(r){return new(r||n)(ge(va,9),ge(C1,10),ge(E1,10),ge(b1,10),ge(Q0,8),ge(N0,8))}}static{this.\u0275dir=hr({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[kc([Tz]),Fi,G0]})}}return n})(),Qt=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275dir=hr({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return n})();var Az=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Zt({type:n})}static{this.\u0275inj=Xt({})}}return n})();var O1=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:N0,useValue:t.callSetDisabledState??O0}]}}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Zt({type:n})}static{this.\u0275inj=Xt({imports:[Az]})}}return n})();function Iz(n,e){if(n&1){let t=Bt();V(0,"div",12)(1,"p")(2,"strong"),se(3),L(),se(4),L(),V(5,"button",13),ve("click",function(){let i=$e(t).$implicit,s=Ye();return Qe(s.editarHeader(i))}),V(6,"span"),se(7,"\u270F\uFE0F Editar"),L()(),V(8,"button",14),ve("click",function(){let i=$e(t).$implicit,s=Ye();return Qe(s.deleteHeader(i.id))}),V(9,"span"),se(10,"\u{1F5D1}\uFE0F Eliminar"),L()()()}if(n&2){let t=e.$implicit;J(3),Ic(t.name),J(),Vn(" - ",t.goalLife,"")}}var P1=(()=>{class n{constructor(t){this.headerService=t,this.myHeader=new Nc,this.headerId="",this.header=[],this.btntxt="Agregar",this.selectedHeaderId=null,this.headerService.getHeader().snapshotChanges().pipe(me(r=>r.map(i=>Z({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.header=r})}actualizarHeader(){confirm("\xBFDeseas actualizar los datos del encabezado?")&&this.headerService.updateHeader(this.headerId,this.myHeader).then(()=>{alert("\xA1Header actualizado!")})}editarHeader(t){confirm("\xBFSeguro que deseas editar este registro?")&&(this.myHeader=Z({},t),this.selectedHeaderId=t.id,this.btntxt="Actualizar")}deleteHeader(t){t&&confirm("\xBFSeguro que deseas eliminar este header?")&&this.headerService.deleteHeader(t).then(()=>{console.log("Header eliminado correctamente")})}static{this.\u0275fac=function(r){return new(r||n)(ge(h1))}}static{this.\u0275cmp=St({type:n,selectors:[["app-admin-header"]],decls:24,vars:9,consts:[[1,"container","color-dark"],[1,"col"],[1,"container","color-light"],["type","text","placeholder","Full name","name","name",1,"txt",3,"ngModelChange","ngModel"],["type","text","placeholder","Life goal","name","goalLife",1,"txt",3,"ngModelChange","ngModel"],["type","text","placeholder","Photo URL","name","photoUrl",1,"txt",3,"ngModelChange","ngModel"],["type","text","placeholder","Email","name","email",1,"txt",3,"ngModelChange","ngModel"],["type","text","placeholder","Phone Number","name","phoneNumber",1,"txt",3,"ngModelChange","ngModel"],["type","text","placeholder","Location","name","location",1,"txt",3,"ngModelChange","ngModel"],["type","text","placeholder","Social Network","name","socialNetwork",1,"txt",3,"ngModelChange","ngModel"],["type","submit",1,"btn",3,"click","value"],["class","life-container",4,"ngFor","ngForOf"],[1,"life-container"],[1,"btn-icon",3,"click"],[1,"btn-icon","btn-danger",3,"click"]],template:function(r,i){r&1&&(V(0,"div",0)(1,"div",1)(2,"p"),se(3,"Header Settings"),L()()(),V(4,"div",2)(5,"div",1)(6,"form")(7,"input",3),be("ngModelChange",function(o){return Se(i.myHeader.name,o)||(i.myHeader.name=o),o}),L(),de(8,"br"),V(9,"input",4),be("ngModelChange",function(o){return Se(i.myHeader.goalLife,o)||(i.myHeader.goalLife=o),o}),L(),de(10,"br"),V(11,"input",5),be("ngModelChange",function(o){return Se(i.myHeader.photoUrl,o)||(i.myHeader.photoUrl=o),o}),L(),de(12,"br"),V(13,"input",6),be("ngModelChange",function(o){return Se(i.myHeader.email,o)||(i.myHeader.email=o),o}),L(),de(14,"br"),V(15,"input",7),be("ngModelChange",function(o){return Se(i.myHeader.phoneNumber,o)||(i.myHeader.phoneNumber=o),o}),L(),de(16,"br"),V(17,"input",8),be("ngModelChange",function(o){return Se(i.myHeader.location,o)||(i.myHeader.location=o),o}),L(),de(18,"br"),V(19,"input",9),be("ngModelChange",function(o){return Se(i.myHeader.socialNetwork,o)||(i.myHeader.socialNetwork=o),o}),L(),de(20,"br"),V(21,"input",10),ve("click",function(){return i.actualizarHeader()}),L()()(),V(22,"div",1),Lt(23,Iz,11,2,"div",11),L()()),r&2&&(J(7),_e("ngModel",i.myHeader.name),J(2),_e("ngModel",i.myHeader.goalLife),J(2),_e("ngModel",i.myHeader.photoUrl),J(2),_e("ngModel",i.myHeader.email),J(2),_e("ngModel",i.myHeader.phoneNumber),J(2),_e("ngModel",i.myHeader.location),J(2),_e("ngModel",i.myHeader.socialNetwork),J(2),ct("value",i.btntxt),J(2),ct("ngForOf",i.header))},dependencies:[Vt,Qt,At,Kt,$t,Ft,Pt],styles:[".container[_ngcontent-%COMP%]{border-radius:10px;margin:20px auto;padding:20px;max-width:900px}.color-dark[_ngcontent-%COMP%]{background-color:#0d1117;color:#fff;font-weight:700;font-size:1.2rem;box-shadow:0 4px 10px #0000004d}.color-light[_ngcontent-%COMP%]{background-color:#1f2937;color:#fff;box-shadow:0 4px 10px #0000004d}.txt[_ngcontent-%COMP%]{width:100%;margin-bottom:10px;padding:10px;border-radius:6px;border:none;font-size:1rem}.btn[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff;padding:10px 16px;font-weight:700;border:none;border-radius:6px;cursor:pointer}.btn[_ngcontent-%COMP%]:hover{background-color:#2563eb}.life-container[_ngcontent-%COMP%]{background-color:#374151;padding:15px;margin-bottom:10px;border-radius:6px}.btn-icon[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff;border:none;padding:6px 10px;margin-right:10px;border-radius:6px;cursor:pointer}.btn-icon[_ngcontent-%COMP%]:hover{background-color:#2563eb}.btn-danger[_ngcontent-%COMP%]{background-color:#ef4444}.btn-danger[_ngcontent-%COMP%]:hover{background-color:#dc2626}"]})}}return n})();var ba=class{constructor(){this.accomplishments="",this.company="",this.endDate="",this.location="",this.position=""}};var F1=(()=>{class n{constructor(t){this.db=t,this.dbPath="/work-experience",this.workExperienceRef=t.collection(this.dbPath)}getWorkExperience(){return this.workExperienceRef}createWorkExperience(t){return this.workExperienceRef.add(Z({},t))}deleteWorkExperience(t){return this.workExperienceRef.doc(t).delete()}updateWorkExperience(t,r){return this.workExperienceRef.doc(t).update(r)}static{this.\u0275fac=function(r){return new(r||n)(ee(Ht))}}static{this.\u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function kz(n,e){if(n&1){let t=Bt();V(0,"div",11)(1,"p"),se(2),L(),V(3,"input",12),ve("click",function(){let i=$e(t).$implicit,s=Ye();return Qe(s.deleteJob(i.id))}),L(),V(4,"input",13),ve("click",function(){let i=$e(t).$implicit,s=Ye();return Qe(s.EditarJob(i))}),L()()}if(n&2){let t=e.$implicit;J(2),Dc(" ",t.company," - ",t.position," ")}}var L1=(()=>{class n{constructor(t){this.workExperienceService=t,this.itemCount=0,this.btntxt="Agregar",this.goalText="",this.workExperience=[],this.myWorkExperience=new ba,this.selectedJobId=null,console.log(this.workExperienceService),this.workExperienceService.getWorkExperience().snapshotChanges().pipe(me(r=>r.map(i=>Z({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.workExperience=r,console.log(this.workExperience)})}AgregarJob(){this.selectedJobId?this.workExperienceService.updateWorkExperience(this.selectedJobId,this.myWorkExperience).then(()=>{console.log("Updated item successfully!"),this.selectedJobId=null,this.btntxt="Agregar",this.myWorkExperience=new ba}):this.workExperienceService.createWorkExperience(this.myWorkExperience).then(()=>{console.log("Created new item successfully!"),this.myWorkExperience=new ba})}EditarJob(t){confirm(`\xBFEst\xE1s seguro de que quieres editar este registro de ${t.company}?`)&&(this.myWorkExperience=Z({},t),this.btntxt="Actualizar")}deleteJob(t){confirm("\xBFEst\xE1s seguro de que deseas eliminar este registro? Esta acci\xF3n no se puede deshacer.")&&t&&this.workExperienceService.deleteWorkExperience(t).then(()=>{console.log("Registro eliminado correctamente")})}static{this.\u0275fac=function(r){return new(r||n)(ge(F1))}}static{this.\u0275cmp=St({type:n,selectors:[["app-admin-workexperience"]],decls:23,vars:8,consts:[[1,"container","color-dark"],[1,"col"],[1,"container","color-light"],["type","text","name","startDate","placeholder","start date (mm/yyyy)",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","endDate","placeholder","end date (mm/yyyy)",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","location","placeholder","location (city, country)",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","position","placeholder","position",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","company","placeholder","company",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","accomplishments","placeholder","accomplishments",1,"txt",3,"ngModelChange","ngModel"],["type","submit",1,"btn"],["class","life-container",4,"ngFor","ngForOf"],[1,"life-container"],["type","submit","value","\u{1F5D1}\uFE0F Delete",1,"btn",3,"click"],["type","submit","value","\u270F\uFE0F Edit",1,"btn",3,"click"]],template:function(r,i){r&1&&(V(0,"div",0)(1,"div",1)(2,"p"),se(3,"Work experience items"),L()()(),V(4,"div",2)(5,"div",1)(6,"form")(7,"input",3),be("ngModelChange",function(o){return Se(i.myWorkExperience.startDate,o)||(i.myWorkExperience.startDate=o),o}),L(),de(8,"br"),V(9,"input",4),be("ngModelChange",function(o){return Se(i.myWorkExperience.endDate,o)||(i.myWorkExperience.endDate=o),o}),L(),de(10,"br"),V(11,"input",5),be("ngModelChange",function(o){return Se(i.myWorkExperience.location,o)||(i.myWorkExperience.location=o),o}),L(),de(12,"br"),V(13,"input",6),be("ngModelChange",function(o){return Se(i.myWorkExperience.position,o)||(i.myWorkExperience.position=o),o}),L(),de(14,"br"),V(15,"input",7),be("ngModelChange",function(o){return Se(i.myWorkExperience.company,o)||(i.myWorkExperience.company=o),o}),L(),de(16,"br"),V(17,"input",8),be("ngModelChange",function(o){return Se(i.myWorkExperience.accomplishments,o)||(i.myWorkExperience.accomplishments=o),o}),L(),de(18,"br"),V(19,"button",9),se(20),L()()(),V(21,"div",1),Lt(22,kz,5,2,"div",10),L()()),r&2&&(J(7),_e("ngModel",i.myWorkExperience.startDate),J(2),_e("ngModel",i.myWorkExperience.endDate),J(2),_e("ngModel",i.myWorkExperience.location),J(2),_e("ngModel",i.myWorkExperience.position),J(2),_e("ngModel",i.myWorkExperience.company),J(2),_e("ngModel",i.myWorkExperience.accomplishments),J(3),Ic(i.btntxt),J(2),ct("ngForOf",i.workExperience))},dependencies:[Vt,Qt,At,Kt,$t,Ft,Pt],styles:[".container[_ngcontent-%COMP%]{padding:20px;border-radius:10px;background-color:#1f2937;box-shadow:0 4px 12px #00000080;margin-bottom:20px}.color-dark[_ngcontent-%COMP%]{background-color:#111827;color:#fff;font-weight:700}.color-light[_ngcontent-%COMP%]{background-color:#1f2937}input.txt[_ngcontent-%COMP%]{width:100%;padding:10px;margin-bottom:10px;border-radius:8px;border:none;font-size:14px}input.btn[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff;padding:8px 16px;border:none;border-radius:6px;font-weight:700;cursor:pointer;margin-right:5px}input.btn[_ngcontent-%COMP%]:hover{background-color:#2563eb}.life-container[_ngcontent-%COMP%]{padding:10px;margin-top:10px;background-color:#374151;border-radius:8px;color:#f3f4f6}"]})}}return n})();var yc=class{constructor(){this.School="",this.Training="",this.licenses=""}};var B1=(()=>{class n{constructor(t){this.db=t,this.dbPath="/education",this.educationRef=t.collection(this.dbPath)}getEducation(){return this.educationRef}createEducation(t){return this.educationRef.add(Z({},t))}deleteEducation(t){return this.educationRef.doc(t).delete()}updateEducation(t,r){return this.educationRef.doc(t).update(r)}static{this.\u0275fac=function(r){return new(r||n)(ee(Ht))}}static{this.\u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function xz(n,e){if(n&1){let t=Bt();V(0,"p",8)(1,"input",9),ve("click",function(){let i=$e(t).$implicit,s=Ye();return Qe(s.deleteEducation(i.id))}),L(),V(2,"input",10),ve("click",function(){let i=$e(t).$implicit,s=Ye();return Qe(s.EditarEdu(i))}),L(),se(3),L()}if(n&2){let t=e.$implicit;J(3),H0(" ",t.School," - ",t.Training," - ",t.licenses," ")}}var V1=(()=>{class n{constructor(t){this.educationService=t,this.btntxt="Agregar",this.education=[],this.myEducation=new yc,this.selectedEduId=null,this.educationService.getEducation().snapshotChanges().pipe(me(r=>r.map(i=>Z({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.education=r})}AgregarEdu(){this.selectedEduId?confirm("\xBFEst\xE1s seguro que quieres editar esta entrada de educaci\xF3n?")&&this.educationService.updateEducation(this.selectedEduId,this.myEducation).then(()=>{console.log("Item actualizado correctamente"),this.resetForm()}):this.educationService.createEducation(this.myEducation).then(()=>{console.log("Item agregado correctamente"),this.resetForm()})}deleteEducation(t){confirm("\xBFEst\xE1s seguro que deseas eliminar esta entrada?")&&this.educationService.deleteEducation(t).then(()=>{console.log("Item eliminado correctamente")})}EditarEdu(t){this.myEducation=Z({},t),this.selectedEduId=t.id??null,this.btntxt="Actualizar"}resetForm(){this.myEducation=new yc,this.selectedEduId=null,this.btntxt="Agregar"}static{this.\u0275fac=function(r){return new(r||n)(ge(B1))}}static{this.\u0275cmp=St({type:n,selectors:[["app-admin-education"]],decls:16,vars:5,consts:[[1,"container","color-dark"],[1,"col"],[1,"container","color-light"],["type","text","name","School","placeholder","School",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","Training","placeholder","Training",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","licenses","placeholder","Licenses",1,"txt",3,"ngModelChange","ngModel"],["type","submit",1,"btn",3,"click","value"],["class","life-container",4,"ngFor","ngForOf"],[1,"life-container"],["type","submit","value","Eliminar",1,"btn",3,"click"],["type","submit","value","Editar",1,"btn",3,"click"]],template:function(r,i){r&1&&(V(0,"div",0)(1,"div",1)(2,"p"),se(3," Education items "),L()()(),V(4,"div",2)(5,"div",1)(6,"form")(7,"input",3),be("ngModelChange",function(o){return Se(i.myEducation.School,o)||(i.myEducation.School=o),o}),L(),de(8,"br"),V(9,"input",4),be("ngModelChange",function(o){return Se(i.myEducation.Training,o)||(i.myEducation.Training=o),o}),L(),de(10,"br"),V(11,"input",5),be("ngModelChange",function(o){return Se(i.myEducation.licenses,o)||(i.myEducation.licenses=o),o}),L(),de(12,"br"),V(13,"input",6),ve("click",function(){return i.AgregarEdu()}),L()()(),V(14,"div",1),Lt(15,xz,4,3,"p",7),L()()),r&2&&(J(7),_e("ngModel",i.myEducation.School),J(2),_e("ngModel",i.myEducation.Training),J(2),_e("ngModel",i.myEducation.licenses),J(2),ct("value",i.btntxt),J(2),ct("ngForOf",i.education))},dependencies:[Vt,Qt,At,Kt,$t,Ft,Pt],styles:[".container[_ngcontent-%COMP%]{padding:20px;border-radius:10px;background-color:#1f2937;box-shadow:0 4px 12px #00000080;margin-bottom:20px}.color-dark[_ngcontent-%COMP%]{background-color:#111827;color:#fff;font-weight:700}.color-light[_ngcontent-%COMP%]{background-color:#1f2937}input.txt[_ngcontent-%COMP%]{width:100%;padding:10px;margin-bottom:10px;border-radius:8px;border:none;font-size:14px}input.btn[_ngcontent-%COMP%]{background-color:#10b981;color:#fff;padding:8px 16px;border:none;border-radius:6px;font-weight:700;cursor:pointer;margin-right:5px}input.btn[_ngcontent-%COMP%]:hover{background-color:#059669}.life-container[_ngcontent-%COMP%]{padding:10px;margin-top:10px;background-color:#374151;border-radius:8px;color:#f3f4f6}"]})}}return n})();var vc=class{constructor(){this.certification="",this.Institution=""}};var q1=(()=>{class n{constructor(t){this.db=t,this.dbPath="/certificates",this.certificatesRef=t.collection(this.dbPath)}getCertificates(){return this.certificatesRef}createCertificate(t){return this.certificatesRef.add(Z({},t))}deleteCertificate(t){return this.certificatesRef.doc(t).delete()}updateCertificate(t,r){return this.certificatesRef.doc(t).update(r)}static{this.\u0275fac=function(r){return new(r||n)(ee(Ht))}}static{this.\u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Nz(n,e){if(n&1){let t=Bt();V(0,"p",7)(1,"input",8),ve("click",function(){let i=$e(t).$implicit,s=Ye();return Qe(s.deleteCertificate(i.id))}),L(),V(2,"input",9),ve("click",function(){let i=$e(t).$implicit,s=Ye();return Qe(s.EditarCertificate(i))}),L(),se(3),L()}if(n&2){let t=e.$implicit;J(3),Dc(" ",t.certification," - ",t.Institution," ")}}var U1=(()=>{class n{constructor(t){this.certificatesService=t,this.btntxt="Agregar",this.certificates=[],this.myCertificate=new vc,this.selectedCertificateId=null,this.certificatesService.getCertificates().snapshotChanges().pipe(me(r=>r.map(i=>Z({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.certificates=r})}AgregarCertificate(){this.selectedCertificateId?confirm("\xBFDeseas actualizar este certificado?")&&this.certificatesService.updateCertificate(this.selectedCertificateId,this.myCertificate).then(()=>{this.resetForm()}):confirm("\xBFDeseas agregar este certificado?")&&this.certificatesService.createCertificate(this.myCertificate).then(()=>{this.resetForm()})}deleteCertificate(t){confirm("\xBFSeguro que deseas eliminar este certificado?")&&this.certificatesService.deleteCertificate(t).then(()=>{console.log("Certificado eliminado correctamente")})}EditarCertificate(t){this.myCertificate=Z({},t),this.selectedCertificateId=t.id??null,this.btntxt="Editar"}resetForm(){this.myCertificate=new vc,this.selectedCertificateId=null,this.btntxt="Agregar"}static{this.\u0275fac=function(r){return new(r||n)(ge(q1))}}static{this.\u0275cmp=St({type:n,selectors:[["app-admin-certificates"]],decls:14,vars:4,consts:[[1,"container","color-dark"],[1,"col"],[1,"container","color-light"],["type","text","name","certificateName","placeholder","Certificate name",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","institution","placeholder","Institution",1,"txt",3,"ngModelChange","ngModel"],["type","submit",1,"btn",3,"click","value"],["class","life-container",4,"ngFor","ngForOf"],[1,"life-container"],["type","submit","value","delete",1,"btn",3,"click"],["type","submit","value","edit",1,"btn",3,"click"]],template:function(r,i){r&1&&(V(0,"div",0)(1,"div",1)(2,"p"),se(3,"Certificates"),L()()(),V(4,"div",2)(5,"div",1)(6,"form")(7,"input",3),be("ngModelChange",function(o){return Se(i.myCertificate.certification,o)||(i.myCertificate.certification=o),o}),L(),de(8,"br"),V(9,"input",4),be("ngModelChange",function(o){return Se(i.myCertificate.Institution,o)||(i.myCertificate.Institution=o),o}),L(),de(10,"br"),V(11,"input",5),ve("click",function(){return i.AgregarCertificate()}),L()()(),V(12,"div",1),Lt(13,Nz,4,2,"p",6),L()()),r&2&&(J(7),_e("ngModel",i.myCertificate.certification),J(2),_e("ngModel",i.myCertificate.Institution),J(2),W0("value",i.btntxt),J(2),ct("ngForOf",i.certificates))},dependencies:[Vt,Qt,At,Kt,$t,Ft,Pt],styles:[".container[_ngcontent-%COMP%]{padding:20px;border-radius:10px;background-color:#1f2937;box-shadow:0 4px 12px #00000080;margin-bottom:20px}.color-dark[_ngcontent-%COMP%]{background-color:#111827;color:#fff;font-weight:700}.color-light[_ngcontent-%COMP%]{background-color:#1f2937}input.txt[_ngcontent-%COMP%]{width:100%;padding:10px;margin-bottom:10px;border-radius:8px;border:none;font-size:14px}input.btn[_ngcontent-%COMP%]{background-color:#f59e0b;color:#fff;padding:8px 16px;border:none;border-radius:6px;font-weight:700;cursor:pointer;margin-right:5px}input.btn[_ngcontent-%COMP%]:hover{background-color:#d97706}.life-container[_ngcontent-%COMP%]{padding:10px;margin-top:10px;background-color:#374151;border-radius:8px;color:#f3f4f6}"]})}}return n})();var Ca=class{constructor(){this.lenguajes="",this.tecnologias=""}};var z1=(()=>{class n{constructor(t){this.db=t,this.dbPath="/Skills",this.skillsRef=t.collection(this.dbPath)}getSkills(){return this.skillsRef}createSkill(t){return this.skillsRef.add(Z({},t))}updateSkill(t,r){return this.skillsRef.doc(t).update(r)}deleteSkill(t){return this.skillsRef.doc(t).delete()}static{this.\u0275fac=function(r){return new(r||n)(ee(Ht))}}static{this.\u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Pz(n,e){if(n&1){let t=Bt();V(0,"p",7)(1,"input",8),ve("click",function(){let i=$e(t).$implicit,s=Ye();return Qe(s.editarSkill(i))}),L(),V(2,"input",9),ve("click",function(){let i=$e(t).$implicit,s=Ye();return Qe(s.deleteSkill(i.id))}),L(),de(3,"br"),V(4,"strong"),se(5,"Lenguajes:"),L(),se(6),de(7,"br"),V(8,"strong"),se(9,"Tecnolog\xEDas:"),L(),se(10),L()}if(n&2){let t=e.$implicit;J(6),Vn(" ",t.lenguajes," "),J(4),Vn(" ",t.tecnologias," ")}}var G1=(()=>{class n{constructor(t){this.skillsService=t,this.skills=[],this.mySkill=new Ca,this.selectedSkillId=null,this.btntxt="Agregar",this.skillsService.getSkills().snapshotChanges().pipe(me(r=>r.map(i=>Z({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.skills=r})}agregarSkill(){this.selectedSkillId?confirm("\xBFDeseas editar esta habilidad?")&&this.skillsService.updateSkill(this.selectedSkillId,this.mySkill).then(()=>{this.mySkill=new Ca,this.btntxt="Agregar",this.selectedSkillId=null}):this.skillsService.createSkill(this.mySkill).then(()=>{this.mySkill=new Ca})}editarSkill(t){confirm("\xBFDeseas cargar esta habilidad para editar?")&&(this.mySkill=Z({},t),this.selectedSkillId=t.id,this.btntxt="Editar")}deleteSkill(t){confirm("\xBFDeseas eliminar esta habilidad?")&&this.skillsService.deleteSkill(t)}static{this.\u0275fac=function(r){return new(r||n)(ge(z1))}}static{this.\u0275cmp=St({type:n,selectors:[["app-admin-skills"]],decls:12,vars:4,consts:[[1,"container","color-dark"],[1,"col"],[1,"container","color-light"],["type","text","placeholder","Lenguajes","name","lenguajes",1,"txt",3,"ngModelChange","ngModel"],["type","text","placeholder","Tecnolog\xEDas","name","tecnologias",1,"txt",3,"ngModelChange","ngModel"],["type","submit",1,"btn",3,"click","value"],["class","life-container",4,"ngFor","ngForOf"],[1,"life-container"],["type","submit","value","Editar",1,"btn",3,"click"],["type","submit","value","Eliminar",1,"btn",3,"click"]],template:function(r,i){r&1&&(V(0,"div",0)(1,"div",1)(2,"p"),se(3,"Skills"),L()()(),V(4,"div",2)(5,"div",1)(6,"form")(7,"input",3),be("ngModelChange",function(o){return Se(i.mySkill.lenguajes,o)||(i.mySkill.lenguajes=o),o}),L(),V(8,"input",4),be("ngModelChange",function(o){return Se(i.mySkill.tecnologias,o)||(i.mySkill.tecnologias=o),o}),L(),V(9,"input",5),ve("click",function(){return i.agregarSkill()}),L()()(),V(10,"div",1),Lt(11,Pz,11,2,"p",6),L()()),r&2&&(J(7),_e("ngModel",i.mySkill.lenguajes),J(),_e("ngModel",i.mySkill.tecnologias),J(),ct("value",i.btntxt),J(2),ct("ngForOf",i.skills))},dependencies:[Vt,Qt,At,Kt,$t,Ft,Pt],styles:[".container[_ngcontent-%COMP%]{padding:20px;border-radius:10px;background-color:#1f2937;box-shadow:0 4px 12px #00000080;margin-bottom:20px}.color-dark[_ngcontent-%COMP%]{background-color:#111827;color:#fff;font-weight:700}.color-light[_ngcontent-%COMP%]{background-color:#1f2937}input.txt[_ngcontent-%COMP%]{width:100%;padding:10px;margin-bottom:10px;border-radius:8px;border:none;font-size:14px}input.btn[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff;padding:8px 16px;border:none;border-radius:6px;font-weight:700;cursor:pointer;margin-right:5px}input.btn[_ngcontent-%COMP%]:hover{background-color:#2563eb}.life-container[_ngcontent-%COMP%]{padding:10px;margin-top:10px;background-color:#374151;border-radius:8px;color:#f3f4f6}"]})}}return n})();var Ea=class{constructor(){this.idiomas="",this.nivel=""}};var j1=(()=>{class n{constructor(t){this.db=t,this.dbPath="/Languages",this.languagesRef=t.collection(this.dbPath)}getLanguages(){return this.languagesRef}createLanguage(t){return this.languagesRef.add(Z({},t))}updateLanguage(t,r){return this.languagesRef.doc(t).update(r)}deleteLanguage(t){return this.languagesRef.doc(t).delete()}static{this.\u0275fac=function(r){return new(r||n)(ee(Ht))}}static{this.\u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Lz(n,e){if(n&1){let t=Bt();V(0,"p",7)(1,"input",8),ve("click",function(){let i=$e(t).$implicit,s=Ye();return Qe(s.editarLanguage(i))}),L(),V(2,"input",9),ve("click",function(){let i=$e(t).$implicit,s=Ye();return Qe(s.deleteLanguage(i.id))}),L(),de(3,"br"),V(4,"strong"),se(5,"Idioma:"),L(),se(6),de(7,"br"),V(8,"strong"),se(9,"Nivel:"),L(),se(10),L()}if(n&2){let t=e.$implicit;J(6),Vn(" ",t.idiomas," "),J(4),Vn(" ",t.nivel," ")}}var W1=(()=>{class n{constructor(t){this.languagesService=t,this.languages=[],this.myLanguage=new Ea,this.selectedLangId=null,this.btntxt="Agregar",this.languagesService.getLanguages().snapshotChanges().pipe(me(r=>r.map(i=>Z({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.languages=r})}agregarLanguage(){this.selectedLangId?confirm("\xBFDeseas editar este idioma?")&&this.languagesService.updateLanguage(this.selectedLangId,this.myLanguage).then(()=>{this.myLanguage=new Ea,this.btntxt="Agregar",this.selectedLangId=null}):this.languagesService.createLanguage(this.myLanguage).then(()=>{this.myLanguage=new Ea})}editarLanguage(t){confirm("\xBFDeseas cargar este idioma para editar?")&&(this.myLanguage=Z({},t),this.selectedLangId=t.id,this.btntxt="Editar")}deleteLanguage(t){confirm("\xBFDeseas eliminar este idioma?")&&this.languagesService.deleteLanguage(t)}static{this.\u0275fac=function(r){return new(r||n)(ge(j1))}}static{this.\u0275cmp=St({type:n,selectors:[["app-admin-languages"]],decls:12,vars:4,consts:[[1,"container","color-dark"],[1,"col"],[1,"container","color-light"],["type","text","placeholder","Idioma","name","idiomas",1,"txt",3,"ngModelChange","ngModel"],["type","text","placeholder","Nivel","name","nivel",1,"txt",3,"ngModelChange","ngModel"],["type","submit",1,"btn",3,"click","value"],["class","life-container",4,"ngFor","ngForOf"],[1,"life-container"],["type","submit","value","Editar",1,"btn",3,"click"],["type","submit","value","Eliminar",1,"btn",3,"click"]],template:function(r,i){r&1&&(V(0,"div",0)(1,"div",1)(2,"p"),se(3,"Languages"),L()()(),V(4,"div",2)(5,"div",1)(6,"form")(7,"input",3),be("ngModelChange",function(o){return Se(i.myLanguage.idiomas,o)||(i.myLanguage.idiomas=o),o}),L(),V(8,"input",4),be("ngModelChange",function(o){return Se(i.myLanguage.nivel,o)||(i.myLanguage.nivel=o),o}),L(),V(9,"input",5),ve("click",function(){return i.agregarLanguage()}),L()()(),V(10,"div",1),Lt(11,Lz,11,2,"p",6),L()()),r&2&&(J(7),_e("ngModel",i.myLanguage.idiomas),J(),_e("ngModel",i.myLanguage.nivel),J(),ct("value",i.btntxt),J(2),ct("ngForOf",i.languages))},dependencies:[Vt,Qt,At,Kt,$t,Ft,Pt],styles:[".container[_ngcontent-%COMP%]{padding:20px;border-radius:10px;background-color:#1f2937;box-shadow:0 4px 12px #00000080;margin-bottom:20px}.color-dark[_ngcontent-%COMP%]{background-color:#111827;color:#fff;font-weight:700}.color-light[_ngcontent-%COMP%]{background-color:#1f2937}input.txt[_ngcontent-%COMP%]{width:100%;padding:10px;margin-bottom:10px;border-radius:8px;border:none;font-size:14px}input.btn[_ngcontent-%COMP%]{background-color:#8b5cf6;color:#fff;padding:8px 16px;border:none;border-radius:6px;font-weight:700;cursor:pointer;margin-right:5px}input.btn[_ngcontent-%COMP%]:hover{background-color:#7c3aed}.life-container[_ngcontent-%COMP%]{padding:10px;margin-top:10px;background-color:#374151;border-radius:8px;color:#f3f4f6}"]})}}return n})();var wa=class{constructor(){this.interes=""}};var H1=(()=>{class n{constructor(t){this.db=t,this.dbPath="/Interests",this.interestsRef=t.collection(this.dbPath)}getInterests(){return this.interestsRef}createInterest(t){return this.interestsRef.add(Z({},t))}updateInterest(t,r){return this.interestsRef.doc(t).update(r)}deleteInterest(t){return this.interestsRef.doc(t).delete()}static{this.\u0275fac=function(r){return new(r||n)(ee(Ht))}}static{this.\u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Vz(n,e){if(n&1){let t=Bt();V(0,"p",6)(1,"input",7),ve("click",function(){let i=$e(t).$implicit,s=Ye();return Qe(s.editarInterest(i))}),L(),V(2,"input",8),ve("click",function(){let i=$e(t).$implicit,s=Ye();return Qe(s.deleteInterest(i.id))}),L(),de(3,"br"),se(4),L()}if(n&2){let t=e.$implicit;J(4),Vn(" ",t.interes," ")}}var K1=(()=>{class n{constructor(t){this.interestsService=t,this.interests=[],this.myInterest=new wa,this.selectedInterestId=null,this.btntxt="Agregar",this.interestsService.getInterests().snapshotChanges().pipe(me(r=>r.map(i=>Z({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.interests=r})}agregarInterest(){this.selectedInterestId?confirm("\xBFDeseas editar este inter\xE9s?")&&this.interestsService.updateInterest(this.selectedInterestId,this.myInterest).then(()=>{this.myInterest=new wa,this.btntxt="Agregar",this.selectedInterestId=null}):this.interestsService.createInterest(this.myInterest).then(()=>{this.myInterest=new wa})}editarInterest(t){confirm("\xBFDeseas cargar este inter\xE9s para editar?")&&(this.myInterest=Z({},t),this.selectedInterestId=t.id,this.btntxt="Editar")}deleteInterest(t){confirm("\xBFDeseas eliminar este inter\xE9s?")&&this.interestsService.deleteInterest(t)}static{this.\u0275fac=function(r){return new(r||n)(ge(H1))}}static{this.\u0275cmp=St({type:n,selectors:[["app-admin-interests"]],decls:12,vars:3,consts:[[1,"container","color-dark"],[1,"col"],[1,"container","color-light"],["rows","5","cols","40","placeholder","Describe tu inter\xE9s","name","interes",1,"txt",3,"ngModelChange","ngModel"],["type","submit",1,"btn",3,"click","value"],["class","life-container",4,"ngFor","ngForOf"],[1,"life-container"],["type","submit","value","Editar",1,"btn",3,"click"],["type","submit","value","Eliminar",1,"btn",3,"click"]],template:function(r,i){r&1&&(V(0,"div",0)(1,"div",1)(2,"p"),se(3,"Interests"),L()()(),V(4,"div",2)(5,"div",1)(6,"form")(7,"textarea",3),be("ngModelChange",function(o){return Se(i.myInterest.interes,o)||(i.myInterest.interes=o),o}),L(),de(8,"br"),V(9,"input",4),ve("click",function(){return i.agregarInterest()}),L()()(),V(10,"div",1),Lt(11,Vz,5,1,"p",5),L()()),r&2&&(J(7),_e("ngModel",i.myInterest.interes),J(2),ct("value",i.btntxt),J(2),ct("ngForOf",i.interests))},dependencies:[Vt,Qt,At,Kt,$t,Ft,Pt],styles:[".container[_ngcontent-%COMP%]{padding:20px;border-radius:10px;background-color:#1f2937;box-shadow:0 4px 12px #00000080;margin-bottom:20px}.color-dark[_ngcontent-%COMP%]{background-color:#111827;color:#fff;font-weight:700}.color-light[_ngcontent-%COMP%]{background-color:#1f2937}textarea.txt[_ngcontent-%COMP%]{width:100%;padding:10px;margin-bottom:10px;border-radius:8px;border:none;font-size:14px;resize:vertical}input.btn[_ngcontent-%COMP%]{background-color:#ec4899;color:#fff;padding:8px 16px;border:none;border-radius:6px;font-weight:700;cursor:pointer;margin-right:5px}input.btn[_ngcontent-%COMP%]:hover{background-color:#db2777}.life-container[_ngcontent-%COMP%]{padding:10px;margin-top:10px;background-color:#374151;border-radius:8px;color:#f3f4f6}"]})}}return n})();var qz=[{path:"header",component:P1},{path:"workexperience",component:L1},{path:"education",component:V1},{path:"certificates",component:U1},{path:"skills",component:G1},{path:"languages",component:W1},{path:"interests",component:K1}],$1=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Zt({type:n})}static{this.\u0275inj=Xt({imports:[Af.forRoot(qz),Af]})}}return n})();var mf=(()=>{class n{constructor(){this.title="admin-cv"}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=St({type:n,selectors:[["app-root"]],decls:27,vars:0,consts:[["routerLink","/header"],["routerLink","/workexperience"],["routerLink","/education"],["routerLink","/certificates"],["routerLink","/skills"],["routerLink","/languages"],["routerLink","/interests"]],template:function(r,i){r&1&&(V(0,"h3")(1,"b"),se(2," admin-Cv App"),L()(),V(3,"nav")(4,"ul")(5,"li")(6,"a",0),se(7," Header "),L()(),V(8,"li")(9,"a",1),se(10," Work-experience "),L()(),V(11,"li")(12,"a",2),se(13," Education "),L()(),V(14,"li")(15,"a",3),se(16," Certificates "),L()(),V(17,"li")(18,"a",4),se(19," Skills "),L()(),V(20,"li")(21,"a",5),se(22," Languages "),L()(),V(23,"li")(24,"a",6),se(25," Interests "),L()()()(),de(26,"router-outlet"))},dependencies:[eS,tS],styles:["body[_ngcontent-%COMP%]{margin:0;padding:0;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;background-color:#0d1117;color:#e6edf3;min-height:100vh;overflow-x:hidden}.admin-container[_ngcontent-%COMP%]{width:100%;max-width:1200px;margin:0 auto;padding:40px 20px;display:flex;flex-direction:column;gap:40px;box-sizing:border-box}.admin-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.3rem;color:#f3f4f6;margin-bottom:12px;font-weight:600}form[_ngcontent-%COMP%]{display:flex;flex-direction:column}input.txt[_ngcontent-%COMP%], textarea.txt[_ngcontent-%COMP%]{font-size:14px;margin-bottom:10px}@media (max-width: 768px){.admin-container[_ngcontent-%COMP%]{padding:20px}input.txt[_ngcontent-%COMP%], textarea.txt[_ngcontent-%COMP%]{font-size:13px}input.btn[_ngcontent-%COMP%]{width:100%;margin-bottom:10px}}"]})}}return n})();var Q1={production:!1,firebaseConfig:{apiKey:"AIzaSyDVK1bPp6ndWzmsuQ9tXw7hp0VXVj5AWwY",authDomain:"my-cv-jeshuabenitez.firebaseapp.com",projectId:"my-cv-jeshuabenitez",storageBucket:"my-cv-jeshuabenitez.firebasestorage.app",messagingSenderId:"1088783654588",appId:"1:1088783654588:web:54aaf93dd68f47c4f33ab9"}};var Y1=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Zt({type:n,bootstrap:[mf]})}static{this.\u0275inj=Xt({providers:[X0()],imports:[J0,$1,O1,ES.initializeApp(Q1.firebaseConfig)]})}}return n})();var Uz=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Zt({type:n,bootstrap:[mf]})}static{this.\u0275inj=Xt({imports:[Y1,Z0]})}}return n})();export{Uz as a};
